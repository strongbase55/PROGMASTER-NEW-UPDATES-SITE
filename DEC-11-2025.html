<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduPro Academy - Professional Learning Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
        integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <link rel="stylesheet" href="j.css">
    <link rel="stylesheet" href="nav.css">


    <style>
        /* CHANGED: Hero Section Background to White */
        .hero-section {
            background-color: #ffffff;
            position: relative;
            overflow: hidden;
        }

        @media(max-width:768px) {
            .hero-section {
                background-color: #ffffff;
                position: relative;
                overflow: hidden;
                margin-top: 5em;
            }
        }

        /* Floating Animation */
        .floating-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 1000;
            /* Keep it behind text */
            pointer-events: none;
        }

        .float-item {
            position: absolute;
            bottom: -100px;
            animation: floatUp linear infinite;
            /* Default opacity, colors handled in JS */
            opacity: 0.15;
        }

        @keyframes floatUp {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 0;
            }

            10% {
                opacity: 0.5;
                /* Increased visibility */
            }

            90% {
                opacity: 0.5;
            }

            100% {
                transform: translateY(-120vh) rotate(360deg);
                opacity: 0;
            }
        }

        #home-content {
            margin-top: 5em;
        }

        @media(max-width:768px) {
            #home-content {
                margin-top: 4em;
            }
        }

        @media(max-width:768px) {
            #course-detail {
                margin-top: 8em;
            }

            #forum-screen {
                margin-top: 8em;

            }
        }
    </style>
</head>

<body>

    <div id="toast-container"></div>

    <div id="global-loader" aria-hidden="true">
        <div class="loader-box">
            <div class="lds-ring" aria-hidden="true">
                <div></div>
                <div></div>
                <div></div>
                <div></div>
            </div>
            <div>
                <p>Authenticating â€” Please Wait</p>
                <p style="font-size:12px;color:#6b7280;margin-top:4px">Logging in or registering your account
                    securely...
                </p>
            </div>
        </div>
    </div>

    <nav id="total-nav">
        <div class="logo">
            <img id="white-logo"
                src="https://purushotham5.github.io/StrongBase.edu/another-broucher-logo-removebg-preview.png" alt="">
            <img id="black-logo"
                src="https://purushotham5.github.io/StrongBase.edu/another-broucher-logo-removebg-preview.png" alt="">
        </div>

        <div class="menu-icon" id="menu-open">
            <i class="fa-solid fa-bars"></i>
        </div>

        <div class="nav-links" id="nav-buttons">
            <button onclick="showWelcomeScreen()" class="nav-link">Home</button>
            <button onclick="showCourseList()" class="nav-link">Courses</button>
            <button onclick="showContact()" class="nav-link">Contact</button>
            <button onclick="showBlog()" class="nav-link">Blog</button>
            <button onclick="showJobs()" class="nav-link">Jobs</button>
            <button onclick="showRoadmapSelection()" class="nav-link">Roadmaps</button>
            <button onclick="showResumeScanner()" class="nav-link">AI Scanner</button>
            <button onclick="showInternships()" class="use text-black px-4 py-2 rounded-lg" style="font-weight: bold;">
                Internships
            </button>
            <button onclick="showForum()" class="use text-black px-4 py-2" style="font-weight: bold;">
                Forum
            </button>
            <button onclick="showLogin()" class="nav-link">Login</button>
            <button onclick="showRegister()" class="nav-link">Register</button>
            <button onclick="showAdminLogin()" class="nav-link text-red-600 font-semibold">Admin</button>
            <button onclick="toggleDarkMode()" class="p-2 rounded-full hover:bg-gray-200 transition-colors">
                <i id="theme-icon" class="fa-solid fa-moon text-gray-700"></i>
            </button>
        </div>

        <div id="user-nav" class="user-items hidden">
            <div class="flex items-center space-x-1 bg-white rounded-full px-4 py-2 shadow-md">
                <div
                    class="w-8 h-8 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full flex items-center justify-center">
                    <span class="text-white text-sm font-semibold" id="user-avatar"></span>
                </div>
                <span class="text-gray-700 font-medium" id="user-name-nav"></span>
            </div>

            <div class="hidden md:flex items-center mr-4 bg-orange-50 px-3 py-1 rounded-full border border-orange-200"
                title="Daily Learning Streak">
                <i class="fa-solid fa-fire text-orange-500 mr-2 animate-pulse"></i>
                <span id="nav-streak-count" class="font-bold text-orange-700">0</span>
                <span class="text-xs text-orange-400 ml-1">days</span>
            </div>

            <button onclick="showDashboard()"
                class="use bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors">Dashboard</button>
            <button onclick="showProfile()" id="x-a"
                class="use bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors">My
                Courses</button>
            <button onclick="showCertificates()"
                class="use bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">Certificates</button>
            <button onclick="showMyAccount()"
                class="use bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">My
                Account</button>
            <button onclick="showInternships()"
                class="use bg-pink-600 text-white px-4 py-2 rounded-lg hover:bg-pink-700 transition-colors">
                <i class="fa-solid fa-briefcase mr-1"></i> Internships
            </button>
            <button onclick="showForum()"
                class="bg-teal-600 text-white px-4 py-2 rounded-lg hover:bg-teal-700 transition-colors ml-2">
                <i class="fa-solid fa-users-rectangle mr-1"></i> Forum
            </button>
            <button onclick="logout()"
                class="use bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors">Logout</button>

            <div class="menu-icon" id="menu-close">
                <i class="fa-solid fa-x"></i>
            </div>
        </div>


        <div id="admin-nav" class="hidden items-center gap-2">
            <span class="text-sm font-bold text-red-600 hidden md:inline">Admin Mode</span>

            <button onclick="showAdminDashboard()"
                class="bg-blue-600 text-white px-3 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm">
                Dashboard
            </button>

            <div class="flex items-center gap-2">
                <button onclick="toggleAdminView('jobs')"
                    class="bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-2 rounded-lg font-semibold text-sm transition-colors">
                    <i class="fa-solid fa-briefcase"></i> Jobs
                </button>
                <button onclick="toggleAdminView('courses')"
                    class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-2 rounded-lg font-semibold text-sm transition-colors">
                    <i class="fa-solid fa-book-open"></i> Courses
                </button>
            </div>

            <button onclick="showForum()"
                class="bg-teal-600 text-white px-3 py-2 rounded-lg hover:bg-teal-700 transition-colors text-sm flex items-center">
                <i class="fa-solid fa-users-rectangle mr-1"></i> Forum
            </button>

            <button onclick="adminLogout()"
                class="bg-red-500 text-white px-3 py-2 rounded-lg hover:bg-red-600 transition-colors text-sm">
                Logout
            </button>
        </div>
    </nav>

    <div id="roadmap-selection-modal"
        class="hidden fixed inset-0 z-[9999] flex items-center justify-center bg-black/50 backdrop-blur-sm fade-in">
        <div class="bg-white w-full max-w-4xl p-8 rounded-3xl shadow-2xl relative mx-4">

            <div class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-extrabold text-gray-900">Choose Your Career Path</h2>
                <button onclick="closeRoadmapSelection()" class="text-gray-400 hover:text-gray-600 transition-colors">
                    <i class="fa-solid fa-xmark text-2xl"></i>
                </button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 max-h-[70vh] overflow-y-auto p-2">

                <div onclick="selectPath('fullstack')"
                    class="cursor-pointer group bg-white border border-gray-200 p-8 rounded-2xl hover:border-indigo-500 hover:shadow-xl transition-all duration-300 flex flex-col items-center text-center">
                    <div
                        class="w-16 h-16 bg-blue-50 text-blue-600 rounded-full flex items-center justify-center text-3xl mb-4 group-hover:scale-110 transition-transform">
                        <i class="fa-solid fa-layer-group"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">Full Stack Dev</h3>
                    <p class="text-gray-500 text-sm">MERN, Next.js, Databases</p>
                </div>

                <div onclick="selectPath('ai')"
                    class="cursor-pointer group bg-white border border-gray-200 p-8 rounded-2xl hover:border-purple-500 hover:shadow-xl transition-all duration-300 flex flex-col items-center text-center">
                    <div
                        class="w-16 h-16 bg-purple-50 text-purple-600 rounded-full flex items-center justify-center text-3xl mb-4 group-hover:scale-110 transition-transform">
                        <i class="fa-solid fa-brain"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">AI Engineer</h3>
                    <p class="text-gray-500 text-sm">Python, TensorFlow, LLMs</p>
                </div>

                <div onclick="selectPath('devops')"
                    class="cursor-pointer group bg-white border border-gray-200 p-8 rounded-2xl hover:border-orange-500 hover:shadow-xl transition-all duration-300 flex flex-col items-center text-center">
                    <div
                        class="w-16 h-16 bg-orange-50 text-orange-600 rounded-full flex items-center justify-center text-3xl mb-4 group-hover:scale-110 transition-transform">
                        <i class="fa-solid fa-server"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">DevOps</h3>
                    <p class="text-gray-500 text-sm">Docker, K8s, CI/CD</p>
                </div>

                <div onclick="selectPath('datascience')"
                    class="cursor-pointer group bg-white border border-gray-200 p-8 rounded-2xl hover:border-green-500 hover:shadow-xl transition-all duration-300 flex flex-col items-center text-center">
                    <div
                        class="w-16 h-16 bg-green-50 text-green-600 rounded-full flex items-center justify-center text-3xl mb-4 group-hover:scale-110 transition-transform">
                        <i class="fa-solid fa-chart-pie"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">Data Scientist</h3>
                    <p class="text-gray-500 text-sm">Statistics, Pandas, Visualization</p>
                </div>

                <div onclick="selectPath('mobile')"
                    class="cursor-pointer group bg-white border border-gray-200 p-8 rounded-2xl hover:border-teal-500 hover:shadow-xl transition-all duration-300 flex flex-col items-center text-center">
                    <div
                        class="w-16 h-16 bg-teal-50 text-teal-600 rounded-full flex items-center justify-center text-3xl mb-4 group-hover:scale-110 transition-transform">
                        <i class="fa-solid fa-mobile-screen"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">Mobile Dev</h3>
                    <p class="text-gray-500 text-sm">Flutter, React Native, Swift</p>
                </div>

                <div onclick="selectPath('security')"
                    class="cursor-pointer group bg-white border border-gray-200 p-8 rounded-2xl hover:border-red-500 hover:shadow-xl transition-all duration-300 flex flex-col items-center text-center">
                    <div
                        class="w-16 h-16 bg-red-50 text-red-600 rounded-full flex items-center justify-center text-3xl mb-4 group-hover:scale-110 transition-transform">
                        <i class="fa-solid fa-shield-halved"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">Cyber Security</h3>
                    <p class="text-gray-500 text-sm">Network, Eth. Hacking, Cryptography</p>
                </div>

            </div>
        </div>
    </div>

    <div id="subscription-modal"
        class="hidden fixed inset-0 bg-gray-900 bg-opacity-80 z-50 flex items-center justify-center fade-in">
        <div
            class="bg-white rounded-3xl shadow-2xl max-w-lg w-11/12 p-8 transform transition-all duration-300 scale-100 relative">
            <button onclick="document.getElementById('subscription-modal').classList.add('hidden')"
                class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                    </path>
                </svg>
            </button>

            <div class="text-center">
                <div class="text-6xl mb-4">ðŸ‘‘</div>
                <h3 class="text-4xl font-extrabold text-indigo-700 mb-2">PRO ACCESS PASS</h3>
                <p class="text-2xl font-semibold text-gray-700 mb-4">Unlock Everything - Massive Savings!</p>

                <div class="bg-indigo-50 p-6 rounded-xl border border-indigo-200 mb-6">
                    <p class="text-5xl font-extrabold text-indigo-900 mb-3">â‚¹1500</p>
                    <div class="flex items-center justify-center space-x-4 text-xl font-medium text-gray-700">
                        <span class="flex items-center"><i class="fa-solid fa-check text-green-500 mr-2"></i> All 50
                            Courses</span>
                        <span class="flex items-center"><i class="fa-solid fa-check text-green-500 mr-2"></i> 50
                            Certificates</span>
                    </div>
                    <p class="text-sm text-red-500 mt-2 font-bold">That's over 50% OFF the combined price!</p>
                </div>

                <button onclick="initiateSubscriptionPayment()"
                    class="w-full bg-red-600 text-white py-4 rounded-xl text-xl font-bold hover:bg-red-700 transition-colors shadow-lg pulse-glow">
                    Get All Access for â‚¹1500!
                </button>
                <p class="text-sm text-gray-500 mt-3">One-time payment. Instant access upon admin approval.</p>
            </div>
        </div>
    </div>

    <div class="overflow-x-hidden">
        <div id="welcome-screen" class="fade-in" data-aos="fade-up" data-aos-delay="100">

            <section class="hero-section">

                <div id="hero-floating-bg" class="floating-bg"></div>

                <div class="max-w-7xl mx-auto px-4 sm:px-6 relative z-10 text-center" id="home-content">

                    <div
                        class="inline-block p-4 mb-8 rounded-full bg-indigo-50 border border-indigo-100 shadow-sm animate-bounce">
                        <i class="fa-solid fa-code text-4xl text-indigo-600"></i>
                    </div>

                    <h1 class="text-5xl md:text-7xl font-extrabold mb-6 leading-tight text-indigo-950 slide-in">
                        Master the Language of <br>
                        <span
                            class="text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-purple-600">Innovation</span>
                    </h1>

                    <p class="text-xl md:text-2xl mb-10 text-gray-800 max-w-3xl mx-auto font-medium slide-in">
                        Join 50,000+ developers. Learn coding, earn recognized certificates, and launch your dream
                        career with our industry-leading platform.
                    </p>

                    <div class="flex flex-col sm:flex-row gap-5 justify-center mb-16 slide-in">
                        <button onclick="showRegister()"
                            class="pulse-glow bg-indigo-700 text-white px-10 py-4 rounded-full text-lg font-bold hover:bg-indigo-800 transition-all duration-300 shadow-xl transform hover:-translate-y-1">
                            Start Learning Now
                        </button>
                        <button onclick="showCourseList()"
                            class="bg-white border-2 border-indigo-700 text-indigo-700 px-10 py-4 rounded-full text-lg font-bold hover:bg-indigo-50 transition-all duration-300 shadow-sm">
                            Explore Courses
                        </button>
                    </div>
                </div>
            </section>

            <section class="py-16 bg-white-50 border-t border-white relative z-20">
                <div class="max-w-7xl mx-auto px-4 sm:px-6">
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-6 text-center">
                        <div class="p-6 bg-white rounded-2xl shadow-sm border border-gray-100 transform hover:scale-105 transition-transform"
                            data-aos="fade-up" data-aos-delay="100">
                            <div class="text-4xl font-extrabold text-indigo-700 mb-2">50+</div>
                            <div class="text-gray-800 font-bold">Programming Languages</div>
                        </div>
                        <div data-aos="fade-right" data-aos-delay="100"
                            class="p-6 bg-white rounded-2xl shadow-sm border border-gray-100 transform hover:scale-105 transition-transform">
                            <div class="text-4xl font-extrabold text-purple-700 mb-2">15k+</div>
                            <div class="text-gray-800 font-bold">Active Students</div>
                        </div>
                        <div data-aos="fade-down" data-aos-delay="100"
                            class="p-6 bg-white rounded-2xl shadow-sm border border-gray-100 transform hover:scale-105 transition-transform">
                            <div class="text-4xl font-extrabold text-green-600 mb-2">98%</div>
                            <div class="text-gray-800 font-bold">Hiring Rate</div>
                        </div>
                        <div data-aos="fade-left" data-aos-delay="100"
                            class="p-6 bg-white rounded-2xl shadow-sm border border-gray-100 transform hover:scale-105 transition-transform">
                            <div class="text-4xl font-extrabold text-orange-600 mb-2">24/7</div>
                            <div class="text-gray-800 font-bold">Live Support</div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="how-it-works" class="py-20 bg-white">
                <div class="max-w-7xl mx-auto px-4 sm:px-6">
                    <div class="text-center mb-16">
                        <span class="text-purple-600 font-semibold text-sm uppercase tracking-wider">Your Journey to
                            Expertise</span>
                        <h2 class="text-4xl font-extrabold text-gray-900 mb-4">How Our Learning System Works</h2>
                        <p class="text-xl text-gray-600 max-w-3xl mx-auto">A simple, 4-step process designed for maximum
                            retention and career impact.</p>
                    </div>

                    <div class="relative flex justify-center">
                        <div class="hidden md:block absolute top-12 w-full max-w-5xl h-1 bg-indigo-200 z-0"></div>

                        <div class="grid md:grid-cols-4 gap-12 text-center relative z-10">

                            <div class="flex flex-col items-center">
                                <div
                                    class="w-16 h-16 bg-indigo-600 text-white rounded-full flex items-center justify-center font-bold text-2xl shadow-xl border-4 border-white mt-3 mr-2">
                                    1
                                </div>
                                <div class="mt-4">
                                    <h3 class="text-xl font-bold text-gray-800 mb-2">Enroll & Access</h3>
                                    <p class="text-gray-600 text-sm">Sign up for your chosen course or the All-Access
                                        Pass and gain instant access to your Dashboard.</p>
                                </div>
                            </div>

                            <div class="flex flex-col items-center">
                                <div
                                    class="w-16 h-16 bg-purple-600 text-white rounded-full flex items-center justify-center font-bold text-2xl shadow-xl border-4 border-white mt-3">
                                    2
                                </div>
                                <div class="mt-4">
                                    <h3 class="text-xl font-bold text-gray-800 mb-2">Learn Daily Modules</h3>
                                    <p class="text-gray-600 text-sm">Follow the structured 10-day curriculum, engage
                                        with videos, and work on real-world practical projects.</p>
                                </div>
                            </div>

                            <div class="flex flex-col items-center">
                                <div
                                    class="w-16 h-16 bg-green-600 text-white rounded-full flex items-center justify-center font-bold text-2xl shadow-xl border-4 border-white mt-3">
                                    3
                                </div>
                                <div class="mt-4">
                                    <h3 class="text-xl font-bold text-gray-800 mb-2">Pass & Submit</h3>
                                    <p class="text-gray-600 text-sm">Complete all modules and achieve the minimum time
                                        requirement to unlock certificate generation.</p>
                                </div>
                            </div>

                            <div class="flex flex-col items-center">
                                <div
                                    class="w-16 h-16 bg-yellow-600 text-white rounded-full flex items-center justify-center font-bold text-2xl shadow-xl border-4 border-white mt-3 ml-2">
                                    4
                                </div>
                                <div class="mt-4">
                                    <h3 class="text-xl font-bold text-gray-800 mb-2">Claim Certificate</h3>
                                    <p class="text-gray-600 text-sm">Download your industry-recognized, AICTE-aggregated
                                        certificate and boost your career profile.</p>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </section>

            <section class="py-20 bg-white">
                <div class="max-w-7xl mx-auto px-4 sm:px-6">
                    <div class="text-center mb-16">
                        <span class="text-indigo-600 font-semibold text-sm uppercase tracking-wider">Your Learning
                            Advantage</span>
                        <h2 class="text-4xl font-extrabold text-gray-900 mb-4">Why Choose PROGMASTER PVT LTD?</h2>
                        <p class="text-xl text-gray-600 max-w-3xl mx-auto">Experience the future of online learning with
                            our innovative platform and commitment to your success.</p>
                    </div>

                    <div class="grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6 md:gap-8">

                        <div
                            class="card-hover bg-gray-50 p-6 rounded-2xl shadow-lg text-center border-t-4 border-indigo-500">
                            <div
                                class="w-16 h-16 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fa-solid fa-infinity fa-2x text-white"></i>
                            </div>
                            <h3 class="text-xl font-bold mb-2 text-gray-800">Lifetime Access</h3>
                            <p class="text-gray-600 text-sm">Enroll once, own the content forever. Includes all future
                                updates.</p>
                        </div>

                        <div
                            class="card-hover bg-gray-50 p-6 rounded-2xl shadow-lg text-center border-t-4 border-blue-500">
                            <div
                                class="w-16 h-16 bg-gradient-to-r from-blue-500 to-sky-500 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fa-solid fa-award fa-2x text-white"></i>
                            </div>
                            <h3 class="text-xl font-bold mb-2 text-gray-800">AICTE Aggregated</h3>
                            <p class="text-gray-600 text-sm">Receive a certificate recognized and valued by industry
                                standards.</p>
                        </div>

                        <div
                            class="card-hover bg-gray-50 p-6 rounded-2xl shadow-lg text-center border-t-4 border-green-500">
                            <div
                                class="w-16 h-16 bg-gradient-to-r from-green-500 to-emerald-500 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fa-solid fa-handshake-angle fa-2x text-white"></i>
                            </div>
                            <h3 class="text-xl font-bold mb-2 text-gray-800">Placement Support</h3>
                            <p class="text-gray-600 text-sm">Get guidance and resources to help you land your dream job.
                            </p>
                        </div>

                        <div
                            class="card-hover bg-gray-50 p-6 rounded-2xl shadow-lg text-center border-t-4 border-orange-500">
                            <div
                                class="w-16 h-16 bg-gradient-to-r from-orange-500 to-amber-500 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fa-solid fa-file-code fa-2x text-white"></i>
                            </div>
                            <h3 class="text-xl font-bold mb-2 text-gray-800">Real-World Projects</h3>
                            <p class="text-gray-600 text-sm">Build a professional portfolio with practical, hands-on
                                assignments.</p>
                        </div>

                        <div
                            class="card-hover bg-gray-50 p-6 rounded-2xl shadow-lg text-center border-t-4 border-red-500">
                            <div
                                class="w-16 h-16 bg-gradient-to-r from-red-500 to-pink-500 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fa-solid fa-tag fa-2x text-white"></i>
                            </div>
                            <h3 class="text-xl font-bold mb-2 text-gray-800">Affordable Pricing</h3>
                            <p class="text-gray-600 text-sm">High-quality education made accessible with low, one-time
                                fees.</p>
                        </div>

                    </div>
                </div>
            </section>

            <section class="py-20 bg-white">
                <div class="max-w-7xl mx-auto px-4 sm:px-6">
                    <div class="text-center mb-16">
                        <h2 class="text-4xl font-bold text-gray-800 mb-4">Popular Courses</h2>
                        <p class="text-xl text-gray-600">Start your learning journey with our most popular courses</p>
                    </div>

                    <div class="grid md:grid-cols-3 gap-4 md:gap-8" id="popular-courses-preview">
                    </div>

                    <div class="text-center mt-12">
                        <button onclick="showCourseList()"
                            class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-8 py-4 rounded-full text-lg font-semibold hover:shadow-lg transition-all duration-300">
                            View All Courses
                        </button>
                    </div>
                </div>
            </section>

            <section id="testimonials" style="background: white;" class="py-20 relative">
                <div class="max-w-4xl mx-auto px-4 sm:px-6">
                    <div class="text-center mb-12">
                        <span class="text-indigo-600 font-semibold text-sm uppercase tracking-wider">Trusted
                            Voices</span>
                        <h2 class="text-4xl font-extrabold text-gray-900 mb-4">What Our Graduates Say</h2>
                        <p class="text-xl text-gray-600 max-w-2xl mx-auto">Real stories from professionals who advanced
                            their careers with us.</p>
                    </div>

                    <div class="relative overflow-hidden">
                        <div id="testimonials-track" class="flex transition-transform duration-500 ease-in-out">

                            <div class="flex-shrink-0 w-full p-6">
                                <div
                                    class="bg-white p-10 rounded-3xl border-l-8 border-indigo-600 relative text-center">
                                    <i
                                        class="fa-solid fa-quote-left text-indigo-200 absolute top-4 left-4 text-4xl opacity-70"></i>
                                    <p class="text-gray-700 mb-8 text-xl italic max-w-2xl mx-auto">
                                        "Great course, practical projects and supportive instructors! I landed my first
                                        job a month after certification, thanks to the hands-on experience."
                                    </p>
                                    <div class="flex items-center gap-4 justify-center">
                                        <div
                                            class="w-16 h-16 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 flex items-center justify-center text-white text-2xl font-bold shadow-lg">
                                            A</div>
                                        <div class="text-left">
                                            <div class="font-bold text-gray-900 text-lg">Ananya Sharma</div>
                                            <div class="text-sm text-indigo-600 font-medium">Full Stack Graduate</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="flex-shrink-0 w-full p-6">
                                <div class="bg-white p-10 rounded-3xl border-l-8 border-green-600 relative text-center">
                                    <i
                                        class="fa-solid fa-quote-left text-green-200 absolute top-4 left-4 text-4xl opacity-70"></i>
                                    <p class="text-gray-700 mb-8 text-xl italic max-w-2xl mx-auto">
                                        "The certificate is industry-recognized and helped me get interviews at top
                                        firms. The Data Science track was challenging yet incredibly rewarding."
                                    </p>
                                    <div class="flex items-center gap-4 justify-center">
                                        <div
                                            class="w-16 h-16 rounded-full bg-gradient-to-r from-green-500 to-emerald-500 flex items-center justify-center text-white text-2xl font-bold shadow-lg">
                                            R</div>
                                        <div class="text-left">
                                            <div class="font-bold text-gray-900 text-lg">Ravi Teja</div>
                                            <div class="text-sm text-green-600 font-medium">Data Analyst</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="flex-shrink-0 w-full p-6">
                                <div
                                    class="bg-white p-10 rounded-3xl border-l-8 border-orange-600 relative text-center">
                                    <i
                                        class="fa-solid fa-quote-left text-orange-200 absolute top-4 left-4 text-4xl opacity-70"></i>
                                    <p class="text-gray-700 mb-8 text-xl italic max-w-2xl mx-auto">
                                        "Practical, updated content and a friendly community. The support from the
                                        instructors was invaluable. I now feel confident in my Mobile Development role."
                                    </p>
                                    <div class="flex items-center gap-4 justify-center">
                                        <div
                                            class="w-16 h-16 rounded-full bg-gradient-to-r from-orange-500 to-red-500 flex items-center justify-center text-white text-2xl font-bold shadow-lg">
                                            S</div>
                                        <div class="text-left">
                                            <div class="font-bold text-gray-900 text-lg">Sahana K.</div>
                                            <div class="text-sm text-orange-600 font-medium">Mobile Development Expert
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <button onclick="moveTestimonialSlider(-1)"
                            class="absolute top-1/2 left-0 transform -translate-y-1/2 bg-white p-3 rounded-full shadow-lg text-gray-700 hover:bg-gray-200 transition-colors z-10 opacity-75">
                            <i class="fa-solid fa-chevron-left"></i>
                        </button>
                        <button onclick="moveTestimonialSlider(1)"
                            class="absolute top-1/2 right-0 transform -translate-y-1/2 bg-white p-3 rounded-full shadow-lg text-gray-700 hover:bg-gray-200 transition-colors z-10 opacity-75">
                            <i class="fa-solid fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </section>


            <section id="faq-section" class="py-20 bg-gray-50">
                <div class="max-w-4xl mx-auto px-4 sm:px-6">
                    <div class="text-center mb-12">
                        <span class="text-indigo-600 font-semibold text-sm uppercase tracking-wider">Quick
                            Answers</span>
                        <h2 class="text-4xl font-extrabold text-gray-900 mb-4">Frequently Asked Questions</h2>
                        <p class="text-xl text-gray-600">Find instant answers to questions about access, payments, and
                            certificates.</p>
                    </div>

                    <div class="space-y-4" id="faq-accordion">

                        <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-indigo-500 accordion-item">
                            <button
                                class="flex justify-between items-center w-full text-left font-bold text-lg text-gray-800 focus:outline-none"
                                onclick="toggleFaq(this)">
                                <span>How do I get my certificate after finishing a course?</span>
                                <i
                                    class="fa-solid fa-chevron-down text-indigo-500 transform transition-transform duration-300"></i>
                            </button>
                            <div class="accordion-content mt-3 text-gray-600 hidden">
                                <p>Once you complete all the course modules and meet the minimum learning time
                                    (validated by the platform), a "Generate Certificate" button will appear on your
                                    dashboard. You can download the high-resolution PNG file instantly.</p>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-indigo-500 accordion-item">
                            <button
                                class="flex justify-between items-center w-full text-left font-bold text-lg text-gray-800 focus:outline-none"
                                onclick="toggleFaq(this)">
                                <span>Is the certificate recognized or aggregated by AICTE?</span>
                                <i
                                    class="fa-solid fa-chevron-down text-indigo-500 transform transition-transform duration-300"></i>
                            </button>
                            <div class="accordion-content mt-3 text-gray-600 hidden">
                                <p>Yes, our certificates are aggregated according to AICTE guidelines. They are designed
                                    to be valued by employers and are valid for submission on professional networking
                                    sites.</p>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-indigo-500 accordion-item">
                            <button
                                class="flex justify-between items-center w-full text-left font-bold text-lg text-gray-800 focus:outline-none"
                                onclick="toggleFaq(this)">
                                <span>What is the All-Access Pass (Subscription)?</span>
                                <i
                                    class="fa-solid fa-chevron-down text-indigo-500 transform transition-transform duration-300"></i>
                            </button>
                            <div class="accordion-content mt-3 text-gray-600 hidden">
                                <p>The All-Access Pass is a one-time payment for â‚¹1500 that grants you instant, lifetime
                                    access to all 50+ courses and all future courses on the platform. It's the best
                                    value if you plan to take multiple courses.</p>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-indigo-500 accordion-item">
                            <button
                                class="flex justify-between items-center w-full text-left font-bold text-lg text-gray-800 focus:outline-none"
                                onclick="toggleFaq(this)">
                                <span>Is the course content available offline?</span>
                                <i
                                    class="fa-solid fa-chevron-down text-indigo-500 transform transition-transform duration-300"></i>
                            </button>
                            <div class="accordion-content mt-3 text-gray-600 hidden">
                                <p>The current platform requires an internet connection to access the course content and
                                    record your progress accurately for certificate validation.</p>
                            </div>
                        </div>

                    </div>
                </div>
            </section>

            <section id="contact-section" class="py-20 bg-gradient-to-b from-gray-50 to-white">
                <div class="max-w-7xl mx-auto px-4 sm:px-6">
                    <div class="text-center mb-12">
                        <span class="text-indigo-600 font-semibold text-sm uppercase tracking-wider">24/7 Support</span>
                        <h2 class="text-4xl font-extrabold text-gray-900 mb-4">Connect with Our Team</h2>
                        <p class="text-xl text-gray-600 max-w-3xl mx-auto">We're here to answer all your questions about
                            courses, enrollment, and technical support.</p>
                    </div>

                    <div class="grid md:grid-cols-3 gap-8 items-start">

                        <div class="md:col-span-1 bg-white p-8 rounded-2xl shadow-xl border-l-4 border-indigo-600">
                            <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                                <i class="fa-solid fa-headset mr-3 text-indigo-600"></i> Direct Channels
                            </h3>
                            <div class="space-y-6">
                                <div class="flex items-start space-x-4">
                                    <i class="fa-solid fa-envelope text-2xl text-indigo-500 mt-1"></i>
                                    <div>
                                        <h4 class="font-semibold text-gray-900">Email Support</h4>
                                        <p class="text-gray-600 text-sm">Our primary support channel. Expect a reply
                                            within 24 hours.</p>
                                        <a href="mailto:support@edupro.example"
                                            class="text-indigo-600 font-medium hover:underline">support@edupro.example</a>
                                    </div>
                                </div>

                                <div class="flex items-start space-x-4">
                                    <i class="fa-solid fa-phone-volume text-2xl text-indigo-500 mt-1"></i>
                                    <div>
                                        <h4 class="font-semibold text-gray-900">Call Us</h4>
                                        <p class="text-gray-600 text-sm">For urgent inquiries during business hours
                                            (10AM - 6PM IST).</p>
                                        <a href="tel:+919876543210"
                                            class="text-indigo-600 font-medium hover:underline">+91 98765 43210</a>
                                    </div>
                                </div>

                                <div class="flex items-start space-x-4">
                                    <i class="fa-solid fa-map-location-dot text-2xl text-indigo-500 mt-1"></i>
                                    <div>
                                        <h4 class="font-semibold text-gray-900">Corporate Address</h4>
                                        <p class="text-gray-600 text-sm">Visit our headquarters (by appointment only).
                                        </p>
                                        <address class="not-italic text-indigo-600 font-medium">12/4 Tech Park,
                                            Hyderabad, India</address>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="md:col-span-2 bg-white p-8 rounded-2xl shadow-xl">
                            <h3 class="text-2xl font-bold text-gray-800 mb-6">Send Us a Message</h3>
                            <form id="contact-form"
                                onsubmit="event.preventDefault(); alert('Thank you! Your message has been received. We will contact you shortly.'); this.reset();"
                                class="space-y-4">

                                <div class="grid sm:grid-cols-2 gap-4">
                                    <input required placeholder="Your Full Name"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-shadow">
                                    <input required type="email" placeholder="Your Email Address"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-shadow">
                                </div>

                                <input type="text" placeholder="Subject (e.g., Enrollment Question)"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-shadow">

                                <textarea required placeholder="Your detailed message..." rows="6"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-shadow"></textarea>

                                <button type="submit"
                                    class="w-full bg-indigo-600 text-white py-3 rounded-lg text-lg font-semibold hover:bg-indigo-700 transition-colors shadow-lg flex items-center justify-center space-x-2">
                                    <span>Send Message</span> <i class="fa-solid fa-paper-plane"></i>
                                </button>
                            </form>
                        </div>
                    </div>

                    <div class="mt-8 text-center text-gray-500 text-sm">
                        <p>*Note: For fastest service, please check our <a href="#"
                                class="text-indigo-600 hover:underline">FAQ section</a> before submitting a query.</p>
                    </div>
                </div>
            </section>


            <footer class="bg-gray-800 text-white py-12">
                <div class="max-w-7xl mx-auto px-4 sm:px-6">
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-8 border-b border-gray-700 pb-8">

                        <div class="col-span-2 md:col-span-1">
                            <div class="flex items-center space-x-2 mb-4">
                                <svg class="w-8 h-8 text-indigo-400" fill="currentColor" viewBox="0 0 20 20">
                                    <path
                                        d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3zM3.31 9.397L5 10.12v4.102a8.969 8.969 0 00-1.05-.174 1 1 0 01-.89-.89 11.115 11.115 0 01.25-3.762zM9.3 16.573A9.026 9.026 0 007 14.935v-3.957l1.818.78a3 3 0 002.364 0l5.508-2.361a11.026 11.026 0 01.25 3.762 1 1 0 01-.89.89 8.968 8.968 0 00-5.35 2.524 1 1 0 01-1.4 0zM6 18a1 1 0 001-1v-2.065a8.935 8.935 0 00-2-.712V17a1 1 0 001 1z" />
                                </svg>
                                <span class="text-xl font-bold text-white">EduPro Academy</span>
                            </div>
                            <p class="text-gray-400 text-sm">Empowering professionals with future-ready skills through
                                expert-led, practical courses.</p>
                            <div class="flex space-x-4 mt-4 text-gray-400">
                                <i class="fa-brands fa-facebook text-lg hover:text-indigo-400 transition-colors"></i>
                                <i class="fa-brands fa-twitter text-lg hover:text-indigo-400 transition-colors"></i>
                                <i class="fa-brands fa-linkedin text-lg hover:text-indigo-400 transition-colors"></i>
                            </div>
                        </div>

                        <div>
                            <h4 class="text-lg font-semibold mb-4 text-indigo-400">Quick Links</h4>
                            <ul class="space-y-2 text-sm">
                                <li><button onclick="showWelcomeScreen()"
                                        class="text-gray-300 hover:text-indigo-400 transition-colors">Home</button></li>
                                <li><button onclick="showCourseList()"
                                        class="text-gray-300 hover:text-indigo-400 transition-colors">Courses</button>
                                </li>
                                <li><button onclick="showDashboard()"
                                        class="text-gray-300 hover:text-indigo-400 transition-colors">Dashboard</button>
                                </li>
                                <li><button onclick="showCertificates()"
                                        class="text-gray-300 hover:text-indigo-400 transition-colors">Certificates</button>
                                </li>
                            </ul>
                        </div>

                        <div>
                            <h4 class="text-lg font-semibold mb-4 text-indigo-400">Contact Us</h4>
                            <ul class="space-y-2 text-sm text-gray-300">
                                <li><i class="fa-solid fa-envelope mr-2"></i> support@edupro.example</li>
                                <li><i class="fa-solid fa-phone mr-2"></i> +91 98765 43210</li>
                                <li><i class="fa-solid fa-location-dot mr-2"></i> 12/4 Tech Park, Hyderabad</li>
                            </ul>
                        </div>

                        <div>
                            <h4 class="text-lg font-semibold mb-4 text-indigo-400">Legal</h4>
                            <ul class="space-y-2 text-sm">
                                <li><a href="#" class="text-gray-300 hover:text-indigo-400 transition-colors">Privacy
                                        Policy</a></li>
                                <li><a href="#" class="text-gray-300 hover:text-indigo-400 transition-colors">Terms of
                                        Service</a></li>
                                <li><a href="#" class="text-gray-300 hover:text-indigo-400 transition-colors">Refund
                                        Policy</a></li>
                            </ul>
                        </div>

                    </div>

                    <div class="mt-8 text-center text-sm text-gray-400">
                        &copy; <span id="current-year">2025</span> PROGMASTER PVT LTD. All rights reserved.
                    </div>
                </div>
            </footer>


        </div>
        <div id="admin-login-screen" class="hidden max-w-md mx-auto p-8 rounded-lg shadow-lg fade-in">
            <h2 class="text-2xl font-bold text-center mb-6 text-red-600">Admin Login</h2>
            <p class="text-center text-sm text-gray-600 mb-4">Use: admin@edupro.com / admin123</p>
            <form onsubmit="handleAdminLogin(event)">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Admin Email</label>
                    <input type="email" id="admin-email"
                        class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-red-500"
                        value="admin@edupro.com" required>
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Admin Password</label>
                    <input type="password" id="admin-password"
                        class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-red-500"
                        value="admin123" required>
                </div>
                <button type="submit" class="w-full bg-red-600 text-white py-2 rounded-lg hover:bg-red-700">Login as
                    Admin</button>
            </form>
            <p class="text-center mt-4">
                <button onclick="showWelcomeScreen()" class="text-gray-600 hover:underline">â† Back to Main Page</button>
            </p>
        </div>

        <div id="login-form" class="hidden max-w-md mx-auto rounded-lg fade-in">
            <h2 class="text-2xl font-bold text-center mb-6 text-red-600">Login</h2>
            <form onsubmit="handleLogin(event)">
                <div class="mb-4">
                    <label class="block text-black-400 text-md font-bold mb-2">Email</label>
                    <input type="email" id="login-email"
                        class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-indigo-500" required>
                </div>
                <div class="mb-6">
                    <label class="block text-black text-md font-bold mb-2">Password</label>
                    <input type="password" id="login-password"
                        class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-indigo-500" required>
                </div>
                <button type="submit"
                    class="w-full bg-red-600 text-white py-2 rounded-lg hover:bg-red-700">Login</button>
            </form>
            <p class="text-center text-md text-black mt-4">
                Don't have an account?
                <button onclick="showRegister()" class="text-indigo-600 hover:underline">Register here</button>
            </p>
        </div>

        <div id="register-form" class="hidden max-w-md mx-auto bg-black p-8 rounded-lg shadow-lg fade-in">
            <h2 class="text-2xl font-bold text-center text-white mb-6">Register</h2>
            <form onsubmit="handleRegister(event)">
                <div class="mb-4">
                    <label class="block text-white text-sm font-bold mb-2">Full Name (Used for Certificate)</label>
                    <input type="text" id="register-name"
                        class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-green-500" required>
                    <p class="text-red-500 text-xs mt-1 font-semibold">âš ï¸ WARNING: Double-check this name! It cannot be
                        changed and will appear on your official certificate.</p>
                </div>
                <div class="mb-4">
                    <label class="block text-white text-sm font-bold mb-2">Email</label>
                    <input type="email" id="register-email"
                        class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-green-500" required>
                </div>
                <div class="mb-4">
                    <label class="block text-white text-sm font-bold mb-2">Phone Number (10 Digits)</label>
                    <input type="tel" id="register-phone" pattern="[0-9]{10}" maxlength="10"
                        class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-green-500" required>
                </div>
                <div class="mb-6">
                    <label class="block text-white text-sm font-bold mb-2">Password</label>
                    <input type="password" id="register-password"
                        class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-green-500" required>
                </div>
                <button type="submit"
                    class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700">Register</button>
            </form>
            <p class="text-center text-white mt-4">
                Already have an account?
                <button onclick="showLogin()" class="text-green-600 hover:underline">Login here</button>
            </p>
        </div>

        <div id="my-account-screen" class="hidden max-w-4xl mx-auto px-4 sm:px-6 py-8">
            <div class="bg-white rounded-2xl shadow-xl p-8 border-t-4 border-blue-500">
                <h2 class="text-4xl font-bold text-gray-800 mb-6 flex items-center">
                    <svg class="w-8 h-8 mr-3 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg> My Account Details
                </h2>
                <div id="my-account-details-container" class="space-y-4">
                </div>
            </div>
        </div>

        <div id="dashboard-screen" class="hidden fade-in min-h-screen bg-gray-100">
            <div class="flex max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">

                <div class="hidden md:block w-72 mr-8 sticky top-20 self-start space-y-6">

                    <div class="bg-white rounded-2xl shadow-lg p-6 space-y-2">
                        <h3 class="text-lg font-bold text-gray-900 mb-4 border-b pb-3">LMS Navigation</h3>
                        <button onclick="showDashboard()"
                            class="w-full text-left flex items-center space-x-3 p-3 rounded-lg text-white bg-indigo-600 hover:bg-indigo-700 transition-colors">
                            <i class="fa-solid fa-gauge-high"></i> <span class="font-semibold">Dashboard</span>
                        </button>
                        <button onclick="showProfile()"
                            class="w-full text-left flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors">
                            <i class="fa-solid fa-book-open"></i> <span>My Courses</span>
                        </button>
                        <button onclick="showCertificates()"
                            class="w-full text-left flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors">
                            <i class="fa-solid fa-certificate"></i> <span>Certificates</span>
                        </button>
                        <button onclick="showMyAccount()"
                            class="w-full text-left flex items-center space-x-3 p-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors">
                            <i class="fa-solid fa-user-gear"></i> <span>Account Settings</span>
                        </button>
                        <div class="pt-4 mt-4 border-t">
                            <button onclick="logout()"
                                class="w-full text-left flex items-center space-x-3 p-3 rounded-lg text-red-600 hover:bg-red-50 transition-colors">
                                <i class="fa-solid fa-right-from-bracket"></i> <span>Logout</span>
                            </button>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl shadow-xl p-6">
                        <h3 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-3">Quick Actions</h3>
                        <div class="space-y-3">
                            <button onclick="showProfile()"
                                class="w-full bg-indigo-600 text-white py-3 rounded-lg hover:bg-indigo-700 transition-colors flex items-center justify-center space-x-2">
                                <i class="fa-solid fa-list-check"></i> <span>Go to My Courses</span>
                            </button>
                            <button onclick="showCourseList()"
                                class="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 transition-colors flex items-center justify-center space-x-2">
                                <i class="fa-solid fa-magnifying-glass"></i> <span>Browse All Courses</span>
                            </button>
                            <button onclick="showCertificates()"
                                class="w-full bg-yellow-500 text-gray-900 py-3 rounded-lg hover:bg-yellow-600 transition-colors flex items-center justify-center space-x-2">
                                <i class="fa-solid fa-download"></i> <span>Download Certificates</span>
                            </button>
                            <button onclick="showMyAccount()"
                                class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center space-x-2">
                                <i class="fa-solid fa-gear"></i> <span>Manage Account</span>
                            </button>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4 border-b pb-2">Your Focus Metrics</h3>
                        <div class="space-y-4">

                            <div class="flex items-center space-x-3">
                                <div class="text-indigo-600">
                                    <i class="fa-solid fa-bullseye fa-lg"></i>
                                </div>
                                <div>
                                    <div class="text-xl font-bold" id="sidebar-courses-remaining">0</div>
                                    <div class="text-xs text-gray-500">Certificates to Achieve</div>
                                </div>
                            </div>

                            <div class="flex items-center space-x-3">
                                <div class="text-red-600">
                                    <i class="fa-solid fa-clock-rotate-left fa-lg"></i>
                                </div>
                                <div>
                                    <div class="text-xl font-bold" id="sidebar-last-active">Loading...</div>
                                    <div class="text-xs text-gray-500">Last Session</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
                        <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center space-x-2">
                            <i class="fa-solid fa-trophy text-yellow-600"></i>
                            <span>Top Achievers</span>
                        </h3>
                        <div id="leaderboard-list" class="space-y-3">
                            <p class="text-sm text-gray-500">Loading leaderboard...</p>
                        </div>
                    </div>

                </div>

                <div class="flex-grow">
                    <div class="mb-8">
                        <h2 class="text-4xl font-extrabold text-gray-900 mb-2">Welcome Back, <span
                                id="dashboard-user-name"></span>!</h2>
                        <p class="text-gray-600 text-lg">Your central hub for learning progress and quick actions.</p>
                    </div>

                    <div id="premium-greeting"
                        class="hidden bg-gradient-to-r from-yellow-400 to-orange-500 text-white p-4 rounded-xl shadow-lg mb-6 transform transition-all duration-500 hover:scale-[1.01] flex items-center justify-between space-x-3">
                        <div class="flex items-center space-x-3">
                            <span class="text-3xl">ðŸ‘‘</span>
                            <p class="text-xl font-bold">Welcome, Premium Member! All 50+ courses are unlocked.</p>
                        </div>
                        <button onclick="showCourseList()"
                            class="bg-white text-orange-600 font-semibold px-4 py-2 rounded-lg text-sm hover:shadow-xl">Browse
                            All</button>
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6 mb-8">
                        <div
                            class="bg-white p-6 rounded-2xl shadow-lg border-b-4 border-indigo-600 transform transition-transform duration-330 hover:scale-[1.02]">
                            <p class="text-indigo-600 font-bold mb-1">Enrolled Courses</p>
                            <p class="text-4xl font-extrabold text-gray-900" id="enrolled-count">0</p>
                            <div class="flex items-center text-sm text-gray-500 mt-2">
                                <i class="fa-solid fa-book-reader mr-2"></i> All courses you have access to.
                            </div>
                        </div>

                        <div
                            class="bg-white p-6 rounded-2xl shadow-lg border-b-4 border-green-600 transform transition-transform duration-330 hover:scale-[1.02]">
                            <p class="text-green-600 font-bold mb-1">Certificates Earned</p>
                            <p class="text-4xl font-extrabold text-gray-900" id="certificates-count">0</p>
                            <div class="flex items-center text-sm text-gray-500 mt-2">
                                <i class="fa-solid fa-trophy mr-2"></i> Industry-recognized achievements.
                            </div>
                        </div>

                        <div
                            class="bg-white p-6 rounded-2xl shadow-lg border-b-4 border-yellow-600 transform transition-transform duration-330 hover:scale-[1.02]">
                            <p class="text-yellow-600 font-bold mb-1">Global Announcements</p>
                            <p class="text-4xl font-extrabold text-gray-900">
                                <button onclick="showNotificationPopup()" class="text-yellow-600 hover:text-yellow-700">
                                    <span id="notification-badge"
                                        class="bg-red-600 text-white text-xs font-bold px-2 py-1 rounded-full absolute top-2 right-2 transform translate-x-1/2 -translate-y-1/2 hidden">New!</span>
                                    <i class="fa-solid fa-bell"></i>
                                </button>
                            </p>
                            <div class="flex items-center text-sm text-gray-500 mt-2">
                                <i class="fa-solid fa-bullhorn mr-2"></i> Important updates from the team.
                            </div>
                        </div>
                    </div>

                    <div class="md:hidden bg-white rounded-2xl shadow-xl p-6 mb-8">
                        <h3 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-3">Quick Actions</h3>
                        <div class="space-y-3">
                            <button onclick="showProfile()"
                                class="w-full bg-indigo-600 text-white py-3 rounded-lg hover:bg-indigo-700 transition-colors flex items-center justify-center space-x-2">
                                <i class="fa-solid fa-list-check"></i> <span>Go to My Courses</span>
                            </button>
                            <button onclick="showCourseList()"
                                class="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 transition-colors flex items-center justify-center space-x-2">
                                <i class="fa-solid fa-magnifying-glass"></i> <span>Browse All Courses</span>
                            </button>
                            <button onclick="showCertificates()"
                                class="w-full bg-yellow-500 text-gray-900 py-3 rounded-lg hover:bg-yellow-600 transition-colors flex items-center justify-center space-x-2">
                                <i class="fa-solid fa-download"></i> <span>Download Certificates</span>
                            </button>
                            <button onclick="showMyAccount()"
                                class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center space-x-2">
                                <i class="fa-solid fa-gear"></i> <span>Manage Account</span>
                            </button>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl shadow-xl p-6">
                        <h3 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-3">Continue Learning</h3>
                        <div id="continue-learning" class="space-y-4">
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl shadow-xl p-6 mt-8">
                        <h3 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-3">My Learning Metrics</h3>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">

                            <div style="height: 350px;">
                                <canvas id="studentProgressChart"></canvas>
                            </div>

                            <div style="height: 350px;">
                                <canvas id="peerComparisonChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl shadow-xl mt-8 w-auto">
                        <h3 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-3 px-6 sm:px-8 lg:px-10 pt-6">
                            Weekly Engagement Trend</h3>

                        <div class="px-6 sm:px-8 lg:px-10 pb-6" style="height: 300px;">
                            <canvas id="weeklyActivityTrendChart"></canvas>
                        </div>
                    </div>

                </div>

            </div>
        </div>

        <!-- JOB SCREEN -->
        <div id="jobs-screen" class="hidden fade-in min-h-screen bg-[#F8F9FC]">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 py-8">
                <div class="flex justify-between items-center mb-8">
                    <button onclick="showWelcomeScreen()"
                        class="flex items-center text-gray-600 hover:text-indigo-600 transition-colors font-semibold">
                        <i class="fa-solid fa-arrow-left mr-2"></i> Back to Home
                    </button>
                    <div class="text-sm text-gray-400">Live Opportunities</div>
                </div>

                <div class="text-center mb-10">
                    <h2 class="text-4xl font-extrabold text-[#0F172A] mb-3">Curated Tech Jobs</h2>
                    <p class="text-gray-500 text-lg">Verified opportunities from companies that value code quality.</p>
                </div>

                <div
                    class="flex flex-col lg:flex-row justify-between items-center gap-4 mb-10 bg-white p-4 rounded-2xl shadow-sm border border-gray-100">
                    <div class="w-full lg:w-1/2 relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fa-solid fa-magnifying-glass text-gray-400"></i>
                        </div>
                        <input type="text" id="job-search-input" oninput="executeJobFilter()"
                            class="block w-full pl-10 pr-3 py-3 border border-gray-200 rounded-xl bg-gray-50 focus:ring-2 focus:ring-indigo-500 focus:outline-none"
                            placeholder="Search role, stack or company...">
                    </div>
                    <div class="flex flex-wrap justify-center gap-2">
                        <button onclick="filterJobs('all', this)"
                            class="job-filter-btn active bg-indigo-600 text-white px-5 py-2 rounded-full text-sm font-semibold border border-indigo-600 shadow-sm">All</button>
                        <button onclick="filterJobs('Remote', this)"
                            class="job-filter-btn bg-white text-gray-600 px-5 py-2 rounded-full text-sm font-semibold border border-gray-200 shadow-sm">Remote</button>
                        <button onclick="filterJobs('Frontend', this)"
                            class="job-filter-btn bg-white text-gray-600 px-5 py-2 rounded-full text-sm font-semibold border border-gray-200 shadow-sm">Frontend</button>
                        <button onclick="filterJobs('Backend', this)"
                            class="job-filter-btn bg-white text-gray-600 px-5 py-2 rounded-full text-sm font-semibold border border-gray-200 shadow-sm">Backend</button>
                        <button onclick="filterJobs('HighPay', this)"
                            class="job-filter-btn bg-white text-gray-600 px-5 py-2 rounded-full text-sm font-semibold border border-gray-200 shadow-sm">$100k+</button>
                    </div>
                </div>

                <div id="jobs-grid-display" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>

                <div id="no-jobs-message" class="hidden text-center py-20">
                    <h3 class="text-xl font-bold text-gray-800">No jobs found</h3>
                </div>
            </div>
        </div>


        <div id="forum-screen" class="hidden fade-in min-h-screen bg-slate-50 pb-20">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 py-4 md:py-8">

                <div
                    class="flex flex-col md:flex-row justify-between items-center gap-4 mb-8 bg-white p-4 rounded-xl shadow-sm border border-gray-200">
                    <div class="flex items-center gap-4 w-full md:w-auto">
                        <button onclick="handleForumBack()" class="text-gray-500 hover:text-indigo-600 font-bold">
                            <i class="fa-solid fa-arrow-left"></i> <span class="hidden md:inline">Back</span>
                        </button>
                        <h2 class="text-xl md:text-2xl font-bold text-gray-800">
                            <span class="text-indigo-600">Edu</span>Forum
                        </h2>
                    </div>

                    <div class="flex gap-2 w-full md:w-auto overflow-x-auto pb-1 md:pb-0">
                        <button onclick="switchForumTab('all')" id="tab-all-btn"
                            class="flex-shrink-0 px-4 py-2 rounded-lg font-semibold text-xs md:text-sm transition-colors bg-indigo-600 text-white whitespace-nowrap">
                            Community
                        </button>
                        <button onclick="switchForumTab('my')" id="tab-my-btn"
                            class="flex-shrink-0 px-4 py-2 rounded-lg font-semibold text-xs md:text-sm transition-colors bg-white text-gray-600 border border-gray-200 whitespace-nowrap">
                            My Questions
                        </button>
                        <button onclick="openAskModal()"
                            class="flex-shrink-0 px-4 py-2 rounded-lg font-bold text-xs md:text-sm bg-orange-500 text-white hover:bg-orange-600 shadow-md whitespace-nowrap">
                            <i class="fa-solid fa-pen-to-square mr-1"></i> Ask
                        </button>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">

                    <div class="lg:col-span-4" id="forum-feed-view">
                        <div class="mb-6 relative">
                            <i class="fa-solid fa-search absolute left-4 top-3.5 text-gray-400"></i>
                            <input type="text" id="forum-search" oninput="renderForumList()"
                                placeholder="Search topics..."
                                class="w-full pl-10 pr-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-indigo-500 outline-none">
                        </div>
                        <div id="questions-list-container" class="space-y-4"></div>
                    </div>

                    <div class="lg:col-span-4 hidden" id="forum-detail-view">

                        <div id="detail-question-card"
                            class="bg-white p-6 md:p-8 rounded-2xl shadow-md border border-gray-100 mb-8 break-words">
                        </div>

                        <h3 class="text-xl font-bold text-gray-800 mb-4 pl-2 border-l-4 border-indigo-500">Answers</h3>
                        <div id="answers-list-container" class="space-y-6 mb-10"></div>

                        <div class="bg-white p-4 md:p-6 rounded-2xl shadow-lg border border-gray-200">
                            <h3 class="font-bold text-gray-800 mb-4">Post Your Answer</h3>

                            <div class="flex flex-wrap gap-2 mb-2 border-b pb-2">
                                <button onclick="formatDoc('bold')" class="p-2 hover:bg-gray-100 rounded"><i
                                        class="fa-solid fa-bold"></i></button>
                                <button onclick="formatDoc('italic')" class="p-2 hover:bg-gray-100 rounded"><i
                                        class="fa-solid fa-italic"></i></button>
                                <button onclick="formatDoc('insertUnorderedList')"
                                    class="p-2 hover:bg-gray-100 rounded"><i class="fa-solid fa-list-ul"></i></button>
                                <button onclick="addCodeBlock('answer-editor')" class="p-2 hover:bg-gray-100 rounded"><i
                                        class="fa-solid fa-code"></i></button>
                                <button onclick="triggerImageUpload('answer-img-input')"
                                    class="p-2 hover:bg-gray-100 rounded text-indigo-600"><i
                                        class="fa-regular fa-image"></i></button>
                            </div>

                            <div id="answer-editor" contenteditable="true"
                                class="w-full min-h-[150px] p-4 border border-gray-300 rounded-lg focus:outline-none focus:border-indigo-500 bg-gray-50 text-sm max-h-[400px] overflow-y-auto">
                            </div>

                            <div class="flex justify-end mt-4">
                                <button onclick="submitAnswer()"
                                    class="bg-indigo-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-indigo-700">Submit
                                    Answer</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="ask-question-modal"
            class="hidden fixed inset-0 z-[10000] flex items-center justify-center bg-black/60 backdrop-blur-sm px-4">
            <div class="bg-white w-full max-w-3xl p-6 rounded-2xl shadow-2xl relative max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl md:text-2xl font-bold text-gray-900">Ask the Community</h2>
                    <button onclick="closeAskModal()" class="text-gray-400 hover:text-red-500"><i
                            class="fa-solid fa-xmark text-2xl"></i></button>
                </div>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">Title</label>
                        <input type="text" id="ask-title"
                            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"
                            placeholder="e.g. How do I fix a React useEffect infinite loop?">
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">Details</label>
                        <div class="flex flex-wrap gap-2 mb-1 bg-gray-50 p-2 rounded-t-lg border border-gray-200">
                            <button onclick="formatDocQuestion('bold')" class="p-1 hover:text-indigo-600"><i
                                    class="fa-solid fa-bold"></i></button>
                            <button onclick="formatDocQuestion('italic')" class="p-1 hover:text-indigo-600"><i
                                    class="fa-solid fa-italic"></i></button>
                            <button onclick="formatDocQuestion('insertUnorderedList')"
                                class="p-1 hover:text-indigo-600"><i class="fa-solid fa-list"></i></button>
                            <button onclick="addCodeBlock('ask-editor')" class="p-1 hover:text-indigo-600"><i
                                    class="fa-solid fa-code"></i></button>
                            <button onclick="triggerImageUpload('ask-img-input')" class="p-1 hover:text-indigo-600"><i
                                    class="fa-regular fa-image"></i></button>
                        </div>
                        <div id="ask-editor" contenteditable="true"
                            class="w-full min-h-[200px] p-4 border border-gray-300 rounded-b-lg focus:outline-none focus:border-indigo-500 bg-white max-h-[300px] overflow-y-auto">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">Tags</label>
                        <input type="text" id="ask-tags" class="w-full px-4 py-2 border rounded-lg outline-none"
                            placeholder="javascript, react, bug">
                    </div>

                    <button onclick="submitQuestion()"
                        class="w-full bg-indigo-600 text-white py-3 rounded-lg font-bold hover:bg-indigo-700 shadow-lg mt-4">Post
                        Question</button>
                </div>
            </div>
        </div>

        <input type="file" id="ask-img-input" accept="image/*" class="hidden"
            onchange="handleImageUpload(this, 'ask-editor')">
        <input type="file" id="answer-img-input" accept="image/*" class="hidden"
            onchange="handleImageUpload(this, 'answer-editor')">
        <!-- ROADMAPS -->
        <div id="roadmap-screen" class="hidden fade-in min-h-screen bg-slate-900 text-white pb-20">
            <div class="max-w-5xl mx-auto px-4 sm:px-6 py-8">

                <div class="flex justify-between items-center mb-12">
                    <button onclick="showRoadmapSelection()"
                        class="flex items-center text-gray-400 hover:text-white transition-colors">
                        <i class="fa-solid fa-arrow-left mr-2"></i> Choose Different Path
                    </button>
                    <h2 id="roadmap-title"
                        class="text-3xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500">
                    </h2>
                </div>

                <div id="timeline-container" class="relative wrap overflow-hidden p-4 h-full">
                </div>
            </div>
        </div>


        <div id="resume-scanner-screen" class="hidden fade-in min-h-screen bg-slate-50">
            <div class="max-w-6xl mx-auto px-4 sm:px-6 py-10">

                <div class="flex justify-between items-center mb-8">
                    <div class="flex items-center gap-4">
                        <button onclick="showWelcomeScreen()"
                            class="flex items-center text-gray-600 hover:text-indigo-600 transition-colors font-semibold">
                            <i class="fa-solid fa-arrow-left mr-2"></i> Back
                        </button>
                        <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                            <i class="fa-solid fa-robot text-indigo-600 mr-2"></i> AI Resume Matcher
                        </h2>
                    </div>

                    <button onclick="openScannerInfo()"
                        class="flex items-center gap-2 bg-indigo-50 text-indigo-700 px-4 py-2 rounded-full font-bold hover:bg-indigo-100 transition-all shadow-sm group">
                        <i class="fa-solid fa-circle-info text-lg group-hover:scale-110 transition-transform"></i>
                        <span>How does this help me?</span>
                    </button>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

                    <div class="space-y-6">
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-200">
                            <label class="block text-sm font-bold text-gray-700 mb-2">1. Paste Job Description</label>
                            <textarea id="scan-job-desc" rows="6"
                                class="w-full p-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none resize-none text-sm"
                                placeholder="Paste the job requirements here (e.g. React, Node.js, AWS)..."></textarea>
                        </div>

                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-200">
                            <label class="block text-sm font-bold text-gray-700 mb-2">2. Paste Your Resume Text</label>
                            <textarea id="scan-resume-text" rows="6"
                                class="w-full p-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none resize-none text-sm"
                                placeholder="Paste your resume content here..."></textarea>
                        </div>

                        <button onclick="analyzeResume()"
                            class="w-full bg-indigo-600 text-white py-4 rounded-xl font-bold text-lg hover:bg-indigo-700 shadow-lg hover:shadow-xl transition-all transform hover:-translate-y-1">
                            Analyze Match Score ðŸš€
                        </button>
                    </div>

                    <div
                        class="bg-white p-8 rounded-2xl shadow-lg border border-gray-100 flex flex-col justify-center items-center text-center relative overflow-hidden">

                        <div id="scan-placeholder" class="opacity-100 transition-opacity duration-300">
                            <div
                                class="w-24 h-24 bg-indigo-50 text-indigo-200 rounded-full flex items-center justify-center text-5xl mx-auto mb-4">
                                <i class="fa-solid fa-magnifying-glass-chart"></i>
                            </div>
                            <h3 class="text-xl font-bold text-gray-400">Ready to Analyze</h3>
                            <p class="text-gray-400 text-sm mt-2">Paste text to see your ATS score.</p>
                        </div>

                        <div id="scan-results" class="hidden w-full text-left">
                            <div class="flex justify-between items-end mb-6 border-b pb-6">
                                <div>
                                    <p class="text-gray-500 text-sm font-bold uppercase tracking-wider">ATS
                                        Compatibility</p>
                                    <h3 class="text-5xl font-extrabold text-gray-900 mt-2" id="scan-score">0%</h3>
                                </div>
                                <div id="scan-score-icon" class="text-6xl">ðŸ˜</div>
                            </div>

                            <div class="space-y-6">
                                <div>
                                    <h4 class="font-bold text-green-700 flex items-center mb-2">
                                        <i class="fa-solid fa-check-circle mr-2"></i> Matched Keywords
                                    </h4>
                                    <div id="scan-matched" class="flex flex-wrap gap-2"></div>
                                </div>

                                <div>
                                    <h4 class="font-bold text-red-600 flex items-center mb-2">
                                        <i class="fa-solid fa-triangle-exclamation mr-2"></i> Missing Keywords
                                    </h4>
                                    <div id="scan-missing" class="flex flex-wrap gap-2"></div>
                                </div>
                            </div>

                            <div class="mt-8 pt-6 border-t bg-gray-50 p-4 rounded-xl">
                                <p class="text-sm text-gray-600 font-medium">ðŸ’¡ Recommendation:</p>
                                <p id="scan-suggestion" class="text-sm text-gray-500 mt-1">Add the missing keywords to
                                    your resume to pass the ATS bots!</p>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <div id="course-list" class="hidden fade-in max-w-7xl mx-auto px-4 sm:px-6 py-8">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-bold text-gray-800 mb-4">All Courses</h2>
                <p class="text-xl text-gray-600">Choose from our comprehensive course catalog</p>
            </div>

            <div class="mb-8 flex justify-center">
                <div class="course-filter bg-white rounded-full shadow-lg">
                    <button onclick="filterCourses('all')"
                        class="language-filter active px-6 py-2 rounded-full transition-all">All</button>
                    <button onclick="filterCourses('programming')"
                        class="language-filter px-6 py-2 rounded-full transition-all">Programming</button>
                    <button onclick="filterCourses('design')"
                        class="language-filter px-6 py-2 rounded-full transition-all">Design</button>
                    <button onclick="filterCourses('business')"
                        class="language-filter px-6 py-2 rounded-full transition-all">Business</button>
                    <button onclick="filterCourses('data')"
                        class="language-filter px-6 py-2 rounded-full transition-all">Data
                        Science</button>
                </div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-8" id="courses-container"></div>
        </div>

        <div id="certificates-screen" class="hidden fade-in max-w-7xl mx-auto px-4 sm:px-6 py-8">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-bold text-gray-800 mb-4">My Certificates</h2>
                <p class="text-xl text-gray-600">Your achievements and certifications</p>
            </div>
            <div id="certificates-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
            </div>
        </div>

        <div id="course-detail" class="hidden fade-in">
            <!-- <button onclick="showCourseList()"
                class="mb-4  ml-1 bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700">â†
                Back to Courses</button> -->
            <div id="course-detail-content"></div>
        </div>

        <div id="profile-screen" class="hidden fade-in max-w-7xl mx-auto px-4 sm:px-6 py-8">
            <h2 class="text-3xl font-bold text-center mb-8">My Courses</h2>
            <div id="enrolled-courses" class="flex flex-wrap gap-4 justify-center">
            </div>
        </div>

        <div id="certificate-screen" class="hidden fade-in">
            <div class="max-w-4xl mx-auto">
                <button onclick="showProfile()"
                    class="mb-4 bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700">â†
                    Back to My
                    Courses</button>

                <div class="certificate-border-wrapper">
                    <div id="certificate-content" class="certificate-container text-gray-800 text-center relative">
                        <div class="watermark"></div>

                    </div>
                </div>

                <div
                    class="text-center bg-red-100 border-2 border-red-500 text-red-700 p-4 rounded-lg shadow-md mb-6 mt-6 animate-pulse">
                    <div class="flex items-center justify-center space-x-3">
                        <i class="fa-solid fa-triangle-exclamation text-xl"></i>
                        <h3 class="text-lg font-extrabold">MANDATORY DOWNLOAD WARNING</h3>
                    </div>
                    <p class="mt-2 text-md font-semibold">
                        Please **DOWNLOAD THE CERTIFICATE** in **DESKTOP MODE** or from a **DESKTOP/LAPTOP** device.
                    </p>
                    <p class="text-sm">
                        This ensures correct alignment and high-quality formatting for your official document.
                    </p>
                </div>
                <div class="text-center">
                    <button onclick="downloadCurrentCertificate('png')"
                        class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 text-lg">Download
                        Certificate (PNG)</button>
                </div>
            </div>
        </div>


        <div id="admin-dashboard-panel" class="hidden fade-in">
            <div class="min-h-screen flex flex-col">
                <header class="bg-white shadow-md z-10">
                    <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 flex justify-between items-center">
                        <h1 class="text-3xl font-bold text-gray-900 slide-in">Admin Enrollment Dashboard ðŸ”‘</h1>
                        <div class="text-sm text-gray-500">
                            Last Refreshed: <span id="last-updated"
                                class="font-semibold text-blue-600">Loading...</span>
                        </div>
                    </div>

                </header>
                <main class="flex-1 p-4 sm:p-6 lg:p-8 max-w-7xl mx-auto w-full">
                    <div id="admin-stats-view">

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div id="card-total-students"
                                class="card-animation bg-white p-6 rounded-xl shadow-lg border-l-4 border-blue-600">
                                <div class="flex items-center justify-between">
                                    <div class="text-sm font-medium text-gray-500">Total Student Accounts</div>
                                    <svg class="h-6 w-6 text-blue-400" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M17 20h5v-4h-5v4zm0 0l-1.336-1.336m1.336 1.336H3m3-4H2m3 4v-4m3 4v-4m3 4v-4m3 4v-4m3 4v-4m-3 4V4m3 16V4m-3 0h5m-5 0H3m3 0h12" />
                                    </svg>
                                </div>
                                <p class="text-4xl font-extrabold text-gray-900 mt-1"><span
                                        id="metric-total-students">0</span>
                                </p>
                            </div>
                            <div id="card-total-active-users"
                                class="card-animation bg-white p-6 rounded-xl shadow-lg border-l-4 border-red-600">
                                <div class="flex items-center justify-between">
                                    <div class="text-sm font-medium text-gray-500">Total Active Users</div>
                                    <svg class="h-6 w-6 text-red-400" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M13 10V3L4 14h7v7l9-11h-7z" />
                                    </svg>
                                </div>
                                <p class="text-4xl font-extrabold text-gray-900 mt-1"><span
                                        id="metric-total-active-users">0</span></p>
                            </div>
                            <div id="card-total-certificates"
                                class="card-animation bg-white p-6 rounded-xl shadow-lg border-l-4 border-green-600">
                                <div class="flex items-center justify-between">
                                    <div class="text-sm font-medium text-gray-500">Courses Completed (Certified)</div>
                                    <svg class="h-6 w-6 text-green-400" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.01 12.01 0 002.5 14c0 1.491.31 2.923.863 4.264m18.774-11.28A12.01 12.01 0 0021.5 14c0 1.491-.31 2.923-.863 4.264M18 18h-4.264l-.5-1.5-.5 1.5H6m12 0a2 2 0 100 4 2 2 0 000-4z" />
                                    </svg>
                                </div>
                                <p class="text-4xl font-extrabold text-gray-900 mt-1"><span
                                        id="metric-total-certificates">0</span></p>
                            </div>

                            <div class="card-animation bg-white p-6 rounded-xl shadow-lg border-l-4 border-pink-600">
                                <div class="flex items-center justify-between">
                                    <div class="text-sm font-medium text-gray-500">Total Interns Enrolled</div>
                                    <div class="h-6 w-6 text-pink-500">
                                        <i class="fa-solid fa-briefcase text-xl"></i>
                                    </div>
                                </div>
                                <p class="text-4xl font-extrabold text-gray-900 mt-1">
                                    <span id="metric-total-interns">0</span>
                                </p>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 gap-6 mb-8">
                            <div class="bg-white p-6 rounded-xl shadow-lg card-animation w-full">
                                <h2 class="text-xl font-semibold text-gray-800 mb-4">Course Enrollment Distribution
                                    (Live
                                    Data)
                                </h2>
                                <div style="height: 300px;">
                                    <canvas id="courseChart"></canvas>
                                </div>
                            </div>
                            <div
                                class="bg-white p-6 rounded-xl shadow-lg card-animation w-full grid grid-cols-1 md:grid-cols-4 gap-4">
                                <div>
                                    <label for="admin-student-search"
                                        class="block text-sm font-medium text-gray-700">Search
                                        Name/Email/Phone</label>
                                    <input type="text" id="admin-student-search" placeholder="E.g., Alice Johnson"
                                        class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:ring-blue-500 focus:border-blue-500 filter-transition">
                                </div>
                                <div>
                                    <label for="admin-course-filter"
                                        class="block text-sm font-medium text-gray-700">Filter
                                        by Course</label>
                                    <select id="admin-course-filter"
                                        class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:ring-blue-500 focus:border-blue-500 filter-transition bg-white">
                                        <option value="all">All Courses</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="admin-status-filter"
                                        class="block text-sm font-medium text-gray-700">Filter
                                        by Enrollment Status</label>
                                    <select id="admin-status-filter"
                                        class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:ring-blue-500 focus:border-blue-500 filter-transition bg-white">
                                        <option value="all">Any Status</option>
                                        <option value="true">Active (True)</option>
                                        <option value="false">Pending (False)</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="admin-online-filter"
                                        class="block text-sm font-medium text-gray-700">Filter
                                        by Online Status</label>
                                    <select id="admin-online-filter"
                                        class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:ring-blue-500 focus:border-blue-500 filter-transition bg-white">
                                        <option value="all">All</option>
                                        <option value="online">Online</option>
                                        <option value="offline">Offline</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-xl shadow-lg card-animation">
                            <h2 class="text-xl font-semibold text-gray-800 mb-4">
                                Student Enrollment Records
                                <span id="approval-metrics" class="ml-4 text-sm font-normal text-gray-600">
                                    (Active: <span id="metric-approvals" class="font-semibold text-green-600">0</span> /
                                    Pending: <span id="metric-revokes" class="font-semibold text-orange-600">0</span>)
                                </span>
                            </h2>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead>
                                        <tr class="bg-gray-50">
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                Student Name</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                Email</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                Course Title</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                Status</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="admin-table-body" class="bg-white divide-y divide-gray-200">
                                    </tbody>
                                </table>
                                <div id="admin-no-results" class="hidden text-center py-8 text-gray-500">No enrollment
                                    records found matching the criteria.</div>
                            </div>
                            <div class="flex justify-between items-center mt-4">
                                <div class="flex space-x-2">
                                    <button onclick="handlePagination('prev')"
                                        class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg text-sm hover:bg-gray-300 transition-colors hidden"
                                        id="prev-page-btn">â†</button>
                                    <button onclick="handlePagination('next')"
                                        class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg text-sm hover:bg-gray-300 transition-colors hidden"
                                        id="next-page-btn">â†’</button>
                                </div>
                                <span class="text-sm text-gray-600" id="pagination-info">Displaying 0 records</span>
                            </div>
                        </div>

                    </div>

                    <div id="admin-jobs-view" class="hidden fade-in space-y-6">

                        <div
                            class="flex justify-between items-center bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                            <div>
                                <h2 class="text-xl font-bold text-gray-800">Job Board Management</h2>
                                <p class="text-sm text-gray-500">Manage your job listings below.</p>
                            </div>
                            <div class="flex gap-3">
                                <button onclick="toggleAdminView('dashboard')"
                                    class="bg-gray-100 text-gray-700 px-4 py-2 rounded-lg font-semibold hover:bg-gray-200">
                                    â† Back Stats
                                </button>
                                <button onclick="openPostJobModal()"
                                    class="bg-green-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-green-700 shadow-md">
                                    + Post New Job
                                </button>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-gray-200">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th
                                            class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">
                                            Role & Company</th>
                                        <th
                                            class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">
                                            Type & Salary</th>
                                        <th
                                            class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">
                                            Link</th>
                                        <th
                                            class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">
                                            Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="admin-jobs-table-body" class="bg-white divide-y divide-gray-200">
                                </tbody>
                            </table>
                            <div id="admin-no-jobs-msg" class="hidden text-center py-10">
                                <p class="text-gray-500 text-lg">No jobs posted yet.</p>
                            </div>
                        </div>
                    </div>

                    <div id="admin-courses-view" class="hidden fade-in space-y-6">

                        <div
                            class="flex justify-between items-center bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                            <div>
                                <h2 class="text-xl font-bold text-gray-800">Course Management</h2>
                                <p class="text-sm text-gray-500">Create, Edit, and Manage your curriculum content.</p>
                            </div>
                            <div class="flex gap-3">
                                <button onclick="toggleAdminView('dashboard')"
                                    class="bg-gray-100 text-gray-700 px-4 py-2 rounded-lg font-semibold hover:bg-gray-200">
                                    â† Back Stats
                                </button>
                                <button onclick="openPostCourseModal()"
                                    class="bg-indigo-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-indigo-700 shadow-md">
                                    + Add New Course
                                </button>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-gray-200">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">Course
                                        </th>
                                        <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">
                                            Pricing</th>
                                        <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">
                                            Category</th>
                                        <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">
                                            Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="admin-courses-table-body" class="bg-white divide-y divide-gray-200">
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div id="admin-post-course-modal"
                        class="hidden fixed inset-0 z-[10000] flex items-center justify-center bg-black/60 backdrop-blur-sm">
                        <div
                            class="bg-white w-full max-w-3xl p-8 rounded-2xl shadow-2xl relative max-h-[90vh] overflow-y-auto">

                            <div class="flex justify-between items-center mb-6 border-b pb-4">
                                <h2 id="course-modal-title" class="text-2xl font-bold text-gray-900">Add New Course</h2>
                                <button onclick="closeCourseModal()" class="text-gray-400 hover:text-red-500">
                                    <i class="fa-solid fa-xmark text-2xl"></i>
                                </button>
                            </div>

                            <form id="post-course-form" onsubmit="handlePostOrUpdateCourse(event)" class="space-y-5">

                                <input type="hidden" id="is-edit-course" value="false">

                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-bold text-gray-700 mb-1">Course ID
                                            (Unique)</label>
                                        <input type="text" id="course-id" required placeholder="e.g. python_mastery"
                                            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none font-mono text-sm">
                                        <p class="text-xs text-gray-400 mt-1">Cannot be changed later.</p>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-bold text-gray-700 mb-1">Course Name</label>
                                        <input type="text" id="course-title" required
                                            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                                    </div>
                                </div>

                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-bold text-gray-700 mb-1">Image URL</label>
                                        <input type="url" id="course-image" required placeholder="https://..."
                                            class="w-full px-4 py-2 border rounded-lg outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-bold text-gray-700 mb-1">Level</label>
                                        <select id="course-level" class="w-full px-4 py-2 border rounded-lg bg-white">
                                            <option value="Beginner">Beginner</option>
                                            <option value="Intermediate">Intermediate</option>
                                            <option value="Advanced">Advanced</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="grid grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-sm font-bold text-gray-700 mb-1">Price
                                            (Display)</label>
                                        <input type="text" id="course-price" required placeholder="â‚¹499"
                                            class="w-full px-4 py-2 border rounded-lg outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-bold text-gray-700 mb-1">Original Price</label>
                                        <input type="text" id="course-orig-price" required placeholder="â‚¹2999"
                                            class="w-full px-4 py-2 border rounded-lg outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-bold text-gray-700 mb-1">Category</label>
                                        <select id="course-category"
                                            class="w-full px-4 py-2 border rounded-lg bg-white">
                                            <option value="programming">Programming</option>
                                            <option value="design">Design</option>
                                            <option value="business">Business</option>
                                            <option value="data">Data Science</option>
                                        </select>
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-1">Description</label>
                                    <textarea id="course-desc" rows="2"
                                        class="w-full px-4 py-2 border rounded-lg outline-none"></textarea>
                                </div>

                                <div class="bg-gray-50 p-4 rounded-xl border border-gray-200">
                                    <div class="flex justify-between items-center mb-3">
                                        <h3 class="font-bold text-gray-800">Curriculum Modules</h3>
                                        <button type="button" onclick="addCurriculumField()"
                                            class="text-indigo-600 text-sm font-bold hover:underline">+ Add
                                            Module</button>
                                    </div>

                                    <div id="curriculum-container" class="space-y-3 max-h-48 overflow-y-auto pr-2">
                                    </div>
                                </div>

                                <div class="flex justify-end gap-3 pt-4 border-t">
                                    <button type="button" onclick="closeCourseModal()"
                                        class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg">Cancel</button>
                                    <button type="submit" id="course-submit-btn"
                                        class="bg-indigo-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-indigo-700 shadow-md">Publish
                                        Course</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <div id="admin-post-job-modal"
                        class="hidden fixed inset-0 z-[10000] flex items-center justify-center bg-black/60 backdrop-blur-sm">
                        <div
                            class="bg-white w-full max-w-2xl p-8 rounded-2xl shadow-2xl relative max-h-[90vh] overflow-y-auto">

                            <div class="flex justify-between items-center mb-6 border-b pb-4">
                                <h2 id="modal-title" class="text-2xl font-bold text-gray-900">Post New Opportunity</h2>
                                <button onclick="closeJobModal()" class="text-gray-400 hover:text-red-500">
                                    <i class="fa-solid fa-xmark text-2xl"></i>
                                </button>
                            </div>

                            <form id="post-job-form" onsubmit="handlePostOrUpdateJob(event)" class="space-y-4">

                                <input type="hidden" id="edit-job-id">

                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-bold text-gray-700 mb-1">Job Role</label>
                                        <input type="text" id="job-role" required
                                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-bold text-gray-700 mb-1">Company Name</label>
                                        <input type="text" id="job-company" required
                                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                                    </div>
                                </div>

                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-bold text-gray-700 mb-1">Job Link (URL)</label>
                                        <input type="url" id="job-url" required placeholder="https://..."
                                            class="w-full px-4 py-2 border border-gray-300 rounded-lg outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-bold text-gray-700 mb-1">Location</label>
                                        <input type="text" id="job-location" required placeholder="City or Remote"
                                            class="w-full px-4 py-2 border border-gray-300 rounded-lg outline-none">
                                    </div>
                                </div>

                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-bold text-gray-700 mb-1">Experience</label>
                                        <input type="text" id="job-experience" required placeholder="e.g. 2 Years"
                                            class="w-full px-4 py-2 border border-gray-300 rounded-lg outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-bold text-gray-700 mb-1">Work Type</label>
                                        <select id="job-type"
                                            class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-white">
                                            <option value="Remote">Remote</option>
                                            <option value="Hybrid">Hybrid</option>
                                            <option value="On-site">On-site</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-bold text-gray-700 mb-1">Salary Text</label>
                                        <input type="text" id="job-salary" required placeholder="e.g. $100k"
                                            class="w-full px-4 py-2 border border-gray-300 rounded-lg outline-none">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-bold text-gray-700 mb-1">Min Salary
                                            (Number)</label>
                                        <input type="number" id="job-salary-val" required placeholder="e.g. 100000"
                                            class="w-full px-4 py-2 border border-gray-300 rounded-lg outline-none">
                                    </div>
                                </div>

                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-bold text-gray-700 mb-1">Category</label>
                                        <select id="job-category"
                                            class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-white">
                                            <option value="Frontend">Frontend</option>
                                            <option value="Backend">Backend</option>
                                            <option value="FullStack">Full Stack</option>
                                            <option value="Design">Design</option>
                                            <option value="DevOps">DevOps</option>
                                            <option value="AI">AI / ML</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-bold text-gray-700 mb-1">Tags</label>
                                        <input type="text" id="job-tags" placeholder="Java, React"
                                            class="w-full px-4 py-2 border border-gray-300 rounded-lg outline-none">
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-1">Description</label>
                                    <textarea id="job-description" rows="3"
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg outline-none"></textarea>
                                </div>

                                <div class="flex justify-end gap-3 mt-8 pt-4 border-t">
                                    <button type="button" onclick="closeJobModal()"
                                        class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg font-medium">Cancel</button>
                                    <button type="submit" id="modal-submit-btn"
                                        class="bg-indigo-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-indigo-700 shadow-md">Post
                                        Job</button>
                                </div>
                            </form>
                        </div>
                    </div>


                </main>
            </div>
        </div>
    </div>

    <div id="admin-user-details-modal" class="modal hidden">
        <div class="modal-content w-full max-w-xl admin-profile-card">
            <div class="flex justify-between items-center pb-4 mb-4 border-b border-indigo-200">
                <h2 class="text-3xl font-extrabold text-indigo-900" id="modal-user-name">Student Details</h2>
                <button onclick="closeAdminUserDetails()"
                    class="text-gray-500 hover:text-red-700 p-2 rounded-full hover:bg-red-50">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>

            <div id="modal-user-info" class="p-4 bg-indigo-50 rounded-xl shadow-inner mb-6 space-y-2 text-gray-700">
            </div>

            <div class="mt-6 flex justify-between space-x-3 pt-4">
                <button id="disable-user-btn"
                    onclick="toggleUserDisableStatus(document.getElementById('admin-user-details-modal').getAttribute('data-user-id'))"
                    class="bg-yellow-500 text-gray-900 px-4 py-2 rounded-lg text-sm hover:bg-yellow-600 transition-colors flex-1 shadow-md">Disable
                    User</button>
                <button id="delete-user-btn"
                    onclick="deleteUserPermanently(document.getElementById('admin-user-details-modal').getAttribute('data-user-id'))"
                    class="bg-red-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-red-700 transition-colors flex-1 shadow-md">Delete
                    User Permanently</button>
            </div>
            <div class="mt-8">
                <h3 class="text-xl font-bold text-gray-800 border-b pb-2 mb-4 flex items-center">
                    <span class="mr-2 text-indigo-600">ðŸ“š</span> Enrolled Courses (<span
                        id="modal-enrolled-count">0</span>)
                </h3>
                <div id="modal-course-list" class="space-y-3">
                </div>
            </div>
        </div>
    </div>
    <div id="notification-modal" class="modal hidden">
        <div class="modal-content w-full max-w-lg bg-white p-6 rounded-xl shadow-2xl border-t-8 border-yellow-500">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                    <span class="mr-3 text-yellow-600">ðŸ“¢</span> Global Announcement
                </h2>
                <button onclick="closeNotificationPopup()" class="text-gray-500 hover:text-gray-900">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>
            <div id="notification-content" class="bg-yellow-50 p-4 rounded-lg text-yellow-900 border border-yellow-200">
                <p class="font-medium text-lg">No active announcements.</p>
            </div>
            <p class="text-xs text-gray-500 mt-4 text-right">Last updated: <span id="notification-timestamp">N/A</span>
            </p>
        </div>
    </div>

    <div id="course-wrapper" class="hidden fixed inset-0 w-full h-full bg-white z-[999] flex flex-col overflow-hidden">

        <!-- NAVBAR -->
        <nav class="bg-gray-800 p-3 text-white shadow-lg flex justify-between items-center z-10">

            <!-- LEFT -->
            <div class="flex items-center gap-3">
                <span class="text-lg font-bold">PROGMASTER Learning</span>
                <span id="integrated-course-title" class="text-sm text-gray-500"></span>
            </div>

            <!-- RIGHT FOR DESKTOP -->
            <div class="hidden md:flex items-center gap-3">
                <button id="integrated-completion-button" class="bg-gray-300 text-white font-semibold py-2 px-4 rounded-lg transition
                       disabled:opacity-50 disabled:cursor-not-allowed">
                    Loading...
                </button>

                <button onclick="endLearningSession()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4
                       rounded-lg transition">
                    â† Dashboard
                </button>
            </div>

            <!-- MOBILE MENU BUTTON (3 dots) -->
            <button id="mobile-menu-btn" class="md:hidden p-2 rounded-lg border border-white-300 text-white-1000">
                â‹®
            </button>
        </nav>

        <!-- MOBILE MENU DROPDOWN -->
        <div id="mobile-menu"
            class="hidden md:hidden absolute right-4 top-16 bg-white shadow-lg rounded-lg border p-3 space-y-2 z-[9999]">

            <button id="integrated-completion-button-mobile" class="bg-gray-300 w-full text-white font-semibold py-2 px-4 rounded-lg transition
                   disabled:opacity-50 disabled:cursor-not-allowed">
                Loading...
            </button>

            <button onclick="endLearningSession()" class="bg-indigo-600 hover:bg-indigo-700 w-full text-white font-semibold py-2 px-4
                   rounded-lg transition">
                â† Dashboard
            </button>
        </div>

        <!-- IFRAME -->
        <iframe id="integrated-course-iframe" class="flex-grow w-full h-full border-none"></iframe>

        <!-- LOADING SCREEN -->
        <div id="integrated-loading-screen" class="absolute inset-0 flex flex-col items-center justify-center
                bg-white/90 backdrop-blur-sm">

            <h1 class="text-3xl font-bold text-indigo-600 mb-3">Validating Session...</h1>
            <p class="text-gray-600 text-lg">Preparing course environment securely</p>
        </div>
    </div>

    <button onclick="document.getElementById('subscription-modal').classList.remove('hidden')"
        class="fixed bottom-6 right-6 z-40 bg-pink-600 text-white p-4 rounded-full shadow-2xl hover:bg-pink-700 transition-all duration-300 transform hover:scale-105 flex items-center space-x-2 animate-bounce">
        <i class="fa-solid fa-crown text-2xl"></i>
        <span class="text-lg font-bold hidden sm:inline">All-Access Pass: â‚¹1500!</span>
    </button>


    <a href="https://wa.me/919876543210" target="_blank" style="bottom: 35px;"
        onclick="document.getElementById('subscription-modal').classList.remove('hidden')"
        class="fixed bottom-6 left-6 z-40 bg-green-500 text-white p-4 rounded-full shadow-2xl hover:bg-pink-700 transition-all duration-150 transform hover:scale-105 flex items-center space-x-2 animate-bounce"
        aria-label="Chat with us on WhatsApp">
        <span class="text-lg font-bold hidden sm:inline">DM To Us!</span>
        <i class="fa-brands fa-whatsapp text-3xl"></i>
    </a>

    <div id="daily-challenge-modal"
        class="hidden fixed inset-0 z-[11000] flex items-center justify-center bg-black/80 backdrop-blur-md fade-in">
        <div
            class="bg-white w-full max-w-lg p-0 rounded-2xl shadow-2xl relative overflow-hidden transform scale-100 transition-transform">

            <div class="bg-gradient-to-r from-orange-500 to-red-600 p-6 text-white text-center relative">
                <div
                    class="absolute top-0 left-0 w-full h-full opacity-20 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]">
                </div>
                <h2 class="text-3xl font-extrabold relative z-10 flex justify-center items-center gap-3">
                    <i class="fa-solid fa-fire animate-bounce"></i> Daily Challenge
                </h2>
                <p class="text-orange-100 text-sm mt-1 relative z-10">Solve this to keep your streak alive!</p>
            </div>

            <div class="p-8">
                <div class="mb-6">
                    <span
                        class="bg-blue-100 text-blue-700 text-xs font-bold px-2 py-1 rounded uppercase mb-2 inline-block"
                        id="challenge-topic">JavaScript</span>
                    <p class="text-lg font-bold text-gray-800" id="challenge-question">Loading Question...</p>
                    <div class="mt-3 bg-gray-900 rounded-lg p-4 font-mono text-sm text-green-400 overflow-x-auto border-l-4 border-green-500 shadow-inner"
                        id="challenge-code">
                    </div>
                </div>

                <div id="challenge-options" class="space-y-3">
                </div>

                <div id="challenge-feedback" class="mt-4 text-center font-bold hidden"></div>

                <button onclick="submitDailyChallenge()" id="challenge-submit-btn"
                    class="w-full mt-6 bg-gray-900 text-white py-3 rounded-xl font-bold hover:bg-gray-800 transition-all shadow-lg text-lg">
                    Check Answer ðŸš€
                </button>
            </div>
        </div>
    </div>



    <div id="scanner-info-modal"
        class="hidden fixed inset-0 z-[11000] flex items-center justify-center bg-black/60 backdrop-blur-sm fade-in">
        <div class="bg-white w-full max-w-2xl p-8 rounded-3xl shadow-2xl relative mx-4 relative overflow-hidden">

            <div class="absolute top-0 right-0 w-32 h-32 bg-indigo-100 rounded-bl-full -mr-8 -mt-8 opacity-50"></div>

            <div class="flex justify-between items-start mb-6 relative z-10">
                <div>
                    <h2 class="text-3xl font-extrabold text-gray-900">Why use this tool?</h2>
                    <p class="text-gray-500 mt-1">Unlock more interviews with the power of keywords.</p>
                </div>
                <button onclick="closeScannerInfo()"
                    class="text-gray-400 hover:text-gray-600 transition-colors bg-gray-100 p-2 rounded-full">
                    <i class="fa-solid fa-xmark text-xl"></i>
                </button>
            </div>

            <div class="grid md:grid-cols-2 gap-6 relative z-10">

                <div class="bg-blue-50 p-5 rounded-2xl border border-blue-100">
                    <div
                        class="w-10 h-10 bg-blue-100 text-blue-600 rounded-lg flex items-center justify-center text-xl mb-3">
                        <i class="fa-solid fa-robot"></i>
                    </div>
                    <h3 class="font-bold text-gray-900 mb-1">Beat the ATS Bots</h3>
                    <p class="text-sm text-gray-600 leading-relaxed">
                        75% of resumes are rejected by Applicant Tracking Systems (ATS) before a human ever sees them.
                        This tool ensures you pass the filter.
                    </p>
                </div>

                <div class="bg-green-50 p-5 rounded-2xl border border-green-100">
                    <div
                        class="w-10 h-10 bg-green-100 text-green-600 rounded-lg flex items-center justify-center text-xl mb-3">
                        <i class="fa-solid fa-check-double"></i>
                    </div>
                    <h3 class="font-bold text-gray-900 mb-1">Instant Skill Check</h3>
                    <p class="text-sm text-gray-600 leading-relaxed">
                        Don't guess what the recruiter wants. We scan the job description and tell you exactly which
                        skills (e.g., "React", "AWS") you are missing.
                    </p>
                </div>

                <div class="bg-purple-50 p-5 rounded-2xl border border-purple-100">
                    <div
                        class="w-10 h-10 bg-purple-100 text-purple-600 rounded-lg flex items-center justify-center text-xl mb-3">
                        <i class="fa-solid fa-bullseye"></i>
                    </div>
                    <h3 class="font-bold text-gray-900 mb-1">Increase Relevance</h3>
                    <p class="text-sm text-gray-600 leading-relaxed">
                        Generic resumes get ignored. Tailoring your resume keywords to the specific job description
                        increases your interview chances by 3x.
                    </p>
                </div>

                <div class="bg-orange-50 p-5 rounded-2xl border border-orange-100">
                    <div
                        class="w-10 h-10 bg-orange-100 text-orange-600 rounded-lg flex items-center justify-center text-xl mb-3">
                        <i class="fa-solid fa-chart-line"></i>
                    </div>
                    <h3 class="font-bold text-gray-900 mb-1">Smart Scoring</h3>
                    <p class="text-sm text-gray-600 leading-relaxed">
                        Get a concrete "Match Score" (0-100%). Aim for 80%+ to know you are ready to hit "Apply" with
                        confidence.
                    </p>
                </div>

            </div>

            <button onclick="closeScannerInfo()"
                class="w-full mt-8 bg-gray-900 text-white py-3 rounded-xl font-bold hover:bg-gray-800 transition-all shadow-lg">
                Got it, Let's Analyze! ðŸš€
            </button>
        </div>
    </div>



    <div id="internship-selection-modal"
        class="hidden fixed inset-0 z-[10000] flex items-center justify-center bg-black/60 backdrop-blur-sm fade-in">
        <div class="bg-white w-full max-w-5xl p-8 rounded-3xl shadow-2xl relative mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-8">
                <div>
                    <h2 class="text-3xl font-extrabold text-gray-900">Select Internship Domain</h2>
                    <p class="text-gray-500">Choose a specialization to start your 1-3 month industrial training.</p>
                </div>
                <button onclick="closeInternshipSelection()" class="text-gray-400 hover:text-red-500"><i
                        class="fa-solid fa-xmark text-2xl"></i></button>
            </div>
            <div id="internship-domain-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            </div>
        </div>
    </div>

    <div id="internship-task-screen" class="hidden fade-in min-h-screen bg-slate-50 pb-20">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 py-8">
            <div class="flex justify-between items-center mb-8">
                <button onclick="showWelcomeScreen()" class="text-gray-500 hover:text-indigo-600 font-bold"><i
                        class="fa-solid fa-arrow-left"></i> Home</button>
                <h2 class="text-2xl font-bold text-gray-900" id="internship-active-title">Internship Dashboard</h2>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
                <div class="lg:col-span-1 bg-white p-6 rounded-2xl shadow-sm border border-gray-200 h-fit">
                    <h3 class="font-bold text-gray-800 mb-4 uppercase text-sm tracking-wider">Project Roadmap</h3>
                    <div id="internship-steps-list" class="space-y-2">
                    </div>
                </div>

                <div class="lg:col-span-3">
                    <div id="internship-content-card" class="bg-white p-8 rounded-2xl shadow-lg border border-gray-200">
                    </div>

                    <div class="flex justify-between mt-6">
                        <button id="btn-prev-task" onclick="navigateTask(-1)"
                            class="bg-gray-200 text-gray-700 px-6 py-3 rounded-xl font-bold hover:bg-gray-300 disabled:opacity-50">Previous</button>
                        <button id="btn-next-task" onclick="navigateTask(1)"
                            class="bg-indigo-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-indigo-700 shadow-lg disabled:opacity-50">Next
                            Task</button>
                        <button id="btn-finish-internship" onclick="openCertificateDateModal()"
                            class="hidden bg-green-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-green-700 shadow-lg animate-pulse">Generate
                            Certificate ðŸ†</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="internship-detail-screen" class="hidden fade-in min-h-screen bg-[#F8F9FC] pb-20">
        <div class="relative bg-slate-900 text-white pt-20 pb-24 px-6">
            <div class="relative max-w-7xl mx-auto z-10">
                <button onclick="showInternships()"
                    class="mb-6 flex items-center text-gray-400 hover:text-white transition-colors text-sm font-semibold">
                    <i class="fa-solid fa-arrow-left mr-2"></i> Back to Internships
                </button>
                <span
                    class="bg-pink-600 px-3 py-1 rounded text-xs font-bold uppercase tracking-wide mb-4 inline-block">Industrial
                    Training</span>
                <h1 class="text-3xl md:text-5xl font-extrabold mb-4 leading-tight" id="int-detail-title">Loading...</h1>
                <p class="text-gray-300 text-lg max-w-2xl mb-6" id="int-detail-desc">Loading...</p>
            </div>
        </div>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 -mt-16 relative z-20">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

                <div class="lg:col-span-2 space-y-6">
                    <div class="bg-white rounded-xl p-8 shadow-sm border border-gray-100">
                        <h3 class="text-xl font-bold text-gray-900 mb-4">What you will do</h3>
                        <ul class="space-y-3 text-gray-600" id="int-detail-features">
                        </ul>
                    </div>
                </div>

                <div class="lg:col-span-1">
                    <div class="bg-white border border-gray-200 rounded-xl p-6 shadow-lg sticky top-24">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="text-3xl font-extrabold text-gray-900" id="int-detail-price">â‚¹1500</span>
                            <span
                                class="text-lg text-gray-400 line-through decoration-red-500 decoration-2">â‚¹4999</span>
                        </div>

                        <div id="int-action-container">
                        </div>

                        <div class="mt-4 space-y-3 text-sm text-gray-600 border-t pt-4">
                            <div class="flex items-center gap-3"><i
                                    class="fa-solid fa-calendar-check text-pink-500"></i> 1-3 Months Duration</div>
                            <div class="flex items-center gap-3"><i class="fa-solid fa-certificate text-pink-500"></i>
                                Internship Certificate</div>
                            <div class="flex items-center gap-3"><i class="fa-solid fa-laptop-code text-pink-500"></i> 5
                                Real-time Projects</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="internship-date-modal"
        class="hidden fixed inset-0 z-[11000] flex items-center justify-center bg-black/60 backdrop-blur-sm">
        <div class="bg-white w-full max-w-md p-8 rounded-2xl shadow-2xl relative mx-4">
            <h3 class="text-2xl font-bold text-gray-900 mb-2">Internship Certificate</h3>
            <p class="text-sm text-gray-500 mb-6">You can customize the dates to match your college requirements, or use
                today's date.</p>

            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">Start Date (Optional)</label>
                    <input type="date" id="cert-start-date"
                        class="w-full border rounded-lg p-3 outline-none focus:ring-2 focus:ring-pink-500">
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">End Date (Optional)</label>
                    <input type="date" id="cert-end-date"
                        class="w-full border rounded-lg p-3 outline-none focus:ring-2 focus:ring-pink-500">
                </div>
                <div id="date-error-msg" class="text-red-500 text-xs font-bold hidden"></div>
            </div>

            <div class="mt-6 space-y-3">
                <button onclick="generateInternshipCertificate('custom')"
                    class="w-full bg-pink-600 text-white py-3 rounded-xl font-bold hover:bg-pink-700 shadow-lg">
                    Download with Custom Dates
                </button>

                <div class="relative flex py-1 items-center">
                    <div class="flex-grow border-t border-gray-300"></div>
                    <span class="flex-shrink-0 mx-4 text-gray-400 text-xs">OR</span>
                    <div class="flex-grow border-t border-gray-300"></div>
                </div>

                <button onclick="generateInternshipCertificate('default')"
                    class="w-full bg-gray-100 text-gray-700 py-3 rounded-xl font-bold hover:bg-gray-200">
                    Skip & Download (Default Dates)
                </button>
            </div>

            <button onclick="document.getElementById('internship-date-modal').classList.add('hidden')"
                class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                <i class="fa-solid fa-xmark text-xl"></i>
            </button>
        </div>
    </div>

    <div id="verification-modal"
        class="hidden fixed inset-0 z-[12000] flex items-center justify-center bg-black/80 backdrop-blur-md p-4">
        <div class="bg-white w-full max-w-md rounded-2xl shadow-2xl overflow-hidden relative animate-bounce-in">

            <div class="bg-green-600 p-6 text-center">
                <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center mx-auto mb-3 shadow-lg">
                    <i class="fa-solid fa-check-double text-3xl text-green-600"></i>
                </div>
                <h2 class="text-2xl font-extrabold text-white">Verified Certificate</h2>
                <p class="text-green-100 text-sm">Official Record Found</p>
            </div>

            <div class="p-6 space-y-4">
                <div class="text-center mb-4">
                    <p class="text-gray-500 text-xs uppercase tracking-wide">Certificate Holder</p>
                    <h3 class="text-xl font-bold text-gray-900" id="verify-name">Loading...</h3>
                </div>

                <div class="grid grid-cols-2 gap-4 text-sm">
                    <div class="bg-gray-50 p-3 rounded-lg border border-gray-100">
                        <p class="text-gray-500 text-xs">Reference ID</p>
                        <p class="font-mono font-bold text-indigo-600" id="verify-ref">...</p>
                    </div>
                    <div class="bg-gray-50 p-3 rounded-lg border border-gray-100">
                        <p class="text-gray-500 text-xs">Domain</p>
                        <p class="font-bold text-gray-800" id="verify-domain">...</p>
                    </div>
                </div>

                <div class="bg-gray-50 p-3 rounded-lg border border-gray-100">
                    <p class="text-gray-500 text-xs">Duration</p>
                    <p class="font-bold text-gray-800" id="verify-date">...</p>
                </div>

                <div class="bg-green-50 border border-green-200 p-3 rounded-lg flex items-start gap-3">
                    <i class="fa-solid fa-certificate text-green-600 mt-1"></i>
                    <p class="text-xs text-green-800 leading-relaxed">
                        This certifies that the student has successfully completed the internship program at
                        <strong>PROGMASTER PVT LTD</strong>.
                    </p>
                </div>
            </div>

            <div class="p-4 bg-gray-50 border-t text-center">
                <button onclick="closeVerificationModal()"
                    class="bg-gray-900 text-white px-6 py-2 rounded-lg font-bold hover:bg-black transition-colors w-full">Close
                    Verification</button>
            </div>
        </div>
    </div>


    <!-- <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-gray-200 mt-6">
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Name
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Email
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Program
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Status
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Actions
                        </th>
                    </tr>
                </thead>
                <tbody id="admin-table-body" class="bg-white divide-y divide-gray-200">
                </tbody>
            </table>
        </div>

        <div id="admin-no-results" class="hidden text-center py-10">
            <p class="text-gray-500 text-lg">No records found.</p>
        </div>

        <div class="flex justify-between items-center px-6 py-4 bg-gray-50 border-t">
            <span class="text-sm text-gray-600" id="pagination-info">Loading...</span>
            <div class="flex space-x-2">
                <button id="prev-page-btn" onclick="handlePagination('prev')"
                    class="hidden px-3 py-1 bg-gray-200 rounded text-sm">Previous</button>
                <button id="next-page-btn" onclick="handlePagination('next')"
                    class="hidden px-3 py-1 bg-gray-200 rounded text-sm">Next</button>
            </div>
        </div>
    </div> -->

    <script>
        // MOBILE MENU TOGGLE
        const mobileBtn = document.getElementById("mobile-menu-btn");
        const mobileMenu = document.getElementById("mobile-menu");

        mobileBtn.addEventListener("click", () => {
            mobileMenu.classList.toggle("hidden");
        });

        // Sync completion button
        const desktopBtn = document.getElementById("integrated-completion-button");
        const mobileBtnCompletion = document.getElementById("integrated-completion-button-mobile");

        // Mirror button state (loading/completed)
        const observer = new MutationObserver(() => {
            mobileBtnCompletion.textContent = desktopBtn.textContent;
            mobileBtnCompletion.disabled = desktopBtn.disabled;
        });

        observer.observe(desktopBtn, {
            attributes: true,
            childList: true
        });
    </script>
    <script>
        // **************************************************
        // *** 0. CORE UTILITY & GLOBAL VARS (DEFINED FIRST) ***
        // **************************************************

        // Application State
        let currentCourse = null;
        let currentUser = null;
        const PAYMENT_LINK = 'https://rzp.io/rzp/MdrDDje';
        const SUBSCRIPTION_PAYMENT_LINK = 'https://rzp.io/rzp/MdrDDje';
        let isAdminLoggedIn = false;
        const ADMIN_EMAIL = 'admin@edupro.com'; const ADMIN_PASSWORD = 'admin123';
        let courseChartInstance = null;

        // Pagination state
        const RECORDS_PER_PAGE = 20;
        let currentPage = 1;


        // --- EXTERNAL COURSE INTEGRATION VARIABLES ---
        const EXTERNAL_COURSE_URL = 'https://articulate.com/your-course-link-placeholder'; // Placeholder for Articulate Link
        let currentLearningUserId = null;
        let currentLearningCourseId = null;

        // **CRITICAL: Restore Timer Variables**
        const MINIMUM_TIME_SECONDS = 30; // 30 seconds for testing (5 min = 300)
        let integratedCompletionTimer = null;
        // --- END EXTERNAL COURSE INTEGRATION VARIABLES ---
        // NEW: Real-Time Tracking Variables (MOVED TO GLOBAL SCOPE TO FIX ERROR)
        let sessionStartTime = null;
        const ACTIVITY_LOG_PATH = 'edupro_users_activity';
        // Sample Data: COURSE IDs must be unique strings 
        // ==========================================
        // 1. COURSE DATABASE (Updated with Unique Prices & Images)
        // ==========================================

        const courseEnhancements = {
            // ID from Admin Panel  :  UI Details
            "web_dev": {
                thumbnail: "https://images.unsplash.com/photo-1593720213428-28a5b9e94613?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                price: "â‚¹499",
                originalPrice: "â‚¹2999",
                rating: 4.9,
                reviewCount: "2.4k",
                category: "programming"
            },
            "aws_cloud": {
                thumbnail: "https://images.unsplash.com/photo-1451187580459-43490279c0fa?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                price: "â‚¹699",
                originalPrice: "â‚¹3499",
                rating: 4.7,
                reviewCount: "1.8k",
                category: "programming"
            },
            // Add more mappings here as you add courses in Admin
            // Example:
            // "python_mastery": { thumbnail: "...", price: "â‚¹399", ... }
        };


        // Default fallback for courses without manual config
        const defaultEnhancement = {
            thumbnail: "https://images.unsplash.com/photo-1516321318423-f06f85e504b3?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            price: "â‚¹499",
            originalPrice: "â‚¹1999",
            rating: 4.5,
            reviewCount: "New",
            category: "programming"
        };

        // Global Courses Array (Populated from Firebase)
        let courses = [];

        // Firebase Configuration (Keep this section intact)
        const firebaseConfig = {
            apiKey: "AIzaSyBnQ0s1jFoMH6J7vhKVM7NVC-WNScLdA7E",
            authDomain: "sutherland-6ce2b.firebaseapp.com",
            databaseURL: "https://sutherland-6ce2b-default-rtdb.firebaseio.com",
            projectId: "sutherland-6ce2b",
            storageBucket: "sutherland-6ce2b.firebasestorage.app",
            messagingSenderId: "243800407888",
            appId: "1:243800407888:web:2c4dfa1e6a267ba2a17655",
            measurementId: "G-S6GMQ32JJ5"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        const storage = firebase.storage();

        // Data Storage
        let users = [];
        let certificates = [];
        let globalNotification = null;
        let currentUserId = null;


        // **************************************************
        // *** REAL-TIME ACTIVE TIME TRACKING UTILITIES (FIX FOR REFERENCE ERROR) ***
        // **************************************************

        function startSessionTimer() {
            // Start tracking time only if a user is logged in
            if (currentUserId) {
                sessionStartTime = Date.now();
            }
        }

        async function logSessionDuration() {
            if (!currentUserId || !sessionStartTime) return;

            const endTime = Date.now();
            // Calculate duration in minutes (round down)
            const durationMinutes = Math.floor((endTime - sessionStartTime) / (1000 * 60));

            // Reset the start time
            sessionStartTime = null;

            if (durationMinutes > 0) {
                const todayKey = new Date().toISOString().split('T')[0]; // Format: YYYY-MM-DD
                const userActivityRef = firebase.database().ref(`${ACTIVITY_LOG_PATH}/${currentUserId}/${todayKey}`);

                // Use a transaction to safely increment the total minutes for today
                await userActivityRef.transaction(currentMinutes => {
                    return (currentMinutes || 0) + durationMinutes;
                });

                console.log(`Logged ${durationMinutes} minutes for today.`);
            }
        }

        // *** CORE UTILITY FUNCTIONS ***

        function showLoader() {
            document.getElementById("global-loader").style.display = "flex";
        }

        function hideLoader() {
            document.getElementById("global-loader").style.display = "none";
        }

        // *** NEW SUBSCRIPTION CONSTANTS ***
        const SUBSCRIPTION_ID = 'SUBSCRIPTION';
        const SUBSCRIPTION_PRICE = 1500;

        function getCourseTitle(courseId) {
            if (courseId === SUBSCRIPTION_ID) return 'SUBSCRIPTION (All Access)';
            const course = courses.find(c => c.id === courseId);
            return course ? course.title : `Unknown Course (${courseId})`;
        }

        function isUserOnline(lastActiveTimestamp) {
            if (!lastActiveTimestamp) return false;
            const fiveMinutesAgo = Date.now() - (5 * 60 * 1000);
            return lastActiveTimestamp > fiveMinutesAgo;
        }

        function updateNotificationBadge() {
            const badge = document.getElementById('notification-badge');

            if (!currentUser || !globalNotification || !globalNotification.timestamp) {
                badge.classList.add('hidden');
                return;
            }

            const lastCheck = currentUser.last_notification_check || 0;

            if (globalNotification.timestamp > lastCheck) {
                badge.textContent = 'New!';
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }

        // ==========================================
        // ðŸ“Š MISSING ANALYTICS HELPER (PASTE THIS!)
        // ==========================================
        function timeSince(date) {
            if (!date) return "N/A";
            const seconds = Math.floor((new Date() - date) / 1000);

            let interval = seconds / 31536000; // Years
            if (interval > 1) return Math.floor(interval) + " years ago";

            interval = seconds / 2592000; // Months
            if (interval > 1) return Math.floor(interval) + " months ago";

            interval = seconds / 86400; // Days
            if (interval > 1) return Math.floor(interval) + " days ago";

            interval = seconds / 3600; // Hours
            if (interval > 1) return Math.floor(interval) + " hours ago";

            interval = seconds / 60; // Minutes
            if (interval > 1) return Math.floor(interval) + " mins ago";

            return "Just now";
        }

        function getCoursesRemaining() {
            const totalEnrolled = getEnrolledCourseCount();
            const userCertificates = certificates.filter(c => c.userId === currentUserId);
            const totalCertified = userCertificates.length;

            return Math.max(0, totalEnrolled - totalCertified);
        }

        // **************************************************
        // *** 1. SCREEN NAVIGATION FUNCTIONS ***
        // **************************************************

        function hideAllScreens() {
            const screens = [
                'welcome-screen', 'login-form', 'register-form', 'dashboard-screen',
                'course-list', 'course-detail', 'profile-screen', 'certificate-screen',
                'certificates-screen', 'admin-dashboard-panel', 'admin-login-screen',
                'admin-user-details-modal', 'my-account-screen', 'notification-modal',
                'course-wrapper', 'jobs-screen', 'roadmap-screen', 'resume-scanner-screen',
                'forum-screen' // <--- CRITICAL: Ensures Forum is hidden
            ];

            screens.forEach(id => {
                const element = document.getElementById(id);
                if (element) element.style.display = 'none';
            });

            document.body.style.backgroundColor = 'white';
        }
        // ** THE CORRECTED FUNCTION **
        function updateNav(isLoggedIn, isAdmin) {
            const navButtons = document.getElementById('nav-buttons');
            const userNav = document.getElementById('user-nav');
            const adminNav = document.getElementById('admin-nav');
            const totalNav = document.getElementById('total-nav');
            const blackLogo = document.getElementById('black-logo');
            const whiteLogo = document.getElementById('white-logo');

            // ** FIX 1: NAVBAR VISIBILITY **
            totalNav.style.display = 'flex';

            navButtons.style.display = 'none';
            userNav.style.display = 'none';
            adminNav.style.display = 'none';

            if (isAdmin) {
                adminNav.style.display = 'flex';
                totalNav.style.backgroundColor = 'white';
            } else if (isLoggedIn) {
                if (currentUser && currentUser.name) {
                    document.getElementById('user-name-nav').textContent = currentUser.name.split(' ')[0];
                    document.getElementById('user-avatar').textContent = currentUser.name.charAt(0);
                    updateNotificationBadge();
                } else if (currentUser) {
                    document.getElementById('user-name-nav').textContent = "User";
                    document.getElementById('user-avatar').textContent = "U";
                    updateNotificationBadge();
                }

                userNav.style.display = 'flex';
                blackLogo.style.display = 'block';
                whiteLogo.style.display = 'none';
                totalNav.style.backgroundColor = 'white';
                document.getElementById('welcome-screen').style.display = 'none';
                showDashboard();
            } else {
                navButtons.style.display = 'flex';
                blackLogo.style.display = 'none';
                whiteLogo.style.display = 'block';
                totalNav.style.backgroundColor = 'white';
            }
        }

        function showAdminLogin() {
            hideAllScreens();
            document.getElementById('admin-login-screen').style.display = 'block';
        }

        function adminLogout() {
            isAdminLoggedIn = false;
            updateNav(false, false);
            showWelcomeScreen();
        }


        // --- 3. SHOW HOME (Welcome Screen) ---
        function showWelcomeScreen() {
            hideAllScreens(); // <--- Hides Forum immediately
            document.getElementById('forum-screen').style.display = 'none';
            document.getElementById('internship-task-screen').style.display = 'none';

            isAdminLoggedIn = false;
            updateNav(false, false); // Reset Nav state

            const screen = document.getElementById('welcome-screen');
            screen.style.display = 'block';

            const userNav = document.getElementById('user-nav');
            if (userNav) userNav.style.display = 'none';
        }

        function showLogin() {
            hideAllScreens();
            document.getElementById('login-form').style.display = 'block';
            document.body.style.backgroundColor = 'white';
        }

        function showRegister() {
            hideAllScreens();
            document.getElementById('register-form').style.display = 'block';
            document.body.style.backgroundColor = 'white';

        }

        // --- 1. SHOW COURSE LIST ---
        function showCourseList() {
            hideAllScreens(); // <--- Hides Forum immediately
            document.getElementById('forum-screen').style.display = 'none';

            const screen = document.getElementById('course-list');
            screen.style.display = 'block';
            document.body.style.backgroundColor = 'white';

            // Reset filters and render
            renderCourseList(courses);
            resetFilterButtons('all');
        }

        // --- 2. SHOW DASHBOARD ---
        async function showDashboard() {
            if (!currentUserId) return showLogin();

            hideAllScreens(); // <--- Hides Forum immediately
            document.getElementById('forum-screen').style.display = 'none';

            await fetchUserData();

            if (currentUserId) {
                database.ref(`edupro_users/${currentUserId}/last_active`).set(Date.now());
            }

            const screen = document.getElementById('dashboard-screen');
            screen.style.display = 'block';
            document.body.style.backgroundColor = '#F3F4F6'; // Light gray

            renderDashboard();
        }


        // --- CERTIFICATES TAB ---
        async function showCertificates() {
            if (!currentUserId) return showLogin();

            hideAllScreens(); // <--- Hides Forum & Dashboard first
            document.getElementById('forum-screen').style.display = 'none';

            await fetchUserData();
            document.getElementById('certificates-screen').style.display = 'block';
            renderCertificates();
        }

        function showProfile() {
            if (!currentUserId) return showLogin();

            // <--- This now includes forum-screen, so it will hide it.
            hideAllScreens();
            document.getElementById('forum-screen').style.display = 'none';
            fetchUserData().then(() => {
                document.getElementById('profile-screen').style.display = 'block';
                document.body.style.backgroundColor = '#f3f4f6';
                renderProfileCourses();
            });
        }

        // --- MY ACCOUNT TAB ---
        async function showMyAccount() {
            if (!currentUserId) return showLogin();

            hideAllScreens(); // <--- Hides Forum & Dashboard first

            await fetchUserData();
            document.getElementById('my-account-screen').style.display = 'block';
            document.getElementById('forum-screen').style.display = 'none';
            document.getElementById('internship-task-screen').style.display = 'none';
            renderMyAccount();
        }
        function openExistingCertificate(certObj) {
            showCertificateScreen(certObj);
        }

        function showCertificateScreen(certData) {
            hideAllScreens();
            document.getElementById('certificate-screen').style.display = 'block';
            renderCertificate(certData); // Defined below
        }
        async function showNotificationPopup() {
            if (!currentUserId || !currentUser) return showLogin();
            const modal = document.getElementById('notification-modal');
            const content = document.getElementById('notification-content');
            const timestampDisplay = document.getElementById('notification-timestamp');

            await fetchUserData();

            if (globalNotification && globalNotification.message) {
                content.innerHTML = `<p class="font-medium text-lg">${globalNotification.message}</p>`;
                timestampDisplay.textContent = new Date(globalNotification.timestamp).toLocaleString();
            } else {
                content.innerHTML = `<p class="font-medium text-lg">No active announcements.</p>`;
                timestampDisplay.textContent = 'N/A';
            }

            if (globalNotification && globalNotification.timestamp) {
                await database.ref(`edupro_users/${currentUserId}/last_notification_check`).set(globalNotification.timestamp);
                currentUser.last_notification_check = globalNotification.timestamp;
                updateNotificationBadge();
            }

            modal.style.display = 'flex';
        }

        function closeNotificationPopup() {
            document.getElementById('notification-modal').style.display = 'none';
        }
        // ==========================================
        // ðŸ“Š MISSING ANALYTICS HELPER (PASTE THIS!)
        // ==========================================
        function getCourseEnrollmentDistributionData() {
            const enrollmentMap = {};

            // 1. Initialize Map with Course Titles
            courses.forEach(course => {
                enrollmentMap[course.id] = {
                    enrolled: 0,
                    certified: 0,
                    title: course.title
                };
            });

            let totalApprovals = 0;
            let totalRevokes = 0;
            let totalActiveUsers = 0;

            // 2. Count Enrollments
            users.forEach(user => {
                // Check Courses
                if (user.enrolled_courses) {
                    Object.keys(user.enrolled_courses).forEach(cid => {
                        if (enrollmentMap[cid]) {
                            enrollmentMap[cid].enrolled++;
                            if (user.enrolled_courses[cid].status === true) totalApprovals++;
                            else totalRevokes++; // Pending
                        }
                    });
                }

                // Check Activity
                if (!user.disabled) totalActiveUsers++;
            });

            // 3. Count Certificates
            certificates.forEach(cert => {
                // Handle both "courseId" and "INTERN_..." IDs
                // We only map standard courses for the chart to keep it clean
                if (enrollmentMap[cert.courseId]) {
                    enrollmentMap[cert.courseId].certified++;
                }
            });

            return {
                labels: Object.values(enrollmentMap).map(d => d.title),
                enrolledData: Object.values(enrollmentMap).map(d => d.enrolled),
                certifiedData: Object.values(enrollmentMap).map(d => d.certified),
                totalApprovals,
                totalRevokes,
                totalActiveUsers
            };
        }
        async function showAdminDashboard() {
            if (!isAdminLoggedIn) return showLogin();

            hideAllScreens();
            document.getElementById('admin-dashboard-panel').style.display = 'block';
            document.body.style.backgroundColor = 'white';

            // CRITICAL: Fetch with 'true' to ensure Courses & Users are loaded before rendering
            await fetchUserData(true);

            renderAdminDashboard();
        }

        // *** INTEGRATED COURSE LEARNING FUNCTIONS ***

        async function secureStartLearning(courseId) {
            if (!currentUserId) return showLogin();

            const course = courses.find(c => c.id === courseId);
            const userEnrollment = currentUser.enrolled_courses ? currentUser.enrolled_courses[courseId] : null;

            if (!userEnrollment || userEnrollment.status !== true) {
                alert("Course not yet unlocked. Please check your payment status");
                showCourseDetail(courseId);
                return;
            }

            try {
                // Set global state for the learning session
                currentLearningUserId = currentUserId;
                currentLearningCourseId = courseId;

                // Display the course wrapper and loading screen
                hideAllScreens();
                document.getElementById('course-wrapper').style.display = 'flex';
                document.getElementById('integrated-loading-screen').style.display = 'flex';
                document.getElementById('integrated-loading-screen').style.opacity = 1;

                // Update UI
                document.getElementById('integrated-course-title').textContent = `Course: ${course.title}`;
                document.getElementById('integrated-loading-screen').innerHTML = `
                    <h1 class="text-3xl font-bold text-indigo-600 mb-4">Preparing Course...</h1>
                    <p class="text-gray-600">Loading module content securely.</p>
                `;

                // 1. Load the course content into the iframe
                const iframe = document.getElementById('integrated-course-iframe');
                iframe.src = `courses/${courseId}/index.html`;

                // Wait a moment for the iframe to load and hide the initial loading screen
                iframe.onload = () => {
                    document.getElementById('integrated-loading-screen').style.opacity = 0;
                    setTimeout(() => {
                        document.getElementById('integrated-loading-screen').style.display = 'none';
                    }, 600);
                    startCompletionTimer(); // Start the timer when the content is ready
                };

            } catch (error) {
                console.error("In-page Course Load Error:", error);
                alert("Failed to load course content. Redirecting to dashboard.");
                hideLoader();
                showDashboard();
            }
        }

        function startLearning(courseId) {
            if (!currentUserId || !currentUser) return showLogin();
            secureStartLearning(courseId);
        }

        function startCompletionTimer() {
            let remainingSeconds = MINIMUM_TIME_SECONDS;
            const completionButton = document.getElementById('integrated-completion-button');

            const updateTime = () => {
                if (remainingSeconds <= 0) {
                    clearInterval(integratedCompletionTimer);
                    enableCompletionButton();
                    return;
                }

                const minutes = Math.floor(remainingSeconds / 60);
                const seconds = remainingSeconds % 60;
                const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

                completionButton.textContent = `Finish Course (Wait ${timeString})`;
                remainingSeconds--;
            };

            completionButton.disabled = true;
            completionButton.classList.remove('bg-green-600', 'hover:bg-green-700');
            completionButton.classList.add('bg-gray-400');
            updateTime();
            integratedCompletionTimer = setInterval(updateTime, 1000);
        }
        // Old logic in enableCompletionButton:
        /*
                    completionButton.onclick = () => {
                        if (confirm("Are you sure you want to finish the course and generate your certificate? This action cannot be undone.")) {
                            // ... loading screen ...
                            generateAndSaveCertificateAndRedirect(currentLearningUserId, currentLearningCourseId);
                        }
                    };
        */

        // New logic for enableCompletionButton (Requires minor async update to check):
        async function enableCompletionButton() {
            let remainingSeconds = MINIMUM_TIME_SECONDS;
            const completionButton = document.getElementById('integrated-completion-button');
            const courseId = currentLearningCourseId;
            const userId = currentLearningUserId;

            // 1. Initial Check: If already certified, set button to disabled status and exit.
            // This check is good but needs to be performed on fresh data (handled by fetch in onclick)
            await fetchUserData(true);
            const isCertified = certificates.some(c => c.userId === userId && c.courseId === courseId);

            if (isCertified) {
                completionButton.textContent = "Certified! View Certificate ðŸ†";
                completionButton.disabled = false;
                completionButton.classList.remove('bg-green-600', 'txt-color:black',
                    'hover:bg-green-700', 'bg-gray-400');
                completionButton.classList.add('bg-yellow-500');
                completionButton.onclick = () => showCertificates();
                return;

            }

            // 2. Button setup for first completion
            completionButton.textContent = "Finish Course & Get Certificate ðŸ†";
            completionButton.disabled = false;
            completionButton.classList.remove('bg-gray-400');
            completionButton.classList.add('bg-green-600', 'hover:bg-green-700');

            completionButton.onclick = async () => {
                // *** CRITICAL FIX 1: IMMEDIATELY DISABLE THE BUTTON UPON FIRST CLICK ***
                completionButton.disabled = true;
                completionButton.textContent = "Processing...";
                completionButton.classList.remove('bg-green-600');
                completionButton.classList.add('bg-gray-400');

                try {
                    // Re-fetch data inside the click handler for the most current state (Race condition protection)
                    await fetchUserData(true);
                    const alreadyCertified = certificates.some(c => c.userId === userId && c.courseId === courseId);

                    if (alreadyCertified) {
                        alert("Certificate is already generated for this course. Redirecting to your certificates.");
                        endLearningSession();
                        showCertificates();
                        return;
                    }

                    if (confirm("Are you sure you want to finish the course and generate your certificate? This action cannot be undone.")) {

                        // *** CRITICAL FIX 2: SHOW VISUAL LOADER AND GLOBAL LOADER ***
                        document.getElementById('integrated-loading-screen').style.display = 'flex';
                        document.getElementById('integrated-loading-screen').style.opacity = 1;
                        document.getElementById('integrated-loading-screen').innerHTML = `
                    <h1 class="text-3xl font-bold text-green-600 mb-4">Course Completed!</h1>
                    <p class="text-gray-700">Generating your official certificate...</p>
                    <div class="lds-ring" style="margin-top:20px"><div></div><div></div><div></div><div></div></div>
                `;
                        showLoader(); // Show the global "Authenticating" loader

                        await generateAndSaveCertificateAndRedirect(currentLearningUserId, currentLearningCourseId);
                    } else {
                        // If the user cancels the confirmation, re-enable the button
                        enableCompletionButton();
                    }
                } catch (e) {
                    console.error("Certificate generation failed:", e);
                    alert("An error occurred during certificate generation. Please try again.");
                    // Ensure button is restored if an error occurs before final redirection
                    enableCompletionButton();
                    hideLoader();
                }
            };
        }

        function endLearningSession() {
            if (integratedCompletionTimer) clearInterval(integratedCompletionTimer);
            document.getElementById('integrated-course-iframe').src = 'about:blank';
            document.getElementById('course-wrapper').style.display = 'none';

            currentLearningUserId = null;
            currentLearningCourseId = null;

            hideLoader();
            showDashboard();
        }

        // *** END SCREEN NAVIGATION ***




        // **************************************************
        // *** 2. CORE CERTIFICATE LOGIC ***
        // **************************************************

        async function generateAndSaveCertificate(uid, courseId) {
            try {
                if (!firebase || !firebase.database) throw new Error('Firebase not available');

                await fetchUserData(true);

                const user = users.find(u => u.uid === uid) || {};
                const course = courses.find(c => c.id === courseId);

                if (!user || !course) throw new Error('User or Course data missing for certificate generation.');

                const existingCert = certificates.find(c => c.userId === uid && c.courseId === courseId);
                if (existingCert) {
                    console.warn(`Certificate already exists for user ${uid} and course ${courseId}. Skipping generation.`);
                    return existingCert;
                }

                const userEnrollment = user.enrolled_courses ? user.enrolled_courses[courseId] : {};
                const completed = course.curriculum ? course.curriculum.length : 10;
                const total = completed;

                const counterRef = firebase.database().ref('/meta/certificateCounter');
                const counterResult = await counterRef.transaction(current => (current || 0) + 1);
                const count = (counterResult.snapshot && counterResult.snapshot.val()) || 1;
                const refNo = 'PROG' + String(count).padStart(2, '0');

                const dateIssued = new Date();
                const certName = user.name || 'Student Name';

                const certObj = {
                    name: certName,
                    userId: uid,
                    courseId: courseId,
                    courseTitle: course.title,
                    completedModules: completed,
                    totalModules: total,
                    refNo: refNo,
                    dateIssued: dateIssued.toISOString(),
                    dateDisplay: (function (d) {
                        const dd = String(d.getDate()).padStart(2, '0');
                        const mm = String(d.getMonth() + 1).padStart(2, '0');
                        return dd + '.' + mm + '.' + d.getFullYear();
                    })(dateIssued),
                    id: refNo
                };

                await firebase.database().ref(`certificates/${refNo}`).set(certObj);
                certificates.push(certObj);

                return certObj;
            } catch (err) {
                console.error('generateAndSaveCertificate error', err);
                throw err;
            }
        }

        async function generateAndSaveCertificateAndRedirect(uid, courseId) {
            try {
                await fetchUserData(true);

                const userToCertify = users.find(u => u.uid === uid);

                if (!userToCertify) {
                    hideLoader();
                    console.error("CERT GENERATION ERROR: User data not found locally after refresh for UID:", uid);
                    throw new Error("User data is unavailable for certificate generation.");
                }

                const existingCert = certificates.find(c => c.userId === uid && c.courseId === courseId);

                if (existingCert) {
                    hideLoader();
                    alert(`Certificate for ${existingCert.courseTitle} already exists. Redirecting to Certificates page.`);
                    await fetchUserData();
                    // --- FIX 2: If cert exists, show the existing certificate screen ---
                    showCertificateScreen(existingCert);
                    return;
                }

                // Proceed with generation only if it doesn't exist
                const certObj = await generateAndSaveCertificate(uid, courseId);

                // Update user's progress (set day to total for completion)
                const total = certObj.totalModules;
                await database.ref(`edupro_users/${uid}/enrolled_courses/${courseId}/day`).set(total);

                // Re-fetch ALL data including the newly created certificate
                await fetchUserData();

                hideLoader();
                alert(`Congratulations! Certificate ${certObj.refNo} generated for ${certObj.courseTitle}.`);

                // --- CRITICAL FIX 3: Pass the certificate object to the final screen ---
                // We use the object from the local 'certificates' array now that it's updated
                const newCert = certificates.find(c => c.refNo === certObj.refNo);
                showCertificateScreen(newCert);
                // ---------------------------------------------------------------------

            } catch (error) {
                console.error("Certificate Generation/Redirect Failed at final step:", error);

                hideLoader();
                alert("CRITICAL ERROR: Certificate failed to generate or save. Please check console for details. Redirecting to dashboard.");
                showDashboard();
            }
        }

        // ==========================================
        // 2. RENDER CERTIFICATE (DYNAMIC TEXT)
        // ==========================================

        // ==========================================
        // ðŸ† CERTIFICATE RENDERER (UPDATED LAYOUT)
        // ==========================================
        function renderCertificate(certData) {
            if (!certData) return;
            const container = document.getElementById('certificate-content');

            // --- IMAGES ---
            const companyLogoSVG = 'https://ui-avatars.com/api/?name=PM&background=6a1b1b&color=fff&size=128';
            const aicteLogoSVG = 'https://upload.wikimedia.org/wikipedia/en/e/eb/All_India_Council_for_Technical_Education_logo.png';
            const msmeLogoSVG = 'https://upload.wikimedia.org/wikipedia/en/thumb/9/9e/Emblem_of_India.svg/1200px-Emblem_of_India.svg.png';
            const sealSVG = 'https://img.freepik.com/premium-vector/guaranteed-stamp-seal-wax-logo-vector_205544-245.jpg';
            const signatureSVG_1 = 'https://upload.wikimedia.org/wikipedia/commons/e/ec/Signature_sample.svg';
            const signatureSVG_2 = 'https://upload.wikimedia.org/wikipedia/commons/e/ec/Signature_sample.svg';

            const isIntern = certData.type === 'internship' || (certData.courseId && certData.courseId.startsWith('INTERN'));

            // --- QR CODE (INTERNSHIP ONLY) ---
            let qrCodeHTML = '';
            if (isIntern) {
                // Link to verify
                const verifyLink = `${window.location.origin}${window.location.pathname}?verify=${certData.refNo}`;
                const qrCodeImage = `https://quickchart.io/qr?text=${encodeURIComponent(verifyLink)}&size=100&margin=0`;

                qrCodeHTML = `
            <div style="text-align:center;">
                <img src="${qrCodeImage}" style="width:80px;height:80px; border:2px solid #eee; padding:2px;">
                <div style="font-size:8px;color:#6a1b1b;margin-top:2px;font-weight:bold;text-transform:uppercase">Scan to Verify</div>
            </div>
        `;
            }

            const titleText = isIntern ? "INTERNSHIP COMPLETION CERTIFICATE" : "COURSE COMPLETION CERTIFICATE";

            const bodyText = isIntern
                ? `For successfully completing the <strong style="color:#222">${certData.courseTitle} Internship</strong> at <strong style="color:#222">PROGMASTER PRIVATE LIMITED</strong>`
                : `For successfully completing the <strong style="color:#222">${certData.courseTitle}</strong> course at <strong style="color:#222">PROGMASTER PRIVATE LIMITED</strong>`;

            const progLabel = isIntern ? "Internship Progress" : "Course Progress";
            const ptsLabel = isIntern ? "Internship Points" : "Course Points";
            const dateLabel = isIntern ? "Duration" : "Date of Issue";
            const score = certData.score || "100";

            container.innerHTML = `
        <div style="padding:10px;">
            <div class="certificate-inner-content" style="width:100%;background:linear-gradient(180deg,#fff,#fcf9f8);border-radius:12px;padding:30px;font-family: 'Merriweather', serif; border: 1px solid #eee; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                
                <div style="display:flex;justify-content:space-between;align-items:start;">
                    <div style="display:flex;align-items:center;gap:16px">
                        <div style="width:80px;height:80px;border-radius:12px;overflow:hidden;">
                            <img src="${companyLogoSVG}" style="width:100%;height:100%;object-fit:contain;">
                        </div>
                        <div>
                            <div style="font-size:22px;color:#6a1b1b;font-weight:900">ProgMaster Pvt Ltd</div>
                            <div style="color:#6b6b6b;font-size:14px;margin-top:4px">is proud to certify</div>
                        </div>
                    </div>
                    ${qrCodeHTML}
                </div>

                <div style="text-align:center;margin-top:20px">
                    <div style="font-size:28px;color:#6a1b1b;font-weight:900;letter-spacing:1px;text-transform:uppercase">${titleText}</div>
                    <div style="margin-top:10px;color:#6b6b6b">This Certificate Is Proudly Presented To</div>
                    <div style="font-size:34px;color:#6a1b1b;font-weight:800;margin-top:15px; border-bottom: 2px solid #6a1b1b; display:inline-block; padding-bottom:5px;">
                        ${(certData.name || '').toUpperCase()}
                    </div>
                    <div style="max-width:700px;margin:25px auto;color:#555;font-size:16px;line-height:1.6;">
                        ${bodyText}
                    </div>
                </div>

                <div style="display:flex;justify-content:space-between;margin-top:40px;padding:0 30px;color:#444">
                    <div>
                        <div style="font-size:12px;color:#777;text-transform:uppercase;font-weight:bold">${progLabel}</div>
                        <div style="font-weight:800;font-size:18px;margin-top:4px">100%</div>
                    </div>
                    <div style="text-align:center">
                        <div style="font-size:12px;color:#777;text-transform:uppercase;font-weight:bold">${ptsLabel}</div>
                        <div style="font-weight:800;font-size:18px;margin-top:4px">${score}/100</div>
                    </div>
                    <div style="text-align:right">
                        <div style="font-size:12px;color:#777;text-transform:uppercase;font-weight:bold">${dateLabel}</div>
                        <div style="font-weight:800;font-size:18px;margin-top:4px">${certData.dateDisplay}</div>
                    </div>
                </div>

                <div style="display:flex;justify-content:space-between;align-items:end;margin-top:50px;padding:0 10px">
                    
                    <div style="text-align:center; width:140px;">
                        <img src="${signatureSVG_1}" style="height:40px; display:block; margin:0 auto 5px;">
                        <div style="border-top:1px solid #999; padding-top:5px; font-weight:700;color:#222; font-size:13px">K. Purushotham</div>
                        <div style="font-size:11px;color:#6b6b6b">Director</div>
                    </div>

                    <div style="display:flex; align-items:center; gap:15px; position:relative; top:-5px;">
                        <img src="${aicteLogoSVG}" style="height:45px; opacity:0.8;">
                        <img src="${sealSVG}" style="width:80px;height:80px; opacity:1;">
                        <img src="${msmeLogoSVG}" style="height:45px; opacity:0.8;">
                    </div>

                    <div style="text-align:center; width:140px;">
                        <img src="${signatureSVG_2}" style="height:40px; display:block; margin:0 auto 5px;">
                        <div style="border-top:1px solid #999; padding-top:5px; font-weight:700;color:#222; font-size:13px">Fahad Khalique</div>
                        <div style="font-size:11px;color:#6b6b6b">Lead Instructor</div>
                    </div>
                </div>
                
                <div style="margin-top:20px; text-align:center; font-size:10px; color:#aaa;">
                    Reference ID: ${certData.refNo}
                </div>
            </div>
        </div>
    `;
        }

        // **************************************************
        // *** 3. CORE APPLICATION LOGIC ***
        // **************************************************

        function handlePagination(direction) {
            if (direction === 'next') {
                currentPage++;
            } else if (direction === 'prev' && currentPage > 1) {
                currentPage--;
            }
            renderAdminStudentTable();
        }

        function initializeUI() {
            fetchUserData(true).then(() => {
                // --- CRITICAL FIX: Add event listeners to log time on close/navigate ---
                window.addEventListener('beforeunload', logSessionDuration);

                // REPLACE YOUR AUTH LISTENER WITH THIS ROBUST VERSION
                auth.onAuthStateChanged((user) => {
                    if (user) {
                        currentUserId = user.uid;
                        startSessionTimer();
                        fetchUserData(true).then(() => {
                            updateNav(true, false);

                            // Check if user is on a "Guest Only" page (Login/Register/Welcome)
                            const guestScreens = ['welcome-screen', 'login-form', 'register-form'];
                            const currentScreen = guestScreens.find(id => document.getElementById(id).style.display === 'block');

                            if (currentScreen) {
                                showDashboard();
                            }
                            hideLoader(); // <--- CRITICAL FIX: Ensure this runs
                        }).catch(e => {
                            console.error(e);
                            hideLoader(); // Safety catch
                        });
                    } else {
                        currentUserId = null;
                        currentUser = null;
                        updateNav(false, isAdminLoggedIn);
                        hideLoader(); // <--- CRITICAL FIX: Hide even if logged out
                    }
                });
                loadPopularCourses();
            });
        }

        // ==========================================
        // DATA FETCHING (UPDATED TO TRIGGER FEATURES)
        // ==========================================
        async function fetchUserData(loadCoursesData = false) {
            try {
                // 1. Fetch Users
                const userSnapshot = await database.ref('edupro_users').once('value');
                users = userSnapshot.val() ? Object.keys(userSnapshot.val()).map(uid => ({ uid, ...userSnapshot.val()[uid] })) : [];

                if (currentUserId) {
                    currentUser = users.find(u => u.uid === currentUserId);
                }

                // 2. Fetch Courses
                if (loadCoursesData) {
                    const courseSnapshot = await database.ref('edupro_courses').once('value');
                    const dbCourses = courseSnapshot.val();
                    if (dbCourses) {
                        const rawCourses = Array.isArray(dbCourses) ? dbCourses : Object.values(dbCourses);
                        courses = rawCourses.map(adminCourse => {
                            const uiConfig = courseEnhancements[adminCourse.id] || defaultEnhancement;
                            return { ...adminCourse, ...uiConfig, category: uiConfig.category || adminCourse.category || 'programming' };
                        });
                    }
                    renderCourseList(courses);
                    loadPopularCourses();
                }

                // 3. Fetch Certificates
                const certSnapshot = await database.ref('certificates').once('value');
                certificates = certSnapshot.val() ? Object.values(certSnapshot.val()) : [];

                // 4. TRIGGER ENGAGEMENT FEATURES (The Fix)
                if (currentUser) {
                    checkNotifications(); // Load Global Alert
                    initGamification();   // Load Daily Challenge
                }

            } catch (error) {
                console.error("Data Fetch Error:", error);
            }
        }

        // Add this missing helper function for notifications
        async function checkNotifications() {
            const snapshot = await database.ref('edupro_notifications').once('value');
            globalNotification = snapshot.val();
            updateNotificationBadge();
        }
        // **************************************************
        // *** 4. AUTH & DB HANDLERS ***
        // **************************************************

        async function handleAdminLogin(event) {
            event.preventDefault();
            const email = document.getElementById('admin-email').value;
            const password = document.getElementById('admin-password').value;

            if (email === ADMIN_EMAIL && password === ADMIN_PASSWORD) {
                isAdminLoggedIn = true;
                updateNav(false, true);
                showAdminDashboard();
            } else {
                alert("Invalid Admin Credentials.");
            }
        }

        function adminLogout() {
            isAdminLoggedIn = false;
            updateNav(false, false);
            showWelcomeScreen();
        }

        async function handleLogin(event) {
            showLoader();
            event.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            try {
                await fetchUserData();
                const userToLogin = users.find(u => u.email === email);

                if (userToLogin && userToLogin.disabled === true) {
                    alert("Account is temporarily disabled by the administrator. Please contact support.");
                    return;
                }

                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                if (userCredential.user.uid) {
                    database.ref(`edupro_users/${userCredential.user.uid}/last_active`).set(Date.now());
                    showToast(`Welcome back!`, 'success');
                }
            } catch (error) {
                showToast(error.message, 'error');
            }
        }

        // ==========================================
        // REGISTRATION (FIXED TOAST)
        // ==========================================
        async function handleRegister(event) {
            showLoader();
            event.preventDefault();

            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const phone = document.getElementById('register-phone').value;
            const password = document.getElementById('register-password').value;

            if (!confirm(`Confirm Name: "${name}"? This will appear on your certificate.`)) return;

            showLoader();

            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const uid = userCredential.user.uid;

                // Save User Data
                await database.ref('edupro_users/' + uid).set({
                    name: name,
                    email: email,
                    phone: phone,
                    joined: new Date().toISOString().split('T')[0],
                    disabled: false,
                    last_active: Date.now(),
                    gamification: { streak: 0, last_solved_date: "" }
                });

                hideLoader();

                // Force the Toast to show immediately
                showToast("Account created successfully! Welcome.", 'success');

                // Delay login redirect slightly so user sees the toast
                setTimeout(() => {
                    showDashboard();
                }, 1500);

            } catch (error) {
                hideLoader();
                showToast(error.message, 'error');
            }
        }
        function logout() {
            if (currentUserId) {
                database.ref(`edupro_users/${currentUserId}/last_active`).set(Date.now());
            }
            logSessionDuration(); // <-- LOG DURATION ON LOGOUT BUTTON CLICK
            auth.signOut();
            showToast('Logged out successfully', 'info'); // Add this!
            showWelcomeScreen();
        }

        // Existing initiatePayment function (for single courses)
        async function initiatePayment(courseId) {
            if (!currentUserId) return showLogin();
            if (!currentUser) await fetchUserData();

            const course = courses.find(c => c.id === courseId);
            const userEnrollment = currentUser.enrolled_courses ? currentUser.enrolled_courses[courseId] : null;

            if (userEnrollment && userEnrollment.status === true) {
                alert(`You are already enrolled and the ${course.title} course is ACTIVE!`);
                return;
            }

            if (userEnrollment && userEnrollment.status === false) {
                window.open(PAYMENT_LINK, '_blank');
                alert("Your enrollment is already PENDING confirmation. Redirecting to payment portal again.");
                return;
            }

            try {
                showLoader('Initiating enrollment...');
                // Set status to PENDING (false) in Firebase
                await database.ref(`edupro_users/${currentUserId}/enrolled_courses/${courseId}`).set({
                    courseName: course.title,
                    status: false,
                    enrollDate: new Date().toISOString().split('T')[0],
                    day: 1
                });

                window.open(PAYMENT_LINK, '_blank');
                alert(`Enrollment initiated for ${course.title}! Redirecting to payment portal. Status is now 'Pending Confirmation'.`);

                await fetchUserData();
                showCourseDetail(courseId); // Update course detail screen status

            } catch (error) {
                alert(`Failed to initiate enrollment: ${error.message}`);
            } finally {
                hideLoader();
            }
        }

        // NEW: initiateSubscriptionPayment function
        // ==========================================
        // SUBSCRIPTION LOGIC (FIXED LINK)
        // ==========================================
        async function initiateSubscriptionPayment() {
            if (!currentUserId) return showLogin();
            if (!currentUser) await fetchUserData(); // Ensure user data is loaded

            // Check for existing subscription
            const userEnrollment = currentUser.enrolled_courses ? currentUser.enrolled_courses['SUBSCRIPTION'] : null;

            if (userEnrollment && userEnrollment.status === true) {
                showToast("You already have an Active Subscription!", 'info');
                return;
            }

            if (userEnrollment && userEnrollment.status === false) {
                window.open(SUBSCRIPTION_PAYMENT_LINK, '_blank');
                showToast("Subscription pending. Redirecting to payment...", 'info');
                return;
            }

            try {
                showLoader();

                // Create Pending Record
                await database.ref(`edupro_users/${currentUserId}/enrolled_courses/SUBSCRIPTION`).set({
                    courseName: 'SUBSCRIPTION',
                    status: false,
                    enrollDate: new Date().toISOString().split('T')[0],
                    paymentAmount: 1500
                });

                hideLoader();

                // FIXED: Using the correct global variable
                window.open(SUBSCRIPTION_PAYMENT_LINK, '_blank');

                showToast("Subscription initiated! Redirecting...", 'success');
                await fetchUserData();

            } catch (error) {
                hideLoader();
                showToast(`Error: ${error.message}`, 'error');
            }
        }


        async function deleteUserPermanently(userId) {
            if (!isAdminLoggedIn) return;
            const userToDelete = users.find(u => u.uid === userId);
            if (!userToDelete) return;

            if (confirm(`ARE YOU SURE you want to permanently delete ALL data for user: ${userToDelete.name} (${userToDelete.email})? This action cannot be undone and will not be logged out in a real application!`)) {
                try {
                    await database.ref(`edupro_users/${userId}`).remove();

                    certificates.filter(c => c.userId === userId).forEach(async (cert) => {
                        await database.ref(`certificates/${cert.id}`).remove();
                    });

                    await fetchUserData();
                    renderAdminDashboard();
                    closeAdminUserDetails();
                    alert(`User ${userToDelete.name} and all associated data have been permanently deleted.`);

                } catch (error) {
                    console.error("Error deleting user:", error);
                    alert(`Failed to delete user: ${error.message}`);
                }
            }
        }

        async function toggleUserDisableStatus(userId) {
            if (!isAdminLoggedIn) return;
            const userToToggle = users.find(u => u.uid === userId);
            if (!userToToggle) return;

            const currentDisabledStatus = userToToggle.disabled || false;
            const newDisabledStatus = !currentDisabledStatus;

            try {
                await database.ref(`edupro_users/${userId}/disabled`).set(newDisabledStatus);

                await fetchUserData();
                renderAdminDashboard();
                showAdminUserDetails(userId);

                alert(`User ${userToToggle.name}'s account status changed to: ${newDisabledStatus ? 'DISABLED (Cannot Log In)' : 'ENABLED (Can Log In)'}`);

            } catch (error) {
                console.error("Error toggling disable status:", error);
                alert(`Failed to change disable status: ${error.message}`);
            }
        }


        // **************************************************
        // *** 5. RENDER FUNCTIONS (STUDENT) ***
        // **************************************************

        // Function in index.html to render course cards
        /**
         * Retrieves consistent image and instructor data for a given course ID.
         * The image source is 'image_c4bdd8.jpg' as provided by the user.
         */
        function getCourseCardData(courseId) {
            // Define all simulation data here for centralized consistency
            const courseDataMap = {
                'web_dev': {
                    imageURL: 'https://tse4.mm.bing.net/th/id/OIP.jVuwODsM2kVvZ7RXmAZr_QHaDe?rs=1&pid=ImgDetMain&o=7&rm=3',
                    instructorName: 'Daniel Walter Scott',
                    badgeText: '50% OFF'
                },
                'aws_cloud': {
                    imageURL: 'https://d2908q01vomqb2.cloudfront.net/9109c85a45b703f87f1413a405549a2cea9ab556/2021/05/25/CourseLaunch__Blog_AllCourses-1024x536.png',
                    instructorName: 'Jesse Showalter',
                    badgeText: 'Bestseller'
                }, 'Wireframes to Responsive Websites': {
                    imageURL: 'https://assets-global.website-files.com/5e593fb060cf877cf875dd1f/641de640d54d684cb4eb7da1_58f207ab20b1d87418691802_Description-Mockup-2.jpeg',
                    instructorName: 'Jesse Showalter',
                    badgeText: 'Bestseller'
                },
                // Add more courses here if needed in the future
            };

            // Default data if ID is not specifically mapped
            return courseDataMap[courseId] || {
                imageURL: 'image_c4bdd8.jpg',
                instructorName: 'Expert Instructor',
                badgeText: 'Bestseller'
            };
        }

        // ==========================================
        // 2. PROFESSIONAL COURSE CARD RENDERER
        // ==========================================

        // ==========================================
        // 2. RENDER CARD LOGIC (The Professional UI)
        // ==========================================
        function renderCourseCard(course) {
            // Status Logic
            const userEnrollment = (currentUser && currentUser.enrolled_courses) ? currentUser.enrolled_courses[course.id] : null;
            const isEnrolled = userEnrollment && userEnrollment.status === true;
            const isPending = userEnrollment && userEnrollment.status === false;
            const isCertified = (certificates && currentUser) ? certificates.some(c => c.userId === currentUser.uid && c.courseId === course.id) : false;

            let footerContent = '';
            let badge = '';

            if (isCertified) {
                // --- CASE 1: CERTIFIED ---
                badge = `<div class="absolute top-3 left-3 bg-yellow-400 text-yellow-900 text-xs font-bold px-2 py-1 rounded shadow-sm flex items-center gap-1"><i class="fa-solid fa-trophy"></i> Certified</div>`;
                footerContent = `
            <button onclick="showCertificates()" class="w-full bg-yellow-50 text-yellow-700 border border-yellow-200 py-2.5 rounded-lg text-sm font-bold hover:bg-yellow-100 transition-colors">
                View Certificate
            </button>`;
            } else if (isEnrolled) {
                // --- CASE 2: ENROLLED (Active) ---
                const total = course.curriculum ? course.curriculum.length : 10;
                const current = userEnrollment.day || 1;
                const percent = Math.round((current / total) * 100);

                badge = `<div class="absolute top-3 left-3 bg-indigo-600 text-white text-xs font-bold px-2 py-1 rounded shadow-sm">Enrolled</div>`;
                footerContent = `
            <div class="w-full">
                <div class="flex justify-between text-xs text-gray-500 mb-1">
                    <span>Progress</span>
                    <span class="font-bold text-indigo-600">${percent}%</span>
                </div>
                <div class="w-full bg-gray-100 rounded-full h-1.5 mb-3">
                    <div class="bg-indigo-600 h-1.5 rounded-full" style="width: ${percent}%"></div>
                </div>
                <button onclick="secureStartLearning('${course.id}')" class="w-full bg-indigo-600 text-white py-2.5 rounded-lg text-sm font-bold hover:bg-indigo-700 transition-colors shadow-sm">
                    Continue Learning
                </button>
            </div>`;
            } else if (isPending) {
                // --- CASE 3: PENDING ---
                badge = `<div class="absolute top-3 left-3 bg-orange-500 text-white text-xs font-bold px-2 py-1 rounded shadow-sm">Pending</div>`;
                footerContent = `
            <button class="w-full bg-orange-50 text-orange-600 border border-orange-200 py-2.5 rounded-lg text-sm font-bold cursor-not-allowed opacity-80">
                <i class="fa-solid fa-clock mr-1"></i> Awaiting Approval
            </button>`;
            } else {
                // --- CASE 4: NOT ENROLLED (Show VIEW & ENROLL) ---
                badge = `<div class="absolute top-3 left-3 bg-white/90 backdrop-blur text-gray-800 text-xs font-bold px-2 py-1 rounded shadow-sm">${course.level || 'Beginner'}</div>`;

                // Define Actions
                // "View Course" -> Goes to Details Screen (Curriculum, etc.)
                // "Enroll" -> Initiates Payment
                const enrollAction = currentUser ? `initiatePayment('${course.id}')` : `showLogin()`;

                footerContent = `
            <div class="flex flex-col gap-3 mt-2">
                <div class="flex items-center justify-between">
                    <div class="flex flex-col">
                        <span class="text-xs text-gray-400 line-through font-medium">${course.originalPrice}</span>
                        <span class="text-xl font-extrabold text-gray-900">${course.price}</span>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="showCourseDetail('${course.id}')" class="flex items-center justify-center bg-white border border-gray-300 text-gray-700 py-2.5 rounded-lg text-sm font-bold hover:bg-gray-50 hover:border-gray-400 transition-all">
                        View Details
                    </button>
                    <button onclick="${enrollAction}" class="flex items-center justify-center bg-slate-900 text-white py-2.5 rounded-lg text-sm font-bold hover:bg-indigo-600 shadow-lg transition-all transform active:scale-95">
                        Enroll Now
                    </button>
                </div>
            </div>`;
            }

            return `
        <div class="group bg-white rounded-2xl border border-gray-100 overflow-hidden hover:shadow-[0_8px_30px_rgb(0,0,0,0.08)] hover:border-indigo-100 transition-all duration-300 flex flex-col h-full" data-aos="fade-up">
            
            <div class="relative h-48 overflow-hidden bg-gray-100">
                <img src="${course.thumbnail}" alt="${course.title}" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105">
                <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent opacity-60"></div>
                ${badge}
                <div class="absolute bottom-3 left-3 text-white text-xs font-medium flex items-center gap-1">
                    <i class="fa-solid fa-film"></i> ${course.duration || 'Self Paced'}
                </div>
            </div>

            <div class="p-5 flex flex-col flex-grow">
                <div class="flex justify-between items-start mb-2">
                    <div class="flex items-center gap-1 text-yellow-500 text-xs font-bold">
                        <span>${course.rating}</span>
                        <i class="fa-solid fa-star"></i>
                        <span class="text-gray-400 font-medium ml-1">(${course.reviewCount})</span>
                    </div>
                    <span class="text-[10px] uppercase tracking-wider text-indigo-600 font-bold bg-indigo-50 px-2 py-0.5 rounded-full">${course.category}</span>
                </div>

                <h3 class="text-lg font-bold text-gray-900 mb-2 line-clamp-2 leading-tight group-hover:text-indigo-600 transition-colors">
                    ${course.title}
                </h3>
                
                <p class="text-sm text-gray-500 mb-4 line-clamp-2 flex-grow">
                    ${course.description || 'No description available.'}
                </p>

                <div class="mt-auto">
                    ${footerContent}
                </div>
            </div>
        </div>
    `;
        }
        function loadPopularCourses() {
            const container = document.getElementById('popular-courses-preview');
            if (container) {
                // Show first 3
                const popularCourses = courses.slice(0, 3);
                container.innerHTML = popularCourses.map(renderCourseCard).join('');
            }
        }

        // 4. FILTERING LOGIC (Fixed to handle defaults)
        // ==========================================
        function renderCourseList(filteredCourses) {
            const container = document.getElementById('courses-container');
            if (container) {
                if (filteredCourses.length === 0) {
                    container.innerHTML = `<div class="col-span-full text-center py-10 text-gray-500">No courses found in this category.</div>`;
                } else {
                    container.innerHTML = filteredCourses.map(renderCourseCard).join('');
                }
            }
        }

        function filterCourses(category) {
            let filtered = courses;

            if (category !== 'all') {
                filtered = courses.filter(course => {
                    // Case-insensitive check and default handling
                    const cCat = (course.category || 'programming').toLowerCase();
                    const filter = category.toLowerCase();

                    // Special case for 'data' matching 'data science'
                    if (filter === 'data') return cCat.includes('data');

                    return cCat === filter;
                });
            }
            renderCourseList(filtered);
            resetFilterButtons(category);
        }
        function resetFilterButtons(activeCategory) {
            document.querySelectorAll('.language-filter').forEach(btn => {
                // Toggle Active Class based on text content or custom attribute
                // Simple visual toggle:
                btn.classList.remove('active', 'bg-indigo-600', 'text-white');
                btn.classList.add('bg-white', 'text-gray-700');

                // Note: You might need to add logic here to highlight the specific button clicked
                // passing 'this' in the HTML onclick is the easiest way (see previous code)
            });

            // Find the button that was clicked and highlight it (Optional refinement)
            // For now, the filtering works logic-wise.
        }
        // ==========================================
        // 4. INITIALIZATION
        // ==========================================
        // ==========================================
        // 5. INITIALIZE
        // ==========================================
        document.addEventListener('DOMContentLoaded', () => {
            // IMPORTANT: Fetch courses with TRUE to trigger the merge
            fetchUserData(true);
        });

        // ==========================================
        // ðŸš€ REDESIGNED COURSE DETAIL PAGE
        // ==========================================
        async function showCourseDetail(courseId) {
            const course = courses.find(c => c.id === courseId);
            if (!course) return;

            // 1. Setup UI State
            hideAllScreens();
            document.getElementById('course-detail').style.display = 'block';
            window.scrollTo(0, 0); // Scroll to top

            // 2. Get User Status
            // Safe check for user enrollment
            const userEnrollment = (currentUser && currentUser.enrolled_courses) ? currentUser.enrolled_courses[courseId] : null;
            const isEnrolled = userEnrollment && userEnrollment.status === true;
            const isPending = userEnrollment && userEnrollment.status === false;
            const isCertified = (certificates && currentUser) ? certificates.some(c => c.userId === currentUser.uid && c.courseId === courseId) : false;

            const currentDay = userEnrollment ? userEnrollment.day : 1;
            const totalDays = course.curriculum ? course.curriculum.length : 10;
            const progress = Math.round(((currentDay - 1) / totalDays) * 100);

            // 3. Generate Sidebar Action Card (Dynamic)
            let sidebarAction = '';

            if (isCertified) {
                const certData = certificates.find(c => c.userId === currentUser.uid && c.courseId === courseId);
                sidebarAction = `
            <div class="bg-green-50 border border-green-200 rounded-xl p-6 text-center">
                <div class="text-4xl mb-2">ðŸ†</div>
                <h3 class="text-lg font-bold text-green-800 mb-1">Course Completed</h3>
                <p class="text-green-600 text-sm mb-4">You have earned your certificate.</p>
                <button onclick="showCertificateById('${certData.id}')" class="w-full bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 shadow-md transition-all">
                    View Certificate
                </button>
            </div>`;
            } else if (isEnrolled) {
                sidebarAction = `
            <div class="bg-white border border-gray-200 rounded-xl p-6 shadow-lg">
                <div class="flex justify-between items-end mb-2">
                    <span class="text-gray-500 font-bold text-sm">Your Progress</span>
                    <span class="text-indigo-600 font-bold text-xl">${progress}%</span>
                </div>
                <div class="w-full bg-gray-100 rounded-full h-2 mb-6">
                    <div class="bg-indigo-600 h-2 rounded-full transition-all duration-1000" style="width: ${progress}%"></div>
                </div>
                <button onclick="secureStartLearning('${course.id}')" class="w-full bg-indigo-600 text-white py-3 rounded-lg font-bold hover:bg-indigo-700 shadow-md transition-all flex items-center justify-center gap-2">
                    <i class="fa-solid fa-play"></i> Continue Learning
                </button>
            </div>`;
            } else {
                // Not Enrolled / Pending
                const btnText = isPending ? "Awaiting Confirmation" : "Enroll Now";
                const btnAction = isPending ? "" : (currentUser ? `initiatePayment('${course.id}')` : `showLogin()`);
                const btnClass = isPending ? "bg-orange-500 cursor-not-allowed opacity-80" : "bg-slate-900 hover:bg-indigo-600 hover:scale-[1.02]";

                sidebarAction = `
            <div class="bg-white border border-gray-200 rounded-xl p-6 shadow-lg relative overflow-hidden">
                <div class="flex items-center gap-3 mb-4">
                    <span class="text-3xl font-extrabold text-gray-900">${course.price}</span>
                    <span class="text-lg text-gray-400 line-through decoration-red-500 decoration-2">${course.originalPrice}</span>
                </div>
                <button onclick="${btnAction}" class="w-full text-white py-4 rounded-xl font-bold shadow-xl transition-all transform ${btnClass}">
                    ${btnText}
                </button>
                <div class="mt-4 space-y-3 text-sm text-gray-600">
                    <div class="flex items-center gap-3"><i class="fa-solid fa-infinity text-indigo-500"></i> Full Lifetime Access</div>
                    <div class="flex items-center gap-3"><i class="fa-solid fa-mobile-screen text-indigo-500"></i> Access on Mobile & TV</div>
                    <div class="flex items-center gap-3"><i class="fa-solid fa-certificate text-indigo-500"></i> Certificate of Completion</div>
                </div>
            </div>`;
            }

            // 4. Generate Curriculum List
            const curriculumHTML = (course.curriculum || []).map((item, index) => {
                const day = index + 1;
                // Determine status: Locked, Active, or Completed
                let statusClass = "border-gray-200 bg-white opacity-60"; // Default Locked
                let icon = `<i class="fa-solid fa-lock text-gray-400"></i>`;
                let label = "";

                if (isEnrolled || isCertified) {
                    if (day < currentDay || isCertified) {
                        // Completed
                        statusClass = "border-green-200 bg-green-50";
                        icon = `<div class="bg-green-100 text-green-600 w-8 h-8 rounded-full flex items-center justify-center"><i class="fa-solid fa-check"></i></div>`;
                    } else if (day === currentDay) {
                        // Active
                        statusClass = "border-indigo-500 ring-2 ring-indigo-50 bg-white transform scale-[1.01] shadow-md";
                        icon = `<div class="bg-indigo-600 text-white w-8 h-8 rounded-full flex items-center justify-center animate-pulse"><i class="fa-solid fa-play text-xs"></i></div>`;
                        label = `<span class="ml-2 bg-indigo-100 text-indigo-700 text-[10px] font-bold px-2 py-0.5 rounded uppercase">Current</span>`;
                    } else {
                        // Locked Future
                        statusClass = "border-gray-200 bg-gray-50";
                    }
                }

                return `
            <div class="flex items-center p-4 border rounded-xl transition-all ${statusClass}">
                <div class="flex-shrink-0 mr-4">
                    ${icon}
                </div>
                <div class="flex-grow">
                    <h4 class="font-bold text-gray-800 text-sm md:text-base">Day ${day}: ${item.title} ${label}</h4>
                    <p class="text-xs text-gray-500 mt-1">Video Module â€¢ Practical Assignment</p>
                </div>
                <div class="text-xs text-gray-400 font-medium">
                    1h 20m
                </div>
            </div>
        `;
            }).join('');

            // 5. Build Final Layout HTML
            const html = `
        <div class="bg-[#F8F9FC] min-h-screen pb-20">
            
            <div class="relative bg-gray-900 text-white pt-20 pb-24 px-6">
                <div class="absolute inset-0 overflow-hidden">
                    <img src="${course.thumbnail}" class="w-full h-full object-cover opacity-20 blur-sm">
                    <div class="absolute inset-0 bg-gradient-to-t from-gray-900 via-gray-900/80 to-transparent"></div>
                </div>
                
                <div class="relative max-w-7xl mx-auto z-10">
                    <button onclick="showCourseList()" class="mb-6 flex items-center text-gray-400 hover:text-white transition-colors text-sm font-semibold">
                        <i class="fa-solid fa-arrow-left mr-2"></i> Back to Courses
                    </button>
                    
                    <div class="flex flex-wrap gap-2 mb-4">
                        <span class="bg-indigo-600 px-3 py-1 rounded text-xs font-bold uppercase tracking-wide">${course.category}</span>
                        <span class="bg-white/10 px-3 py-1 rounded text-xs font-bold uppercase tracking-wide text-yellow-400"><i class="fa-solid fa-star mr-1"></i> ${course.rating}</span>
                    </div>

                    <h1 class="text-3xl md:text-5xl font-extrabold mb-4 leading-tight">${course.title}</h1>
                    <p class="text-gray-300 text-lg max-w-2xl mb-6">${course.description}</p>

                    <div class="flex items-center gap-6 text-sm text-gray-300 font-medium">
                        <div class="flex items-center gap-2"><i class="fa-solid fa-globe"></i> English</div>
                        <div class="flex items-center gap-2"><i class="fa-regular fa-closed-captioning"></i> English [Auto]</div>
                        <div class="flex items-center gap-2"><i class="fa-solid fa-signal"></i> ${course.level}</div>
                    </div>
                </div>
            </div>

            <div class="max-w-7xl mx-auto px-4 sm:px-6 -mt-16 relative z-20">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    
                    <div class="lg:col-span-2 space-y-8">
                        
                        <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100 flex items-center gap-4">
                             <div class="w-16 h-16 rounded-full bg-gray-200 flex-shrink-0 overflow-hidden">
                                <img src="https://ui-avatars.com/api/?name=${course.instructor}&background=random" class="w-full h-full object-cover">
                             </div>
                             <div>
                                <p class="text-xs text-gray-500 font-bold uppercase mb-1">Instructor</p>
                                <h3 class="text-lg font-bold text-gray-900">${course.instructor}</h3>
                                <p class="text-sm text-gray-500">Senior Developer & Educator</p>
                             </div>
                        </div>

                        <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                            <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center gap-2">
                                <i class="fa-solid fa-list-ul text-indigo-600"></i> Course Syllabus
                            </h3>
                            <div class="space-y-3">
                                ${curriculumHTML}
                            </div>
                        </div>

                        <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                            <h3 class="text-xl font-bold text-gray-900 mb-4">Requirements</h3>
                            <ul class="list-disc list-inside text-gray-600 text-sm space-y-2 ml-2">
                                <li>No prior experience required (for beginner courses).</li>
                                <li>A computer with internet access.</li>
                                <li>Desire to learn and practice coding daily.</li>
                            </ul>
                        </div>
                    </div>

                    <div class="lg:col-span-1">
                        <div class="sticky top-24 space-y-6">
                            ${sidebarAction}
                            
                            <div class="flex items-center justify-center gap-2 text-gray-400 text-xs font-medium">
                                <i class="fa-solid fa-shield-halved"></i> 30-Day Money-Back Guarantee
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    `;

            // 6. Inject and Display
            document.getElementById('course-detail-content').innerHTML = html;
        }


        function showCertificateById(certId) {
            const certObj = certificates.find(c => c.id === certId);
            if (certObj) {
                showCertificateScreen(certObj);
            } else {
                alert("Certificate data not found. Please contact support.");
            }
        }

        function renderProfileCourses() {
            const container = document.getElementById('enrolled-courses');
            container.innerHTML = '';

            if (!currentUser || !currentUser.enrolled_courses) {
                container.innerHTML = `<p class="text-gray-500 py-8">You are not currently enrolled in any courses. <button onclick="showCourseList()" class="text-indigo-600 hover:underline font-semibold">Browse courses</button> to get started!</p>`;
                return;
            }

            const enrolledCourses = currentUser.enrolled_courses;
            const enrolledCourseIds = Object.keys(enrolledCourses);
            const userCertificates = certificates.filter(c => c.userId === currentUserId);
            const activeEnrollments = enrolledCourseIds.filter(id => enrolledCourses[id].status === true || enrolledCourses[id].status === false);


            if (activeEnrollments.length === 0) {
                container.innerHTML = `<p class="text-gray-500 py-8">You are not currently enrolled in any courses. <button onclick="showCourseList()" class="text-indigo-600 hover:underline font-semibold">Browse courses</button> to get started!</p>`;
                return;
            }

            activeEnrollments.forEach(courseId => {
                const course = courses.find(c => c.id === courseId);
                const enrollment = enrolledCourses[courseId];

                // --- Consistency FIX: Use the helper function ---
                const cardData = getCourseCardData(courseId);
                const imageURL = cardData.imageURL;
                const instructorName = cardData.instructorName;
                // --- END FIX ---

                if (course && enrollment) {
                    const isEnrolled = enrollment.status === true;
                    const isPending = enrollment.status === false;

                    // Find the certificate object directly
                    const certData = userCertificates.find(c => c.courseId === courseId);
                    const hasCertificate = !!certData;

                    const totalDays = course.curriculum ? course.curriculum.length : 10;
                    const progressPercentage = Math.round(((enrollment.day || 1) / totalDays) * 100);

                    let actionButton;
                    let statusTag;
                    let borderClass = 'border-gray-700';
                    let buttonClass = 'bg-indigo-600 hover:bg-indigo-700';

                    if (hasCertificate) {
                        borderClass = 'border-yellow-500';
                        statusTag = `<span class="bg-yellow-600 text-gray-900 text-xs font-bold px-3 py-1 rounded-full">CERTIFIED</span>`;

                        // Button logic for certified state (View Certificate + Open Course Review)
                        actionButton = `<div class="space-y-1 mt-2">
                                    <button onclick="showCertificateById('${certData.id}')" class="w-full bg-yellow-500 text-gray-900 py-2 rounded-lg hover:bg-yellow-600 text-sm font-semibold">View Certificate ðŸ†</button>
                                    <button onclick="secureStartLearning('${courseId}')" class="w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 text-sm font-semibold">Open Course (Review)</button>
                                </div>`;

                    } else if (isEnrolled) {
                        borderClass = 'border-green-500';
                        statusTag = `<span class="bg-green-600 text-white text-xs font-bold px-3 py-1 rounded-full">IN PROGRESS</span>`;
                        actionButton = `<button onclick="secureStartLearning('${courseId}')" class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 text-sm font-semibold">Continue Learning (Day ${enrollment.day || 1})</button>`;

                    } else if (isPending) {
                        borderClass = 'border-orange-500';
                        statusTag = `<span class="bg-orange-600 text-white text-xs font-bold px-3 py-1 rounded-full">PENDING</span>`;
                        actionButton = `<button onclick="showCourseDetail('${courseId}')" class="w-full bg-orange-600 text-white py-2 rounded-lg hover:bg-orange-700 text-sm font-semibold">View Payment Status</button>`;
                    }


                    container.innerHTML += `
                <div class="card-hover bg-gray-900 rounded-xl shadow-2xl overflow-hidden transform transition-all duration-300 hover:scale-[1.03] w-full sm:w-80 border ${borderClass}">
                    
                    <div class="relative h-20 bg-gray-800">
                        <img src="${imageURL}" alt="${course.title} Instructor" class="w-full h-full object-cover opacity-70">
                        <div class="absolute bottom-0 left-0 bg-black bg-opacity-50 text-gray-400 p-1 text-xs">
                            Instructor: ${instructorName}
                        </div>
                        <div class="absolute top-2 right-2">
                           ${statusTag}
                        </div>
                    </div>

                    <div class="p-3 flex flex-col justify-between h-auto">
                        <div>
                            <h3 class="text-md font-bold text-white mb-1">${course.title}</h3>
                            <p class="text-gray-400 text-xs mb-2">${course.description.substring(0, 50)}...</p>
                        </div>
                        
                        ${isEnrolled && !hasCertificate ? `
                            <div class="mb-3 mt-1">
                                <div class="flex justify-between text-xs font-medium text-gray-400">
                                    <span>Progress:</span>
                                    <span>${progressPercentage}%</span>
                                </div>
                                <div class="w-full bg-gray-700 rounded-full h-2 mt-1">
                                    <div class="progress-bar bg-green-500 h-2 rounded-full" style="width: ${progressPercentage}%"></div>
                                </div>
                            </div>
                        ` : `<div class="h-6 mb-2"></div>`}
                        
                        ${actionButton}
                    </div>
                </div>
            `;
                }
            });
        }

        // ==========================================
        // ðŸŽ“ RENDER MY CERTIFICATES (COURSES + INTERNSHIPS)
        // ==========================================

        // ==========================================
        // ðŸŽ“ MY CERTIFICATES (COURSES + INTERNSHIPS)
        // ==========================================
        // ==========================================
        // ðŸŽ“ RENDER MY CERTIFICATES (COURSES + INTERNSHIPS)
        // ==========================================
        function renderCertificates() {
            const container = document.getElementById('certificates-container');
            if (!container) return;
            container.innerHTML = '';

            // Filter certificates belonging to current user
            const userCertificates = certificates.filter(c => c.userId === currentUserId);

            if (userCertificates.length === 0) {
                container.innerHTML = `<p class="text-gray-500 py-8 text-center w-full">You have not earned any certificates yet. Keep learning!</p>`;
                return;
            }

            userCertificates.forEach(cert => {
                let title = cert.courseTitle;
                let typeLabel = "Course Certificate";
                let borderColor = "border-yellow-500"; // Default Gold
                let icon = "ðŸŽ“";

                // Check if it's an Internship Certificate
                if (cert.courseId.startsWith('INTERN_') || cert.type === 'internship') {
                    typeLabel = "Internship Certificate";
                    borderColor = "border-pink-500"; // Pink for Internships
                    icon = "ðŸ’¼";
                }

                container.innerHTML += `
            <div class="card-hover bg-white p-6 rounded-xl shadow-lg border-t-4 ${borderColor} text-center flex flex-col justify-between h-full">
                <div>
                    <div class="text-5xl mb-3">${icon}</div>
                    <h3 class="text-xl font-bold text-gray-800 mb-1 leading-tight">${title}</h3>
                    <p class="text-xs font-bold uppercase tracking-wider text-gray-500 mb-3">${typeLabel}</p>
                    <p class="text-sm text-gray-500 mb-4">Issued: ${cert.dateDisplay}</p>
                </div>
                <button onclick="showCertificateScreen(certificates.find(c => c.refNo === '${cert.refNo}'))" class="w-full bg-gray-900 text-white py-2 rounded-lg hover:bg-gray-800 transition-colors font-semibold shadow-md">
                    View Certificate
                </button>
            </div>
        `;
            });
        }
        // **************************************************
        // *** 5. RENDER FUNCTIONS (STUDENT) - MODIFIED ***
        // **************************************************

        function renderProfileScreen() {
            if (!currentUser || !currentUser.enrolled_courses) return showLogin();
            hideAllScreens();
            document.getElementById('profile-screen').style.display = 'block';
            document.body.style.backgroundColor = '#f3f4f6';

            const container = document.getElementById('enrolled-courses');
            container.innerHTML = '';

            const enrolledCourses = currentUser.enrolled_courses || {};
            const activeEnrollments = Object.keys(enrolledCourses).filter(courseId => enrolledCourses[courseId].status !== 'REVOKED' && enrolledCourses[courseId].status !== 'DELETED');
            const userCertificates = certificates.filter(c => c.userId === currentUserId);

            if (activeEnrollments.length === 0) {
                container.innerHTML = `<p class="text-gray-500 py-8">You are not currently enrolled in any courses. <button onclick="showCourseList()" class="text-indigo-600 hover:underline font-semibold">Browse courses</button> to get started!</p>`;
                return;
            }

            activeEnrollments.forEach(courseId => {
                const course = courses.find(c => c.id === courseId);
                const enrollment = enrolledCourses[courseId];

                if (course && enrollment) {
                    const isEnrolled = enrollment.status === true;
                    const isPending = enrollment.status === false;
                    let actionButton;
                    let statusTag;
                    let cardClasses = 'border-t-4';
                    const hasCertificate = userCertificates.some(c => c.courseId === courseId);
                    const totalDays = course.curriculum ? course.curriculum.length : 10;

                    // *** PROGRESS BAR REPLACEMENT LOGIC ***

                    if (hasCertificate) {
                        const certData = userCertificates.find(c => c.courseId === courseId);
                        cardClasses += ' border-yellow-500';
                        statusTag = `<span class="bg-yellow-100 text-yellow-800 text-xs font-semibold px-3 py-1 rounded-full">COMPLETE</span>`; // <<-- CHANGED TO COMPLETE
                        actionButton = `<button onclick="showCertificateScreen(certificates.find(c => c.id === '${certData.id}'))" class="w-full bg-yellow-500 text-gray-900 py-2 rounded-lg hover:bg-yellow-600 transition-colors font-semibold">View Certificate</button>`;
                    } else if (isEnrolled) {
                        // If enrolled and no certificate -> INCOMPLETE
                        cardClasses += ' border-green-500';
                        actionButton = `<button onclick="secureStartLearning('${courseId}')" class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition-colors font-semibold">Continue Learning</button>`;
                        statusTag = `<span class="bg-green-100 text-green-800 text-xs font-semibold px-3 py-1 rounded-full">INCOMPLETE</span>`; // <<-- CHANGED TO INCOMPLETE
                    } else if (isPending) {
                        cardClasses += ' border-orange-500';
                        statusTag = `<span class="bg-orange-100 text-orange-800 text-xs font-semibold px-3 py-1 rounded-full">Pending Payment</span>`;
                        actionButton = `<button onclick="initiatePayment('${courseId}')" class="w-full bg-orange-600 text-white py-2 rounded-lg hover:bg-orange-700 transition-colors font-semibold">Complete Payment</button>`;
                    } else {
                        return; // Should not happen for active enrollment
                    }

                    // Progress Bar HTML is removed by setting it to an empty string.
                    const progressHTML = ``; // <<-- REMOVED PROGRESS BAR HTML

                    container.innerHTML += `
                        <div class="card-hover bg-white p-6 rounded-xl shadow-lg w-full md:w-80">
                            <div class="flex justify-between items-start mb-3">
                                <div class="text-3xl">${course.icon}</div>
                                ${statusTag}
                            </div>
                            <h3 class="text-xl font-bold text-gray-800 mb-2">${course.title}</h3>
                            <p class="text-gray-600 mb-4">${course.description}</p>
                            <div class="text-sm text-gray-500 mb-4">
                                <span class="font-medium">${course.duration || 'N/A'} | ${course.level || 'N/A'}</span>
                            </div>
                            ${progressHTML}
                            <div class="mt-4">
                                ${actionButton}
                            </div>
                        </div>
                    `;
                }
            });
        }
        function hasActiveSubscription() {
            if (!currentUser || !currentUser.enrolled_courses) return false;

            const sub = currentUser.enrolled_courses["SUBSCRIPTION"];
            return sub && sub.status === true;
        }
        function getEnrolledCourseCount() {
            if (!currentUser || !currentUser.enrolled_courses) return 0;

            return Object.keys(currentUser.enrolled_courses)
                .filter(id => id !== "SUBSCRIPTION")  // exclude subscription
                .length;
        }


        function renderDashboard() {
            if (!currentUser) return;
            document.getElementById('dashboard-user-name').textContent = currentUser.name.split(' ')[0];

            // FEATURE #1: Show Premium Greeting
            const isSubscriber = hasActiveSubscription();
            const premiumGreeting = document.getElementById('premium-greeting');
            if (isSubscriber) {
                premiumGreeting.classList.remove('hidden');
            } else {
                premiumGreeting.classList.add('hidden');
            }


            const userCertificates = certificates.filter(c => c.userId === currentUserId);
            const enrolledCount = getEnrolledCourseCount();
            const completedCount = userCertificates.length;

            // --- Dashboard Metrics Update (Top Cards) ---
            document.getElementById('enrolled-count').textContent = enrolledCount;
            document.getElementById('certificates-count').textContent = completedCount;

            // --- FIX & UPDATE: Sidebar Widget Metrics Update (Focus Metrics) ---
            const sidebarCoursesRemaining = document.getElementById('sidebar-courses-remaining');
            const sidebarLastActive = document.getElementById('sidebar-last-active');

            // Calculate new metrics
            const remaining = getCoursesRemaining();
            // Use timeSince utility function for display
            const lastActiveTime = currentUser.last_active ? timeSince(currentUser.last_active) : "N/A";

            // Update the sidebar widget elements
            if (sidebarCoursesRemaining) sidebarCoursesRemaining.textContent = remaining;
            if (sidebarLastActive) sidebarLastActive.textContent = lastActiveTime;
            // ------------------------------------------


            const enrolledCourses = currentUser.enrolled_courses || {};
            const activeEnrollments = Object.keys(enrolledCourses).filter(courseId => enrolledCourses[courseId].status === true);

            const continueLearningContainer = document.getElementById('continue-learning');
            continueLearningContainer.innerHTML = '';

            const coursesToContinue = [];

            // Filter: Find courses that are active but NOT yet certified.
            activeEnrollments.forEach(courseId => {
                const course = courses.find(c => c.id === courseId);
                const enrollment = enrolledCourses[courseId];

                if (course && enrollment && !userCertificates.some(c => c.courseId === courseId)) {
                    coursesToContinue.push({ course, enrollment });
                }
            });


            if (coursesToContinue.length === 0) {
                if (activeEnrollments.length === 0) {
                    continueLearningContainer.innerHTML = `<p class="text-gray-500 py-8 text-center w-full">You are not currently enrolled in any active courses. <button onclick="showCourseList()" class="text-indigo-600 hover:underline font-semibold">Browse courses</button> to get started!</p>`;
                } else {
                    continueLearningContainer.innerHTML = `<p class="text-gray-500 py-8 text-center w-full">You have completed and certified all active courses! View your <button onclick="showCertificates()" class="text-yellow-600 hover:underline font-semibold">certificates</button> or <button onclick="showCourseList()" class="text-indigo-600 hover:underline font-semibold">browse new courses</button>.</p>`;
                }
            } else {
                coursesToContinue.forEach(item => {
                    const { course } = item;

                    continueLearningContainer.innerHTML += `
                    <div class="p-4 border rounded-xl bg-gray-50 flex items-center justify-between hover:shadow-md transition-shadow">
                        <div class="flex-grow mr-4">
                            <h4 class="font-semibold text-gray-800">${course.title}</h4>
                            <span class="bg-green-100 text-green-800 text-xs font-semibold px-3 py-1 rounded-full">INCOMPLETE</span>
                        </div>
                        <button onclick="secureStartLearning('${course.id}')" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors flex-shrink-0">
                            Continue
                        </button>
                    </div>`;
                });
            }

            // --- FINAL INTEGRATION: Render all three dynamic graphs ---
            renderStudentDashboardGraph();
            renderPeerComparisonGraph();
            renderWeeklyActivityTrend();
            // --- NEW: Render the Leaderboard ---
            renderLeaderboard();
            // --------------------------------------------------------
        }

        function renderMyAccount() {
            const container = document.getElementById('my-account-details-container');
            container.innerHTML = '';

            if (!currentUser) {
                container.innerHTML = `<p class="text-red-500">Error: User data is not available. Please log in again.</p>`;
                return;
            }

            const DetailRow = (label, value) => `
                <div class="detail-row py-3">
                    <span class="text-sm font-medium text-gray-600">${label}:</span>
                    <span class="text-sm font-semibold text-gray-900">${value}</span>
                </div>
            `;

            const userCertificates = certificates.filter(c => c.userId === currentUserId);
            const enrolledCount = getEnrolledCourseCount();
            const completedCount = userCertificates.length;
            const status = currentUser.disabled ? 'Disabled by Admin' : 'Active';

            container.innerHTML = `
                ${DetailRow('Full Name (Certificate Name)', currentUser.name)}
                 ${DetailRow('Email Address', currentUser.email)}
                     ${DetailRow('Phone Number', currentUser.phone || 'N/A')}
                ${DetailRow('Joined Date', currentUser.joined)}
                <div class="detail-row py-3">
                    <span class="text-sm font-medium text-gray-600">Account Status:</span>
                    <span class="text-sm font-semibold ${currentUser.disabled ? 'text-red-600' : 'text-green-600'}">${status}</span>
                </div>
                ${DetailRow('Total Enrolled Courses', enrolledCount)}
                ${DetailRow('Total Certificates Earned', completedCount)}
            `;
        }

        // **************************************************
        // *** 6. ADMIN DASHBOARD UTILITIES ***
        // **************************************************
        async function toggleCourseStatus(userId, courseId, currentStatus) {
            if (!isAdminLoggedIn) return;

            const newStatus = currentStatus === 'false' ? true : false;
            const isSubscription = courseId === SUBSCRIPTION_ID;

            try {
                // If it's a subscription being approved
                if (isSubscription && newStatus === true) {
                    // REQUIRED STEP: When admin click APROVE then all course acces set to true
                    const allCourseIds = courses.map(c => c.id);
                    const updates = {};

                    // 1. Set the Subscription record status to true
                    updates[`edupro_users/${userId}/enrolled_courses/${SUBSCRIPTION_ID}/status`] = true;

                    // 2. Set all other individual courses to active (status: true)
                    allCourseIds.forEach(id => {
                        updates[`edupro_users/${userId}/enrolled_courses/${id}`] = {
                            courseName: getCourseTitle(id),
                            status: true,
                            enrollDate: new Date().toISOString().split('T')[0],
                            day: 1,
                            isSubscriptionAccess: true
                        };
                    });

                    await database.ref().update(updates);
                    alert(`SUCCESS: SUBCRIPTION for user ${users.find(u => u.uid === userId)?.name} approved. All ${allCourseIds.length} courses are now ACTIVE!`);
                } else {
                    // Existing logic for single course or revoking subscription
                    await database.ref(`edupro_users/${userId}/enrolled_courses/${courseId}/status`).set(newStatus);
                    alert(`Status for ${getCourseTitle(courseId)} for user ${users.find(u => u.uid === userId)?.name} updated to ${newStatus ? 'TRUE (ACTIVE)' : 'FALSE (PENDING/REVOKED)'}`);
                }

                await fetchUserData();
                renderAdminDashboard();

            } catch (error) {
                console.error("Error toggling course status:", error);
                alert(`Failed to update status: ${error.message}`);
            }
        }


        async function sendGlobalNotification(event) {
            event.preventDefault();
            const message = document.getElementById('notification-input').value;
            if (!message) return;

            const notificationData = {
                message: message,
                timestamp: Date.now()
            };

            try {
                // Set the message in the Firebase notifications node
                await database.ref('edupro_notifications').set(notificationData);
                globalNotification = notificationData;
                alert('Notification broadcasted successfully!');
                document.getElementById('notification-input').value = '';
                document.getElementById('current-global-notification').textContent = message;

            } catch (error) {
                console.error('Error sending notification:', error);
                alert('Failed to send notification.');
            }
        }

        // ==========================================
        // ðŸ“Š ADMIN DASHBOARD RENDERER (Unified)
        // ==========================================
        // ==========================================
        // ðŸ“Š RENDER DASHBOARD (FIXED COUNTS & FILTERS)
        // ==========================================
        // ==========================================
        // ðŸ“Š RENDER DASHBOARD (FIXED CHART SIZE)
        // ==========================================
        function renderAdminDashboard() {
            if (!isAdminLoggedIn) return;

            // 1. Calculate Stats
            const distributionData = getCourseEnrollmentDistributionData();
            let totalInterns = 0;
            let totalCoursesActive = 0;
            let totalPending = 0;

            users.forEach(user => {
                if (user.internships) {
                    Object.values(user.internships).forEach(i => {
                        if (i.status === true) totalInterns++;
                        else totalPending++;
                    });
                }
                if (user.enrolled_courses) {
                    Object.values(user.enrolled_courses).forEach(c => {
                        if (c.status === true) totalCoursesActive++;
                        else totalPending++;
                    });
                }
            });

            // 2. Update UI Cards
            document.getElementById('metric-total-students').textContent = users.length;
            document.getElementById('metric-total-certificates').textContent = certificates.length;
            document.getElementById('metric-total-active-users').textContent = totalCoursesActive;
            document.getElementById('metric-total-interns').textContent = totalInterns;

            const approvalText = document.getElementById('approval-metrics');
            if (approvalText) {
                approvalText.innerHTML = `(Active: <span class="text-green-600 font-bold">${totalCoursesActive + totalInterns}</span> / Pending: <span class="text-orange-600 font-bold">${totalPending}</span>)`;
            }
            document.getElementById('last-updated').textContent = new Date().toLocaleTimeString();

            // 3. Render Chart (FIXED SIZE)
            const ctx = document.getElementById('courseChart').getContext('2d');
            if (courseChartInstance) courseChartInstance.destroy();

            // Set container height explicitly before rendering
            ctx.canvas.parentNode.style.height = '400px';
            ctx.canvas.parentNode.style.width = '100%';

            courseChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: distributionData.labels,
                    datasets: [{
                        label: 'Total Enrollments',
                        data: distributionData.enrolledData,
                        backgroundColor: 'rgba(59, 130, 246, 0.7)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 1,
                        barThickness: 40, // Make bars thicker
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false, // Critical for full width/height
                    scales: { y: { beginAtZero: true } }
                }
            });

            // 4. Fill Filters & Render Table
            const courseFilter = document.getElementById('admin-course-filter');
            courseFilter.innerHTML = '<option value="all">All Programs</option>';
            courses.forEach(c => courseFilter.innerHTML += `<option value="${c.id}">Course: ${c.title}</option>`);
            Object.keys(internshipDomains).forEach(key => courseFilter.innerHTML += `<option value="${key}">Internship: ${internshipDomains[key].title}</option>`);

            renderAdminStudentTable();
        }
        // ==========================================
        // ðŸ›¡ï¸ ADMIN TABLE (FIXED)
        // ==========================================

        // ==========================================
        // ðŸ“‹ RENDER TABLE (FIXED PENDING ITEMS)
        // ==========================================
        // ==========================================
        // ðŸ›¡ï¸ ADMIN TABLE RENDERER (FIXED & SELF-CONTAINED)
        // ==========================================

        // ==========================================
        // ðŸ›¡ï¸ ADMIN TABLE RENDERER (SAFE MODE)
        // ==========================================
        function renderAdminStudentTable() {
            console.log("ðŸš€ Starting Admin Table Render...");

            const tbody = document.getElementById('admin-table-body');
            const noResults = document.getElementById('admin-no-results');
            const paginationInfo = document.getElementById('pagination-info');

            // 1. SAFETY CHECK: Does the HTML exist?
            if (!tbody) {
                console.error("âŒ ERROR: Could not find element with id 'admin-table-body'. Check your HTML.");
                return;
            }

            tbody.innerHTML = ''; // Clear table

            // 2. SAFETY CHECK: Is data available?
            if (!users || users.length === 0) {
                console.warn("âš ï¸ No users loaded yet.");
                tbody.innerHTML = '<tr><td colspan="5" class="text-center py-4">No user data available.</td></tr>';
                return;
            }

            // 3. Filter Inputs
            const searchInput = document.getElementById('admin-student-search');
            const filterStatusInput = document.getElementById('admin-status-filter');

            const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
            const filterStatus = filterStatusInput ? filterStatusInput.value : 'all';

            const allRecords = [];

            // 4. GATHER DATA (Try/Catch to prevent crashing)
            try {
                users.forEach(user => {
                    // Courses
                    if (user.enrolled_courses) {
                        Object.keys(user.enrolled_courses).forEach(cid => {
                            if (cid === 'SUBSCRIPTION') return;

                            // Safe Title Lookup
                            let title = cid;
                            if (typeof courses !== 'undefined') {
                                const c = courses.find(x => x.id === cid);
                                if (c) title = c.title;
                            }

                            allRecords.push({
                                type: 'Course',
                                uid: user.uid,
                                name: user.name || 'Unknown',
                                email: user.email || 'No Email',
                                id: cid,
                                title: title,
                                status: user.enrolled_courses[cid].status,
                                date: user.enrolled_courses[cid].enrollDate
                            });
                        });
                    }
                    // Internships
                    if (user.internships) {
                        Object.keys(user.internships).forEach(did => {
                            // Safe Domain Lookup
                            let title = did;
                            if (typeof internshipDomains !== 'undefined' && internshipDomains[did]) {
                                title = internshipDomains[did].title;
                            }

                            allRecords.push({
                                type: 'Internship',
                                uid: user.uid,
                                name: user.name || 'Unknown',
                                email: user.email || 'No Email',
                                id: did,
                                title: title,
                                status: user.internships[did].status,
                                date: user.internships[did].appliedDate
                            });
                        });
                    }
                });
            } catch (err) {
                console.error("âŒ Error processing user data:", err);
            }

            console.log(`Found ${allRecords.length} total records.`);

            // 5. FILTER
            const filtered = allRecords.filter(r => {
                const matchSearch = r.name.toLowerCase().includes(searchTerm) || r.email.toLowerCase().includes(searchTerm);
                let matchStatus = true;
                if (filterStatus !== 'all') {
                    const boolStatus = (filterStatus === 'true');
                    matchStatus = (r.status === boolStatus);
                }
                return matchSearch && matchStatus;
            });

            // 6. SORT
            filtered.sort((a, b) => (a.status === b.status) ? 0 : (a.status ? 1 : -1));

            // 7. PAGINATION & RENDER
            const totalRecords = filtered.length;
            if (paginationInfo) paginationInfo.textContent = `Total Records: ${totalRecords}`;

            if (totalRecords === 0) {
                if (noResults) noResults.classList.remove('hidden');
            } else {
                if (noResults) noResults.classList.add('hidden');

                filtered.forEach(r => {
                    // Badges
                    const statusBadge = r.status
                        ? `<span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs font-bold">Active</span>`
                        : `<span class="bg-orange-100 text-orange-800 px-2 py-1 rounded text-xs font-bold">Pending</span>`;

                    const typeColor = r.type === 'Internship' ? 'text-pink-600 bg-pink-50' : 'text-indigo-600 bg-indigo-50';

                    // Function Strings
                    const toggleFunc = r.type === 'Internship' ? 'toggleInternshipStatus' : 'toggleCourseStatus';

                    // Buttons
                    const actionBtn = r.status
                        ? `<button onclick="${toggleFunc}('${r.uid}', '${r.id}', false)" class="text-red-500 hover:text-red-700 text-xs font-bold border border-red-200 bg-white px-3 py-1 rounded">Revoke</button>`
                        : `<button onclick="${toggleFunc}('${r.uid}', '${r.id}', true)" class="text-white bg-blue-600 hover:bg-blue-700 text-xs font-bold px-3 py-1 rounded shadow">Approve</button>`;

                    const profileBtn = `<button onclick="showAdminUserDetails('${r.uid}')" class="text-purple-600 hover:text-purple-800 text-xs font-bold ml-2 underline">Profile</button>`;

                    const row = `
                <tr class="border-b hover:bg-gray-50">
                    <td class="px-6 py-4 text-sm font-bold text-gray-900">${r.name}</td>
                    <td class="px-6 py-4 text-xs text-gray-500 font-mono">${r.email}</td>
                    <td class="px-6 py-4">
                        <span class="${typeColor} px-2 py-0.5 rounded text-[10px] font-bold uppercase mr-1">${r.type}</span>
                        <span class="text-sm text-gray-700">${r.title}</span>
                    </td>
                    <td class="px-6 py-4">${statusBadge}</td>
                    <td class="px-6 py-4 flex items-center">
                        ${actionBtn}
                        ${profileBtn}
                    </td>
                </tr>
            `;
                    tbody.innerHTML += row;
                });
            }
        }
        function showAdminUserDetails(userId) {
            if (!isAdminLoggedIn) return;
            const modal = document.getElementById('admin-user-details-modal');
            const user = users.find(u => u.uid === userId);

            if (!user) {
                alert("User data not found.");
                return;
            }

            modal.style.display = 'flex';
            modal.setAttribute('data-user-id', userId);

            const userCertificates = certificates.filter(c => c.userId === userId);
            const enrolledCourses = user.enrolled_courses || {};
            const enrolledCourseIds = Object.keys(enrolledCourses);
            const enrolledCount = enrolledCourseIds.length;
            const completedCount = userCertificates.length;


            const modalUserName = document.getElementById('modal-user-name');
            const infoContainer = document.getElementById('modal-user-info');

            if (modalUserName) modalUserName.textContent = user.name;

            const disableBtn = document.getElementById('disable-user-btn');
            const currentDisabledStatus = user.disabled || false;
            disableBtn.textContent = currentDisabledStatus ? 'âœ… ENABLE User' : 'ðŸš« DISABLE User';

            disableBtn.className = `px-4 py-2 rounded-lg text-sm transition-colors flex-1 shadow-md font-semibold ${currentDisabledStatus
                ? 'bg-green-600 hover:bg-green-700 text-white'
                : 'bg-yellow-500 hover:bg-yellow-600 text-gray-900'
                }`;

            const DetailRow = (label, value, colorClass = 'text-gray-900', isMonospace = false) => `
                <div class="detail-row">
                    <span class="text-sm font-medium text-gray-500">${label}:</span>
                    <span class="text-sm font-semibold ${colorClass} ${isMonospace ? 'font-mono text-xs' : ''} break-all">${value}</span>
                </div>
            `;


            infoContainer.innerHTML = `
                ${DetailRow('UID', user.uid, 'text-indigo-700', true)}
                ${DetailRow('Email', user.email)}
                ${DetailRow('Phone', user.phone || 'N/A')}
                ${DetailRow('Joined Date', user.joined)}
                ${DetailRow('Last Active', `${new Date(user.last_active).toLocaleString()} (${isUserOnline(user.last_active) ? 'Online' : 'Offline'})`)}
                ${DetailRow('Enrolled / Certified', `${enrolledCount} / ${completedCount}`, 'text-indigo-600')}
                <div class="p-2 mt-3 rounded-lg text-center font-extrabold ${currentDisabledStatus ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'}">
                    ACCOUNT STATUS: ${currentDisabledStatus ? 'DISABLED (Locked)' : 'ENABLED (Active)'}
                </div>
            `;

            const courseListContainer = document.getElementById('modal-course-list');
            courseListContainer.innerHTML = '';

            document.getElementById('modal-enrolled-count').textContent = enrolledCount;

            if (enrolledCourseIds.length === 0) {
                courseListContainer.innerHTML = '<p class="text-gray-500 p-4 text-center bg-gray-100 rounded-lg">No enrollments found for this user.</p>';
            } else {
                enrolledCourseIds.forEach(courseId => {
                    const course = courses.find(c => c.id === courseId);
                    const enrollment = enrolledCourses[courseId];

                    if (course) {
                        const isEnrolled = enrollment.status === true;
                        const statusColor = isEnrolled ? 'bg-green-500 text-white' : 'bg-orange-500 text-white';
                        const statusText = isEnrolled ? 'Active' : 'Pending';
                        const totalDays = course.curriculum ? course.curriculum.length : 10;
                        const progress = Math.round(((enrollment.day || 1) / totalDays) * 100);
                        const isCertified = userCertificates.some(c => c.courseId === courseId);

                        const enrollmentActionButton = isEnrolled
                            ? `<button onclick="toggleCourseStatus('${userId}', '${courseId}', 'true'); showAdminUserDetails('${userId}')" class="bg-gray-400 text-white px-3 py-1 text-xs rounded-lg hover:bg-gray-500 transition-colors shadow-sm font-medium">Revoke</button>`
                            : `<button onclick="toggleCourseStatus('${userId}', '${courseId}', 'false'); showAdminUserDetails('${userId}')" class="bg-blue-600 text-white px-3 py-1 text-xs rounded-lg hover:bg-blue-700 transition-colors shadow-sm font-medium">Approve</button>`;

                        const certificateButton = isCertified
                            ? `<span class="bg-yellow-500 text-gray-900 px-3 py-1 text-xs font-bold rounded-lg ml-2 shadow-sm">Certified ðŸ†</span>`
                            : '';

                        courseListContainer.innerHTML += `
                            <div class="course-item-admin border border-indigo-100 p-4 rounded-xl bg-white shadow-sm">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-bold text-indigo-700">${course.icon} ${course.title}</h4>
                                    <span class="px-3 py-1 text-xs font-bold rounded-full ${statusColor}">${statusText}</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="progress-bar bg-indigo-500 h-2 rounded-full" style="width: ${progress}%"></div>
                                </div>
                                <div class="flex justify-between items-center text-xs text-gray-600 mt-2 pt-2 border-t border-gray-100">
                                    <span class="font-medium">Day ${enrollment.day || 1} of ${totalDays} (${progress}%)</span>
                                    <div class="flex items-center space-x-2">
                                        ${certificateButton}
                                        ${enrollmentActionButton}
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                });
            }
        }
        // Add this function inside your existing <script> tags:

        async function downloadCurrentCertificate(format) {
            const certContainer = document.getElementById('certificate-content');
            const userName = certContainer.getAttribute('data-user-name') || 'Student';
            const courseTitle = certContainer.getAttribute('data-course-title') || 'Course';
            const refNo = certContainer.getAttribute('data-ref') || 'CERT00';
            const fileName = `${userName.replace(/ /g, '_')}_${courseTitle.replace(/ /g, '_')}_${refNo}.${format.toLowerCase()}`;

            // Temporarily hide the watermark and adjust scaling for better quality
            const watermark = document.querySelector('#certificate-content .watermark');
            if (watermark) watermark.style.display = 'none';

            showLoader(); // Show global loader during processing

            try {
                const canvas = await html2canvas(certContainer, {
                    scale: 2, // Use scale 2 for high resolution output
                    useCORS: true,
                    allowTaint: true,
                    scrollY: -window.scrollY, // Correctly handle scroll position
                    windowWidth: document.documentElement.offsetWidth,
                    windowHeight: document.documentElement.offsetHeight
                });

                const image = canvas.toDataURL(`image/${format.toLowerCase()}`);
                const link = document.createElement('a');

                if (format.toLowerCase() === 'png') {
                    link.href = image;
                    link.download = fileName;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }

                // Note: The PDF logic needs updating, but the current PDF function is elsewhere.
                // The original PDF function is still in Section 6.
                else if (format.toLowerCase() === 'pdf') {
                    // Re-run the existing PDF logic to ensure it works
                    downloadCertificate('pdf');
                }

            } catch (error) {
                console.error("Error generating certificate image:", error);
                alert("Failed to download certificate. Check browser console for details.");
            } finally {
                // Restore watermark and hide loader
                if (watermark) watermark.style.display = 'block';
                hideLoader();
            }
        }

        function closeAdminUserDetails() {
            document.getElementById('admin-user-details-modal').style.display = 'none';
            document.getElementById('admin-user-details-modal').removeAttribute('data-user-id');
        }

        // **************************************************
        // *** 7. GLOBAL INITIALIZATION CALL ***
        // **************************************************

        initializeUI();
    </script>
    <script>
        // --- TESTIMONIAL SLIDER LOGIC ---
        let currentTestimonialIndex = 0;
        const testimonialsTrack = document.getElementById('testimonials-track');
        // Get the total number of testimonial slides in the track
        const totalTestimonials = testimonialsTrack ? testimonialsTrack.children.length : 0;
        let autoSlideInterval;
        const slideDuration = 5000; // Slide every 5 seconds (5000 milliseconds)

        function moveTestimonialSlider(direction) {
            if (!testimonialsTrack || totalTestimonials === 0) return;

            // Clear the automatic interval whenever a manual button is pressed
            if (direction !== 'auto') {
                clearInterval(autoSlideInterval);
            }

            // Calculate the new index
            let newIndex = currentTestimonialIndex;

            if (direction === 1 || direction === 'auto') {
                newIndex++;
            } else if (direction === -1) {
                newIndex--;
            }

            // Handle wrapping (looping)
            if (newIndex >= totalTestimonials) {
                newIndex = 0; // Wrap to the first slide
            } else if (newIndex < 0) {
                newIndex = totalTestimonials - 1; // Wrap to the last slide
            }

            // Update the current index
            currentTestimonialIndex = newIndex;

            // Calculate the required horizontal shift (percentage)
            const offset = currentTestimonialIndex * 100;

            // Apply the transform to the track element
            testimonialsTrack.style.transform = `translateX(-${offset}%)`;

            // Restart the automatic interval after a manual move
            if (direction !== 'auto') {
                startAutoSlide();
            }
        }

        function startAutoSlide() {
            // Only start if the track exists and there's more than one slide
            if (testimonialsTrack && totalTestimonials > 1) {
                // Clear any existing interval first to prevent overlaps
                if (autoSlideInterval) {
                    clearInterval(autoSlideInterval);
                }
                // Set the new interval
                autoSlideInterval = setInterval(() => {
                    moveTestimonialSlider('auto');
                }, slideDuration);
            }
        }

        // Initialize the automatic slider movement when the page loads
        document.addEventListener('DOMContentLoaded', startAutoSlide);
        // --- END TESTIMONIAL SLIDER LOGIC ---
    </script>

    <script>
        let studentProgressChartInstance = null;

        function renderStudentDashboardGraph() {
            if (!currentUser || !currentUser.enrolled_courses) return;

            const enrolledCourses = currentUser.enrolled_courses;
            const userCertificates = certificates.filter(c => c.userId === currentUserId);

            // --- CRITICAL: Tracking based on total courses ---
            const totalEnrolled = getEnrolledCourseCount();
            const totalCertified = userCertificates.length;
            const totalIncomplete = totalEnrolled - totalCertified;

            // 1. Determine Data Points (The required metrics)
            const coursesRegistered = totalEnrolled;
            const coursesCompleted = totalCertified;
            const coursesPendingOrActive = totalIncomplete;

            const labels = ['Incomplete (Active/Pending)', 'Completed (Certified)'];
            const dataPoints = [coursesPendingOrActive, coursesCompleted];
            const backgroundColors = ['#f59e0b', '#10b981']; // Amber (Incomplete), Green (Certified)

            const ctx = document.getElementById('studentProgressChart')?.getContext('2d');

            if (!ctx) return;

            if (studentProgressChartInstance) {
                studentProgressChartInstance.destroy();
            }

            studentProgressChartInstance = new Chart(ctx, {
                type: 'doughnut', // Use a simple Donut chart for categorical data
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Course Status',
                        data: dataPoints,
                        backgroundColor: backgroundColors,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20
                            }
                        },
                        title: {
                            display: true,
                            text: `Overall Course Status (Total Registered: ${coursesRegistered})`
                        }
                    }
                }
            });
        }
    </script>


    <script>
        let peerComparisonChartInstance = null;

        function renderPeerComparisonGraph() {
            if (!currentUser || !currentUser.enrolled_courses) return;

            const userCertificates = certificates.filter(c => c.userId === currentUserId);
            const totalEnrolled = getEnrolledCourseCount();
            const totalCertified = userCertificates.length;

            // Calculate User Completion Rate
            const userCompletionRate = totalEnrolled > 0 ?
                Math.round((totalCertified / totalEnrolled) * 100) : 0;

            // --- Simulated Platform Average ---
            // In a real app, this would come from the Admin dashboard data.
            // Using a constant for now.
            const platformAverageRate = 65;
            // ----------------------------------

            const labels = ['You', 'Platform Average'];
            const dataPoints = [userCompletionRate, platformAverageRate];

            const backgroundColors = [
                userCompletionRate >= platformAverageRate ? '#10b981' : '#f59e0b', // Green if better/equal, Amber if lower
                '#6366f1' // Indigo for comparison
            ];

            const ctx = document.getElementById('peerComparisonChart')?.getContext('2d');

            if (!ctx) return;

            if (peerComparisonChartInstance) {
                peerComparisonChartInstance.destroy();
            }

            peerComparisonChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Completion Rate (%)',
                        data: dataPoints,
                        backgroundColor: backgroundColors,
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y', // Make it a horizontal bar chart
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: 'Peer Certification Comparison'
                        }
                    },
                    scales: {
                        x: {
                            min: 0,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Completion Percentage'
                            }
                        }
                    }
                }
            });
        }
    </script>

    <script>
        let weeklyActivityTrendChartInstance = null;

        async function renderWeeklyActivityTrend() {
            if (!currentUserId) return;

            const days = [];
            const dataMinutes = [];
            const simulatedAvg = 35; // Keep the motivational goal line

            const now = new Date();
            const logDates = [];

            // 1. Generate the last 7 dates for the X-axis and DB keys
            for (let i = 6; i >= 0; i--) {
                const d = new Date(now);
                d.setDate(now.getDate() - i);

                // Format for chart label (e.g., 'Wed 15')
                const label = d.toLocaleString('en-US', { weekday: 'short', day: 'numeric' });
                days.push(label);

                // Format for database key (e.g., '2025-11-17')
                logDates.push(d.toISOString().split('T')[0]);
            }

            // 2. Fetch Real-Time Data from Firebase
            const snapshot = await firebase.database().ref(`${ACTIVITY_LOG_PATH}/${currentUserId}`).once('value');
            const userActivity = snapshot.val() || {};

            // 3. Map the fetched data to the graph array
            logDates.forEach(dateKey => {
                const minutes = userActivity[dateKey] || 0;
                dataMinutes.push(minutes);
            });

            const ctx = document.getElementById('weeklyActivityTrendChart')?.getContext('2d');

            if (!ctx) return;

            if (weeklyActivityTrendChartInstance) {
                weeklyActivityTrendChartInstance.destroy();
            }

            weeklyActivityTrendChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: days,
                    datasets: [{
                        label: 'Minutes Studied',
                        data: dataMinutes,
                        borderColor: '#4f46e5', // Indigo
                        backgroundColor: 'rgba(79, 70, 229, 0.1)',
                        fill: true,
                        tension: 0.3,
                        pointRadius: 5,
                        pointBackgroundColor: '#4f46e5',
                    },
                    {
                        label: 'Your Weekly Goal',
                        data: Array(7).fill(simulatedAvg), // Horizontal line at 35 minutes
                        borderColor: '#f59e0b', // Amber
                        backgroundColor: 'transparent',
                        borderDash: [5, 5],
                        pointRadius: 0,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' },
                        title: {
                            display: true,
                            text: 'Minutes Spent Active on Platform (Last 7 Days)'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Minutes'
                            },
                            // --- CRITICAL FIX: Custom Y-Axis Label Callback ---
                            ticks: {
                                callback: function (value, index, values) {
                                    if (value < 60) {
                                        return value + ' mins';
                                    } else {
                                        const hours = Math.floor(value / 60);
                                        const remainingMins = value % 60;
                                        if (remainingMins === 0) {
                                            return hours + ' hrs';
                                        }
                                        return hours + 'h ' + remainingMins + 'm';
                                    }
                                }
                            }
                            // ----------------------------------------------------
                        }
                    }
                }
            });
        }
    </script>


    <!-- LEADERBOARD -->

    <script>
        function getCertificatesByUser(userId) {
            return certificates.filter(c => c.userId === userId).length;
        }

        function getLeaderboardData() {
            // Map all users to their certificate count and filter out users with 0 certs
            const leaderboard = users
                .map(user => ({
                    uid: user.uid,
                    name: user.name,
                    certCount: getCertificatesByUser(user.uid)
                }))
                .filter(user => user.certCount > 0);

            // Sort by certificate count (descending)
            leaderboard.sort((a, b) => b.certCount - a.certCount);

            return leaderboard.slice(0, 5); // Return Top 5
        }
        function renderLeaderboard() {
            const container = document.getElementById('leaderboard-list');
            const topAchievers = getLeaderboardData();

            if (topAchievers.length === 0) {
                container.innerHTML = `<p class="text-gray-500 text-sm py-2 text-center">No certificates issued yet to form a leaderboard.</p>`;
                return;
            }

            container.innerHTML = topAchievers.map((user, index) => {
                const rank = index + 1;
                const initials = user.name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
                let badgeHTML = '';
                let rankClass = 'bg-gray-50 text-gray-700';

                if (rank === 1) {
                    badgeHTML = `<span class="text-4xl" style="color:#FFD700;">ðŸ¥‡</span>`;
                    rankClass = 'bg-yellow-50/70 border-l-4 border-yellow-500 shadow-sm';
                } else if (rank === 2) {
                    badgeHTML = `<span class="text-4xl" style="color:#C0C0C0;">ðŸ¥ˆ</span>`;
                    rankClass = 'bg-gray-100 border-l-4 border-gray-400 shadow-sm';
                } else if (rank === 3) {
                    badgeHTML = `<span class="text-4xl" style="color:#CD7F32;">ðŸ¥‰</span>`;
                    rankClass = 'bg-orange-50/70 border-l-4 border-orange-400 shadow-sm';
                } else {
                    badgeHTML = `<span class="text-lg font-bold text-gray-500">#${rank}</span>`;
                }

                return `
                    <div class="flex items-center justify-between p-3 rounded-xl ${rankClass}">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 flex items-center justify-center text-xl font-extrabold" style="width:30px;text-align:center;">
                                ${badgeHTML}
                            </div>
                            <div class="w-10 h-10 bg-indigo-600 rounded-full flex items-center justify-center text-white text-sm font-semibold flex-shrink-0">
                                ${initials}
                            </div>
                            <span class="text-sm font-medium text-gray-800 truncate">${user.name}</span>
                        </div>
                        <div class="flex items-center space-x-1 text-red-500 font-bold flex-shrink-0">
                            <i class="fa-solid fa-certificate"></i>
                            <span>${user.certCount}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }
    </script>

    <script>
        // BLOG SCRIPT
        function showBlog() {
            // Replace 'blog.html' with the actual path to your page
            window.location.href = 'blog.html';
        }



        document.addEventListener("DOMContentLoaded", () => {
            const bgContainer = document.getElementById('hero-floating-bg');
            if (!bgContainer) return;

            // Massive List of Tech Icons (Brands & General Tech)
            const techIcons = [
                // Programming Languages & Frameworks
                'fa-python', 'fa-java', 'fa-js', 'fa-html5', 'fa-css3-alt',
                'fa-react', 'fa-angular', 'fa-vuejs', 'fa-node-js', 'fa-node',
                'fa-php', 'fa-laravel', 'fa-symfony', 'fa-sass', 'fa-less',
                'fa-bootstrap', 'fa-wordpress', 'fa-drupal', 'fa-joomla',
                'fa-docker', 'fa-aws', 'fa-digital-ocean', 'fa-jenkins',
                'fa-git-alt', 'fa-github', 'fa-gitlab', 'fa-bitbucket',
                'fa-npm', 'fa-yarn', 'fa-rust', 'fa-golang', 'fa-swift',
                'fa-android', 'fa-apple', 'fa-linux', 'fa-ubuntu', 'fa-centos',
                'fa-redhat', 'fa-fedora', 'fa-windows', 'fa-chrome', 'fa-firefox',
                'fa-edge', 'fa-safari', 'fa-opera', 'fa-internet-explorer',
                'fa-unity', 'fa-jira', 'fa-confluence', 'fa-trello', 'fa-slack',
                'fa-figma', 'fa-sketch', 'fa-invision', 'fa-dropbox', 'fa-google-drive',
                // General Tech Concepts (Solid Icons)
                'fa-code', 'fa-laptop-code', 'fa-terminal', 'fa-bug', 'fa-database',
                'fa-server', 'fa-cloud', 'fa-network-wired', 'fa-microchip',
                'fa-memory', 'fa-hard-drive', 'fa-wifi', 'fa-sitemap',
                'fa-briefcase', 'fa-user-tie', 'fa-certificate', 'fa-graduation-cap',
                'fa-book-open', 'fa-chart-line', 'fa-chart-pie', 'fa-robot'
            ];

            // Vibrant Brand Colors to stand out on White Background
            const colors = [
                '#e34c26', '#264de4', '#f7df1e', '#61DAFB', '#3C873A', // HTML, CSS, JS, React, Node
                '#007acc', '#cc3e44', '#4B8BBE', '#306998', '#FFE873', // TS, Angular, Python
                '#f05032', '#333333', '#F05032', '#2496ED', '#000000', // Git, Github, Docker
                '#FF9900', '#00758F', '#4E5D6C', '#1e1b4b', '#374151', // AWS, MySQL, Navy, Dark Grey
                '#4338ca', '#be185d', '#059669', '#d97706', '#dc2626'  // Indigo, Pink, Emerald, Amber, Red
            ];

            // Generate 50 Floating Icons
            for (let i = 0; i < 50; i++) {
                const icon = document.createElement('i');
                const randomIcon = techIcons[Math.floor(Math.random() * techIcons.length)];

                // Logic to determine if it's a Brand icon (fa-brands) or Solid icon (fa-solid)
                // Most specific tech names are brands, generic concepts are solid
                let type = 'fa-brands';
                const solidIcons = ['fa-code', 'fa-laptop-code', 'fa-terminal', 'fa-bug', 'fa-database', 'fa-server', 'fa-cloud', 'fa-network-wired', 'fa-microchip', 'fa-memory', 'fa-hard-drive', 'fa-wifi', 'fa-sitemap', 'fa-briefcase', 'fa-user-tie', 'fa-certificate', 'fa-graduation-cap', 'fa-book-open', 'fa-chart-line', 'fa-chart-pie', 'fa-robot'];

                if (solidIcons.includes(randomIcon)) {
                    type = 'fa-solid';
                }

                icon.classList.add(type, randomIcon, 'float-item');

                // Random Horizontal Position (0% to 95%)
                icon.style.left = `${Math.random() * 95}%`;

                // Random Size (20px to 60px) - clearly visible
                const size = Math.random() * 40 + 20;
                icon.style.fontSize = `${size}px`;

                // Random Color
                icon.style.color = colors[Math.floor(Math.random() * colors.length)];

                // Random Animation Speed (10s to 30s)
                icon.style.animationDuration = `${Math.random() * 20 + 10}s`;

                // Random Delay (so they don't all start at once)
                icon.style.animationDelay = `${Math.random() * 20}s`;

                bgContainer.appendChild(icon);
            }
        });
    </script>

    <script>

        let activeJobFilterCriteria = 'all';

        // --- UPDATED PUBLIC JOB LOGIC ---

        // 1. Global variable to store fetched jobs for filtering

        async function showJobs() {
            hideAllScreens();
            document.getElementById('forum-screen').style.display = 'none';

            const screen = document.getElementById('jobs-screen');
            if (screen) {
                screen.style.display = 'block';
                document.body.style.backgroundColor = '#F8F9FC';

                // FETCH REAL DATA
                const container = document.getElementById('jobs-grid-display');
                container.innerHTML = '<div class="col-span-full text-center py-10"><div class="lds-ring"><div></div><div></div><div></div><div></div></div><p class="mt-2 text-gray-500">Loading fresh opportunities...</p></div>';

                try {
                    const snapshot = await database.ref('edupro_jobs').once('value');
                    const data = snapshot.val();

                    if (!data) {
                        liveJobsCache = [];
                    } else {
                        // Convert object to array
                        liveJobsCache = Object.values(data).reverse(); // Newest first
                    }

                    // Render
                    renderJobCards(liveJobsCache);

                } catch (error) {
                    console.error("Firebase Job Fetch Error:", error);
                    container.innerHTML = '<div class="col-span-full text-center text-red-500">Failed to load jobs. Please try again.</div>';
                }
            }
        }

        // 2. Update Render Function to handle the new data structure
        function renderJobCards(data) {
            const container = document.getElementById('jobs-grid-display');
            const noMsg = document.getElementById('no-jobs-message');
            if (!container) return;

            container.innerHTML = '';

            if (data.length === 0) {
                if (noMsg) noMsg.classList.remove('hidden');
                return;
            }
            if (noMsg) noMsg.classList.add('hidden');

            data.forEach(job => {
                const tagsHtml = (job.tags || []).map(t => `<span class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-md border border-gray-200">${t}</span>`).join('');

                const html = `
            <div class="bg-white rounded-2xl p-6 border border-gray-200 hover:shadow-xl transition-all duration-300 flex flex-col justify-between h-full hover:-translate-y-1 group hover:border-indigo-200">
                <div>
                    <div class="flex justify-between items-start mb-4">
                        <div class="w-12 h-12 ${job.logoBg} rounded-xl flex items-center justify-center shadow-sm text-white text-xl font-bold">
                            ${job.company.charAt(0)}
                        </div>
                        <span class="${job.type === 'Remote' ? 'bg-blue-50 text-blue-600 border-blue-100' : 'bg-gray-100 text-gray-600'} border px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide">
                            ${job.type}
                        </span>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-1 group-hover:text-indigo-600 transition-colors">${job.role}</h3>
                    <p class="text-gray-500 text-sm mb-4 font-medium flex items-center"><i class="fa-solid fa-building mr-2"></i> ${job.company}</p>
                    
                    <div class="flex flex-col gap-2 mb-5">
                        <div class="flex items-center text-gray-500 text-sm">
                            <i class="fa-solid fa-location-dot w-5 text-gray-400"></i> ${job.location}
                        </div>
                        <div class="flex items-center text-green-600 font-bold text-sm">
                            <i class="fa-solid fa-money-bill-wave w-5"></i> ${job.salary}
                        </div>
                    </div>

                    <div class="flex flex-wrap gap-2 mb-6">${tagsHtml}</div>
                </div>
                <button onclick="showToast('Application sent to ${job.company}!', 'success')" class="w-full bg-[#1E293B] text-white py-3 rounded-xl font-bold hover:bg-indigo-600 transition-colors shadow-lg">
                    Apply Now
                </button>
            </div>
        `;
                container.innerHTML += html;
            });
        }

        // 3. Update Filter Logic to use liveJobsCache
        function executeJobFilter() {
            const term = document.getElementById('job-search-input').value.toLowerCase();

            // activeJobFilterCriteria is defined globally in your previous code (make sure it exists)
            // If not, add: let activeJobFilterCriteria = 'all'; at top of script

            const filtered = liveJobsCache.filter(job => {
                const matchesSearch = job.role.toLowerCase().includes(term) || job.company.toLowerCase().includes(term);
                let matchesType = true;

                if (activeJobFilterCriteria === 'Remote') matchesType = job.type === 'Remote';
                else if (activeJobFilterCriteria === 'HighPay') matchesType = job.salaryVal >= 100000;
                else if (activeJobFilterCriteria === 'Frontend') matchesType = job.category === 'Frontend' || job.role.toLowerCase().includes('frontend');
                else if (activeJobFilterCriteria === 'Backend') matchesType = job.category === 'Backend' || job.role.toLowerCase().includes('backend');
                else if (activeJobFilterCriteria !== 'all') matchesType = job.category === activeJobFilterCriteria;

                return matchesSearch && matchesType;
            });

            renderJobCards(filtered);
        }


        // --- 4. FILTER LOGIC ---
        function filterJobs(criteria, btn) {
            // Style buttons
            if (btn) {
                document.querySelectorAll('.job-filter-btn').forEach(b => {
                    b.classList.remove('bg-indigo-600', 'text-white', 'border-indigo-600');
                    b.classList.add('bg-white', 'text-gray-600', 'border-gray-200');
                });
                btn.classList.remove('bg-white', 'text-gray-600', 'border-gray-200');
                btn.classList.add('bg-indigo-600', 'text-white', 'border-indigo-600');
            }

            activeJobFilterCriteria = criteria;
            executeJobFilter();
        }

        function executeJobFilter() {
            const term = document.getElementById('job-search-input').value.toLowerCase();

            const filtered = globalJobsData.filter(job => {
                const matchesSearch = job.role.toLowerCase().includes(term) || job.company.toLowerCase().includes(term);
                let matchesType = true;

                if (activeJobFilterCriteria === 'Remote') matchesType = job.type === 'Remote';
                else if (activeJobFilterCriteria === 'HighPay') matchesType = job.salaryVal >= 100000;
                else if (activeJobFilterCriteria !== 'all') matchesType = job.category === activeJobFilterCriteria;

                return matchesSearch && matchesType;
            });

            renderJobCards(filtered);
        }

        // --- 5. OVERWRITE HIDE ALL SCREENS ---
        // This ensures the job screen actually closes when you leave

        // ==========================================
        // ðŸ›¡ï¸ UTILS: HIDE ALL SCREENS (STRICT MODE)
        // ==========================================
        // ==========================================
        // ðŸ›¡ï¸ UTILS: HIDE ALL SCREENS (STRICT MODE)
        // ==========================================
        function hideAllScreens() {
            const screens = [
                // Main Screens
                'welcome-screen', 'login-form', 'register-form', 'dashboard-screen',
                'course-list', 'course-detail', 'profile-screen',
                'certificate-screen', 'certificates-screen', 'my-account-screen',
                'jobs-screen', 'roadmap-screen', 'resume-scanner-screen',

                // THE MISSING SCREENS (Adding these fixes the overlap issue)
                'forum-screen',
                'internship-selection-modal',
                'internship-task-screen',
                'internship-detail-screen',

                // Admin Screens
                'admin-dashboard-panel', 'admin-login-screen', 'admin-user-details-modal',

                // Modals
                'notification-modal', 'course-wrapper'
            ];

            screens.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.style.setProperty('display', 'none', 'important'); // Force hide
            });

            document.body.style.backgroundColor = 'white';
        }
    </script>

    <script>

        function toggleFaq(button) {
            const item = button.closest('.accordion-item');
            const content = item.querySelector('.accordion-content');
            const icon = button.querySelector('.fa-chevron-down');

            // Close all other open items
            document.querySelectorAll('.accordion-item').forEach(otherItem => {
                if (otherItem !== item) {
                    otherItem.querySelector('.accordion-content').classList.add('hidden');
                    otherItem.querySelector('.fa-chevron-down').classList.remove('rotate-180');
                }
            });

            // Toggle the clicked item
            content.classList.toggle('hidden');
            icon.classList.toggle('rotate-180');
        }
    </script>



    <!-- TOAST MESG -->
    <script>
        // --- TOAST HELPER FUNCTION ---
        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');

            let icon = '';
            if (type === 'success') icon = '<i class="fa-solid fa-circle-check text-green-600 text-xl mr-3"></i>';
            if (type === 'error') icon = '<i class="fa-solid fa-circle-xmark text-red-600 text-xl mr-3"></i>';
            if (type === 'info') icon = '<i class="fa-solid fa-circle-info text-blue-600 text-xl mr-3"></i>';

            toast.className = `toast toast-${type}`;
            toast.innerHTML = `${icon} <div><h4 class="font-bold text-gray-800 text-sm capitalize">${type}</h4><p class="text-gray-600 text-sm">${message}</p></div>`;

            container.appendChild(toast);

            // Trigger animation
            requestAnimationFrame(() => { toast.classList.add('show'); });

            // Auto Remove
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Usage Example (Replace your alerts with this):
        // showToast('Login Successful!', 'success');
        // showToast('Invalid Password', 'error');
    </script>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <script>
        AOS.init({
            duratioscreenn: 800, // Animation duration
            once: true,    // Animate only once
        });
    </script>

    <!-- darkmode -->
    <script>


        // ==========================================
        // ðŸŒ“ DARK MODE WITH MEMORY
        // ==========================================

        // 1. Check preference on load
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme');

            // If saved is 'dark', or if no save but user's system OS is dark
            if (savedTheme === 'dark' || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
                document.body.style.backgroundColor = '#111827'; // Dark BG
                updateThemeIcon(true);
            }
        });

        // 2. Toggle Function
        function toggleDarkMode() {
            const html = document.documentElement;
            const isDark = html.classList.toggle('dark');

            if (isDark) {
                localStorage.setItem('theme', 'dark');
                document.body.style.backgroundColor = '#111827';
                updateThemeIcon(true);
            } else {
                localStorage.setItem('theme', 'light');
                document.body.style.backgroundColor = '#F8F9FC'; // Light BG
                updateThemeIcon(false);
            }
        }

        // 3. Icon Updater Helper
        function updateThemeIcon(isDark) {
            const icon = document.getElementById('theme-icon');
            if (isDark) {
                icon.classList.replace('fa-moon', 'fa-sun');
                icon.classList.remove('text-gray-700');
                icon.classList.add('text-yellow-400');
            } else {
                icon.classList.replace('fa-sun', 'fa-moon');
                icon.classList.remove('text-yellow-400');
                icon.classList.add('text-gray-700');
            }
        }
    </script>




    <!-- ROADMAPS SCRIPT -->
    <script>
        // 1. ADD THIS FUNCTION
        function showRoadmap() {
            hideAllScreens();
            const screen = document.getElementById('roadmap-screen');
            screen.style.display = 'block';

            // Set dark background specifically for roadmap
            document.body.style.backgroundColor = '#0f172a'; // matches slate-900
        }

        // 2. UPDATE YOUR hideAllScreens FUNCTION (Replace the existing one)
        function hideAllScreens() {
            const screens = [
                'welcome-screen', 'login-form', 'register-form', 'dashboard-screen',
                'course-list', 'course-detail', 'profile-screen', 'certificate-screen',
                'certificates-screen', 'admin-dashboard-panel', 'admin-login-screen',
                'admin-user-details-modal', 'my-account-screen', 'notification-modal',
                'course-wrapper', 'jobs-screen',
                'roadmap-screen' // <--- ADDED THIS NEW ID
            ];

            screens.forEach(id => {
                const element = document.getElementById(id);
                if (element) element.style.display = 'none';
            });

            // Default background reset
            document.body.style.backgroundColor = 'white';
        }
    </script>


    <!-- ROADMAPS -->
    <script>
        // --- ROADMAP DATA & LOGIC ---

        // 1. Data Definitions for Different Paths
        const roadmapDatabase = {
            fullstack: {
                title: "Full Stack Developer Path",
                steps: [
                    { title: "The Foundation", desc: "HTML5, CSS3, Semantic Web, DOM Manipulation.", color: "blue" },
                    { title: "JavaScript Mastery", desc: "ES6+, Async/Await, Closures, Fetch API.", color: "yellow" },
                    { title: "Frontend Frameworks", desc: "React.js, Tailwind CSS, State Management (Redux).", color: "cyan" },
                    { title: "Backend Engineering", desc: "Node.js, Express, RESTful APIs, Authentication.", color: "green" },
                    { title: "Database Management", desc: "MongoDB, PostgreSQL, ORMs like Prisma.", color: "purple" },
                    { title: "Deployment", desc: "Docker, CI/CD pipelines, Vercel/AWS.", color: "orange" }
                ]
            },
            ai: {
                title: "AI & Machine Learning Engineer",
                steps: [
                    { title: "Mathematics Core", desc: "Linear Algebra, Calculus, Probability & Statistics.", color: "red" },
                    { title: "Python Proficiency", desc: "NumPy, Pandas, Matplotlib, Scikit-learn.", color: "blue" },
                    { title: "Machine Learning", desc: "Supervised/Unsupervised Learning, Regression, Clustering.", color: "green" },
                    { title: "Deep Learning", desc: "Neural Networks, TensorFlow, PyTorch.", color: "purple" },
                    { title: "NLP & LLMs", desc: "Transformers, HuggingFace, RAG, Prompt Engineering.", color: "orange" },
                    { title: "MLOps", desc: "Model Deployment, Monitoring, MLflow.", color: "gray" }
                ]
            },
            devops: {
                title: "DevOps & Cloud Architect",
                steps: [
                    { title: "OS & Networking", desc: "Linux command line, Bash scripting, DNS, HTTP.", color: "gray" },
                    { title: "Containerization", desc: "Docker, Container Registry, Microservices.", color: "blue" },
                    { title: "Orchestration", desc: "Kubernetes architecture, Helm charts.", color: "blue" },
                    { title: "IaC (Infrastructure as Code)", desc: "Terraform, Ansible.", color: "purple" },
                    { title: "CI/CD", desc: "Jenkins, GitHub Actions, GitLab CI.", color: "orange" },
                    { title: "Cloud Providers", desc: "AWS (EC2, S3, Lambda) or Azure.", color: "yellow" }
                ]
            }
            // You can add 'datascience', 'mobile', etc. following the same pattern
        };

        // 2. Open the Selection Modal (The Popup)
        function showRoadmapSelection() {
            hideAllScreens(); // Hide everything else
            document.getElementById('roadmap-selection-modal').classList.remove('hidden');
            document.getElementById('roadmap-selection-modal').classList.add('flex');
        }

        function closeRoadmapSelection() {
            document.getElementById('roadmap-selection-modal').classList.add('hidden');
            document.getElementById('roadmap-selection-modal').classList.remove('flex');
            showWelcomeScreen(); // Go back home if closed
        }

        // 3. Handle User Selection & Render
        function selectPath(pathKey) {
            // If data exists for the path, render it
            const data = roadmapDatabase[pathKey];

            if (!data) {
                alert("This roadmap is under construction! Coming next week.");
                return;
            }

            // Close modal
            document.getElementById('roadmap-selection-modal').classList.add('hidden');
            document.getElementById('roadmap-selection-modal').classList.remove('flex');

            // Show Roadmap Screen
            const screen = document.getElementById('roadmap-screen');
            screen.style.display = 'block';
            document.body.style.backgroundColor = '#0f172a'; // Dark background

            // Populate Title
            document.getElementById('roadmap-title').textContent = data.title;

            // Render Timeline
            const timelineContainer = document.getElementById('timeline-container');
            // Reset container with the center line
            timelineContainer.innerHTML = `<div class="border-2-2 absolute border-opacity-20 border-gray-500 h-full border" style="left: 50%"></div>`;

            data.steps.forEach((step, index) => {
                const isRight = index % 2 === 0; // Alternating sides
                const directionClass = isRight ? 'right-timeline' : 'left-timeline flex-row-reverse';
                const alignmentClass = isRight ? '' : 'text-right';
                const borderClass = isRight ? 'border-l-4' : 'border-r-4';

                // Map color names to Tailwind colors (simplified)
                const colorMap = {
                    blue: 'bg-blue-600', red: 'bg-red-600', green: 'bg-green-600',
                    purple: 'bg-purple-600', orange: 'bg-orange-600', yellow: 'bg-yellow-500',
                    cyan: 'bg-cyan-500', gray: 'bg-gray-600'
                };
                const bgClass = colorMap[step.color] || 'bg-blue-600';
                const borderColClass = bgClass.replace('bg-', 'border-');

                const html = `
                <div class="mb-12 flex justify-between items-center w-full ${directionClass}">
                    <div class="order-1 w-5/12"></div>
                    <div class="z-20 flex items-center order-1 ${bgClass} shadow-xl w-10 h-10 rounded-full">
                        <h1 class="mx-auto font-semibold text-lg text-white">${index + 1}</h1>
                    </div>
                    <div class="order-1 bg-gray-800 rounded-lg shadow-xl w-5/12 px-6 py-4 transform hover:scale-105 transition-transform ${borderClass} ${borderColClass} ${alignmentClass}">
                        <h3 class="mb-2 font-bold text-xl text-white">${step.title}</h3>
                        <p class="text-sm leading-snug tracking-wide text-gray-400 text-opacity-100">
                            ${step.desc}
                        </p>
                    </div>
                </div>
            `;
                timelineContainer.innerHTML += html;
            });

            // Add "Get Started" button at the bottom
            timelineContainer.innerHTML += `
            <div class="text-center mt-10 relative z-30">
                <button onclick="showCourseList()" class="pulse-glow bg-gradient-to-r from-blue-500 to-purple-600 text-white px-8 py-3 rounded-full font-bold shadow-lg">
                    Find Courses for this Path
                </button>
            </div>
        `;
        }
    </script>


    <script>
        // ==========================================
        // JOB BOARD SYSTEM (ADMIN & PUBLIC)
        // ==========================================

        // --- 1. ADMIN VIEW TOGGLE (The Layout Fix) ---

        function toggleAdminView(view) {
            // 1. First, forcefully hide all CLIENT-SIDE screens to prevent overlap
            const clientScreens = ['internship-task-screen', 'internship-selection-modal', 'welcome-screen', 'course-list'];
            clientScreens.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.style.display = 'none';
            });

            // 2. Hide all ADMIN-SIDE views
            const stats = document.getElementById('admin-stats-view');
            const jobs = document.getElementById('admin-jobs-view');
            const courses = document.getElementById('admin-courses-view');
            const internships = document.getElementById('admin-internships-view');

            if (stats) stats.classList.add('hidden');
            if (jobs) jobs.classList.add('hidden');
            if (courses) courses.classList.add('hidden');
            if (internships) internships.classList.add('hidden');

            // 3. Show the selected Admin View
            if (view === 'jobs') {
                jobs.classList.remove('hidden');
                fetchAdminJobs();
            } else if (view === 'courses') {
                courses.classList.remove('hidden');
                fetchAdminCourses();
            } else if (view === 'internships') {
                internships.classList.remove('hidden');
                fetchAdminInternships();
            } else {
                stats.classList.remove('hidden');
            }
        }

        // 1. SAFETY: Create a fallback for notifications if showToast is missing
        if (typeof showToast !== 'function') {
            window.showToast = function (message, type) {
                // Fallback to standard alert if Toast isn't setup
                alert((type === 'error' ? 'âŒ Error: ' : 'âœ… Success: ') + message);
            };
        }
        // ==========================================
        // JOB BOARD SYSTEM (ADMIN - EDIT ENABLED)
        // ==========================================

        function openPostJobModal() {
            const form = document.getElementById('post-job-form');
            if (form) form.reset();

            // Clear the edit ID
            document.getElementById('edit-job-id').value = "";

            // Reset UI to "Post" mode
            document.getElementById('modal-title').textContent = "Post New Opportunity";
            const btn = document.getElementById('modal-submit-btn');
            btn.textContent = "Post Job";
            btn.classList.remove('bg-orange-600', 'hover:bg-orange-700');
            btn.classList.add('bg-indigo-600', 'hover:bg-indigo-700');

            document.getElementById('admin-post-job-modal').classList.remove('hidden');
        }

        // 2. OPEN MODAL FOR *EDITING* JOB
        // 2. OPEN MODAL FOR EDITING (The missing feature)
        // 2. OPEN MODAL FOR EDITING (The Fix)
        async function openEditJobModal(jobId) {
            try {
                console.log("Fetching job details for:", jobId);

                const snapshot = await database.ref(`edupro_jobs/${jobId}`).once('value');
                const job = snapshot.val();

                if (!job) {
                    alert("Error: Job not found in database.");
                    return;
                }

                // Fill Form
                document.getElementById('edit-job-id').value = jobId;
                document.getElementById('job-role').value = job.role;
                document.getElementById('job-company').value = job.company;
                document.getElementById('job-url').value = job.url || '';
                document.getElementById('job-location').value = job.location;
                document.getElementById('job-experience').value = job.experience || '';
                document.getElementById('job-type').value = job.type;
                document.getElementById('job-salary').value = job.salary;
                document.getElementById('job-salary-val').value = job.salaryVal;
                document.getElementById('job-category').value = job.category;
                document.getElementById('job-tags').value = (job.tags || []).join(', ');
                document.getElementById('job-description').value = job.description || '';

                // UI Change to "Edit Mode"
                document.getElementById('modal-title').textContent = "Edit Job Listing";
                const btn = document.getElementById('modal-submit-btn');
                btn.textContent = "Update Job";
                btn.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
                btn.classList.add('bg-orange-600', 'hover:bg-orange-700');

                document.getElementById('admin-post-job-modal').classList.remove('hidden');

            } catch (error) {
                console.error(error);
                alert("Failed to load job details: " + error.message);
            }
        }

        function closeJobModal() {
            document.getElementById('admin-post-job-modal').classList.add('hidden');
        }

        // 3. HANDLE SUBMIT (CREATE OR UPDATE)

        async function handlePostOrUpdateJob(e) {
            e.preventDefault();

            const jobId = document.getElementById('edit-job-id').value;
            const isEditMode = !!jobId;

            // Helper to get values
            const getVal = (id) => document.getElementById(id).value;

            const jobData = {
                role: getVal('job-role'),
                company: getVal('job-company'),
                url: getVal('job-url'),
                location: getVal('job-location'),
                experience: getVal('job-experience'),
                type: getVal('job-type'),
                salary: getVal('job-salary'),
                salaryVal: parseInt(getVal('job-salary-val')) || 0,
                category: getVal('job-category'),
                tags: getVal('job-tags').split(',').map(t => t.trim()).filter(t => t !== ''),
                description: getVal('job-description'),
                updatedAt: Date.now()
            };

            try {
                if (isEditMode) {
                    // --- UPDATE ---
                    await database.ref(`edupro_jobs/${jobId}`).update(jobData);
                    showToast('Job Updated Successfully!', 'success');
                } else {
                    // --- CREATE ---
                    const colors = ['bg-blue-600', 'bg-emerald-600', 'bg-violet-600', 'bg-orange-500', 'bg-slate-800'];
                    jobData.logoBg = colors[Math.floor(Math.random() * colors.length)];
                    jobData.logoIcon = 'fa-solid fa-briefcase';
                    jobData.logoColor = 'text-white';
                    jobData.postedAt = Date.now();

                    await database.ref('edupro_jobs').push(jobData);
                    showToast('Job Posted Successfully!', 'success');
                }

                closeJobModal();
                fetchAdminJobs(); // Refresh table

            } catch (error) {
                alert("Error saving job: " + error.message);
            }
        }

        // 4. FETCH JOBS FOR TABLE (With Edit Button)
        // 4. FETCH JOBS & RENDER TABLE (Includes Edit Button)
        // 4. FETCH JOBS FOR TABLE (With Built-in SVG Icons)
        // 4. FETCH JOBS FOR TABLE (With Built-in SVG Icons)
        function fetchAdminJobs() {
            const tbody = document.getElementById('admin-jobs-table-body');
            const msg = document.getElementById('admin-no-jobs-msg');

            // Show Loading
            tbody.innerHTML = '<tr><td colspan="4" class="text-center py-4 text-gray-500">Loading listings...</td></tr>';

            database.ref('edupro_jobs').once('value').then(snapshot => {
                const data = snapshot.val();
                tbody.innerHTML = ''; // Clear loading message

                if (!data) {
                    if (msg) msg.classList.remove('hidden');
                    return;
                }
                if (msg) msg.classList.add('hidden');

                Object.keys(data).reverse().forEach(key => {
                    const job = data[key];

                    // SVG Icons (No external library needed)
                    const editIcon = `<svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>`;
                    const deleteIcon = `<svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>`;
                    const linkIcon = `<svg class="w-3 h-3 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>`;

                    const row = `
                <tr class="hover:bg-gray-50 transition-colors border-b">
                    <td class="px-6 py-4">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 h-10 w-10 ${job.logoBg || 'bg-gray-500'} rounded-lg flex items-center justify-center text-white text-lg font-bold">
                                ${job.company.charAt(0)}
                            </div>
                            <div class="ml-4">
                                <div class="text-sm font-bold text-gray-900">${job.role}</div>
                                <div class="text-xs text-gray-500">${job.company}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-xs font-semibold text-gray-700">${job.type}</div>
                        <div class="text-xs text-green-600 font-bold">${job.salary}</div>
                    </td>
                    <td class="px-6 py-4">
                        <a href="${job.url}" target="_blank" class="text-blue-600 hover:text-blue-800 text-xs font-semibold flex items-center">
                            Visit ${linkIcon}
                        </a>
                    </td>
                    
                    <td class="px-6 py-4 text-sm font-medium">
                        <div class="flex items-center gap-2">
                            
                            <button onclick="openEditJobModal('${key}')" class="flex items-center bg-orange-50 text-orange-600 hover:bg-orange-100 hover:text-orange-800 border border-orange-200 px-3 py-1.5 rounded-md transition-all text-xs font-bold shadow-sm">
                                ${editIcon} Edit
                            </button>

                            <button onclick="deleteJob('${key}')" class="flex items-center bg-red-50 text-red-600 hover:bg-red-100 hover:text-red-800 border border-red-200 px-3 py-1.5 rounded-md transition-all text-xs font-bold shadow-sm">
                                ${deleteIcon} Delete
                            </button>

                        </div>
                    </td>
                </tr>
            `;
                    tbody.innerHTML += row;
                });
            });
        }
        // 5. DELETE JOB
        async function deleteJob(jobId) {
            if (confirm('Are you sure you want to delete this job listing?')) {
                await database.ref(`edupro_jobs/${jobId}`).remove();
                fetchAdminJobs();
            }
        }
        // 3. HANDLE JOB POST (With Error Checking)
        async function handlePostJob(e) {
            e.preventDefault(); // Stop page reload

            // Helper to safely get values
            const getVal = (id) => {
                const el = document.getElementById(id);
                if (!el) {
                    console.error(`Missing input field: #${id}`);
                    return null;
                }
                return el.value;
            };

            // Check if required new fields exist in HTML
            const url = getVal('job-url');
            const exp = getVal('job-experience');

            if (url === null || exp === null) {
                showToast("Error: New HTML inputs (URL/Experience) are missing. Please update your HTML.", "error");
                return;
            }

            // Random Color Generator for Logos
            const colors = ['bg-blue-600', 'bg-emerald-600', 'bg-violet-600', 'bg-orange-500', 'bg-slate-800', 'bg-rose-600'];
            const randomColor = colors[Math.floor(Math.random() * colors.length)];

            const newJob = {
                role: getVal('job-role'),
                company: getVal('job-company'),
                url: url,               // New Field
                experience: exp,        // New Field
                location: getVal('job-location'),
                type: getVal('job-type'),
                salary: getVal('job-salary'),
                salaryVal: parseInt(getVal('job-salary-val')) || 0,
                category: getVal('job-category'),
                tags: (getVal('job-tags') || '').split(',').map(t => t.trim()).filter(t => t !== ''),
                logoBg: randomColor,
                logoIcon: 'fa-solid fa-briefcase',
                logoColor: 'text-white',
                postedAt: Date.now()
            };

            try {
                // Verify Firebase Database connection
                if (typeof database === 'undefined') {
                    throw new Error("Firebase database not initialized.");
                }

                // Push to Firebase
                await database.ref('edupro_jobs').push(newJob);

                // Success Actions
                showToast('Job Posted Successfully!', 'success');
                document.getElementById('admin-post-job-modal').classList.add('hidden');

                // Refresh the table
                if (typeof fetchAdminJobs === 'function') {
                    fetchAdminJobs();
                }

            } catch (error) {
                console.error("Post Job Error:", error);
                showToast(error.message, 'error');
            }
        }
        // --- 3. ADMIN: LIST JOBS ---
        function fetchAdminJobs() {
            const tbody = document.getElementById('admin-jobs-table-body');
            const msg = document.getElementById('admin-no-jobs-msg');

            tbody.innerHTML = '<tr><td colspan="4" class="text-center py-4">Loading...</td></tr>';

            database.ref('edupro_jobs').once('value').then(snapshot => {
                const data = snapshot.val();
                tbody.innerHTML = '';

                if (!data) {
                    msg.classList.remove('hidden');
                    return;
                }
                msg.classList.add('hidden');

                Object.keys(data).reverse().forEach(key => {
                    const job = data[key];
                    const row = `
                <tr class="hover:bg-gray-50 transition-colors border-b">
                    <td class="px-6 py-4">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 h-10 w-10 ${job.logoBg} rounded-lg flex items-center justify-center text-white text-lg font-bold">
                                ${job.company.charAt(0)}
                            </div>
                            <div class="ml-4">
                                <div class="text-sm font-bold text-gray-900">${job.role}</div>
                                <div class="text-sm text-gray-500">${job.company}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-xs text-gray-500 mb-1">Exp: <span class="font-semibold text-gray-700">${job.experience}</span></div>
                        <div class="text-xs text-gray-500">Sal: <span class="font-semibold text-green-600">${job.salary}</span></div>
                    </td>
                    <td class="px-6 py-4">
                        <a href="${job.url}" target="_blank" class="text-blue-600 hover:underline text-xs flex items-center">
                            Visit Link <i class="fa-solid fa-arrow-up-right-from-square ml-1"></i>
                        </a>
                    </td>
                    <td class="px-6 py-4 text-sm font-medium">
                        <button onclick="deleteJob('${key}')" class="text-red-500 hover:text-red-700 bg-red-50 px-3 py-1 rounded hover:bg-red-100 transition-colors">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `;
                    tbody.innerHTML += row;
                });
            });
        }

        async function deleteJob(jobId) {
            if (confirm('Delete this job post?')) {
                await database.ref(`edupro_jobs/${jobId}`).remove();
                fetchAdminJobs();
            }
        }

        // --- 4. PUBLIC: SHOW JOBS (Updated to use new fields) ---
        let liveJobsCache = [];

        async function showJobs() {
            hideAllScreens();
            const screen = document.getElementById('jobs-screen');
            if (screen) {
                screen.style.display = 'block';
                document.body.style.backgroundColor = '#F8F9FC';

                const container = document.getElementById('jobs-grid-display');
                container.innerHTML = '<div class="col-span-full text-center py-10"><div class="lds-ring"><div></div><div></div><div></div><div></div></div></div>';

                try {
                    const snapshot = await database.ref('edupro_jobs').once('value');
                    const data = snapshot.val();
                    liveJobsCache = data ? Object.values(data).reverse() : [];
                    renderJobCards(liveJobsCache);
                } catch (error) {
                    console.error(error);
                }
            }
        }

        function renderJobCards(data) {
            const container = document.getElementById('jobs-grid-display');
            const noMsg = document.getElementById('no-jobs-message');
            if (!container) return;

            container.innerHTML = '';

            if (data.length === 0) {
                if (noMsg) noMsg.classList.remove('hidden');
                return;
            }
            if (noMsg) noMsg.classList.add('hidden');

            data.forEach(job => {
                const tagsHtml = (job.tags || []).map(t => `<span class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-md border border-gray-200">${t}</span>`).join('');

                const html = `
            <div class="bg-white rounded-2xl p-6 border border-gray-200 hover:shadow-xl transition-all duration-300 flex flex-col justify-between h-full hover:-translate-y-1 group hover:border-indigo-200 relative overflow-hidden">
                
                <div class="absolute top-0 right-0 p-4">
                     <span class="${job.type === 'Remote' ? 'bg-indigo-50 text-indigo-600 border-indigo-100' : 'bg-gray-100 text-gray-600'} border px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide">
                        ${job.type}
                    </span>
                </div>

                <div>
                    <div class="flex items-center gap-4 mb-4">
                        <div class="w-14 h-14 ${job.logoBg} rounded-xl flex items-center justify-center shadow-md text-white text-2xl font-bold">
                            ${job.company.charAt(0)}
                        </div>
                        <div>
                            <h3 class="text-lg font-bold text-gray-900 leading-tight group-hover:text-indigo-600 transition-colors">${job.role}</h3>
                            <p class="text-gray-500 text-sm font-medium">${job.company}</p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-y-3 gap-x-2 mb-5 text-sm text-gray-600">
                        <div class="flex items-center gap-2">
                            <i class="fa-solid fa-briefcase text-gray-400"></i> ${job.experience || 'Not specified'}
                        </div>
                        <div class="flex items-center gap-2">
                            <i class="fa-solid fa-location-dot text-gray-400"></i> ${job.location}
                        </div>
                        <div class="col-span-2 flex items-center gap-2 text-green-700 font-semibold bg-green-50 p-2 rounded-lg border border-green-100 w-fit">
                            <i class="fa-solid fa-money-bill-wave"></i> ${job.salary}
                        </div>
                    </div>

                    <div class="flex flex-wrap gap-2 mb-6">${tagsHtml}</div>
                </div>

                <a href="${job.url}" target="_blank" class="block w-full text-center bg-slate-800 text-white py-3 rounded-xl font-bold hover:bg-indigo-600 hover:shadow-lg hover:-translate-y-0.5 transition-all duration-200">
                    Apply Now <i class="fa-solid fa-arrow-up-right-from-square ml-2 text-xs"></i>
                </a>
            </div>
        `;
                container.innerHTML += html;
            });
        }
    </script>


    <!-- Daily challenge -->
    <script>
        // ==========================================
        // ðŸ”¥ GAMIFICATION ENGINE (DAILY STREAK)
        // ==========================================

        // 1. QUESTION BANK
        const dailyQuestions = [
            {
                topic: "JavaScript",
                q: "What is the output of this code?",
                code: "console.log(2 + '2' - 1);",
                options: ["21", "3", "NaN", "22"],
                answer: 0 // Index of correct answer "21"
            },
            {
                topic: "CSS",
                q: "Which property is used to change text color?",
                code: "p { ??? : red; }",
                options: ["text-color", "color", "font-color", "text-style"],
                answer: 1
            },
            {
                topic: "Python",
                q: "How do you start a function in Python?",
                code: "??? my_function():",
                options: ["function", "func", "def", "init"],
                answer: 2
            },
            {
                topic: "React",
                q: "Which hook is used for side effects?",
                code: "useEffect(() => { ... }, [])",
                options: ["useState", "useMemo", "useEffect", "useCallback"],
                answer: 2
            },
            {
                topic: "DevOps",
                q: "Which command builds a Docker image?",
                code: "$ docker ??? -t my-app .",
                options: ["create", "build", "run", "compose"],
                answer: 1
            }
        ];

        let currentChallenge = null;
        let selectedOptionIndex = null;

        // 2. INITIALIZE STREAK (Call this on Login/Page Load)
        async function initGamification() {
            if (!currentUser) return;

            // Fetch Gamification Data
            const snapshot = await database.ref(`edupro_users/${currentUser.uid}/gamification`).once('value');
            const gameData = snapshot.val() || { streak: 0, last_solved_date: "" };

            // Update UI
            document.getElementById('nav-streak-count').textContent = gameData.streak;

            // Check if played today
            const todayStr = new Date().toDateString(); // e.g., "Mon Dec 25 2023"

            if (gameData.last_solved_date !== todayStr) {
                // Has NOT played today -> Show Challenge
                // Slight delay for UX so it doesn't pop up instantly over login
                setTimeout(() => {
                    launchDailyChallenge();
                }, 2000);
            }
        }

        // 3. LAUNCH CHALLENGE
        function launchDailyChallenge() {
            // Pick random question
            currentChallenge = dailyQuestions[Math.floor(Math.random() * dailyQuestions.length)];

            // Render UI
            document.getElementById('challenge-topic').textContent = currentChallenge.topic;
            document.getElementById('challenge-question').textContent = currentChallenge.q;

            // Handle Code Block visibility
            const codeBlock = document.getElementById('challenge-code');
            if (currentChallenge.code) {
                codeBlock.textContent = currentChallenge.code;
                codeBlock.classList.remove('hidden');
            } else {
                codeBlock.classList.add('hidden');
            }

            // Render Options
            const optsContainer = document.getElementById('challenge-options');
            optsContainer.innerHTML = '';
            selectedOptionIndex = null;

            currentChallenge.options.forEach((opt, index) => {
                const btn = document.createElement('div');
                btn.className = `p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors font-medium text-gray-700`;
                btn.textContent = opt;
                btn.onclick = () => selectOption(index, btn);
                optsContainer.appendChild(btn);
            });

            // Reset Feedback
            document.getElementById('challenge-feedback').classList.add('hidden');
            document.getElementById('challenge-submit-btn').textContent = "Check Answer ðŸš€";
            document.getElementById('challenge-submit-btn').disabled = false;

            // Show Modal
            document.getElementById('daily-challenge-modal').classList.remove('hidden');
        }

        function selectOption(index, element) {
            selectedOptionIndex = index;
            // Visually select
            const all = document.getElementById('challenge-options').children;
            for (let i = 0; i < all.length; i++) {
                all[i].classList.remove('border-indigo-500', 'bg-indigo-50', 'text-indigo-700');
                all[i].classList.add('border-gray-200');
            }
            element.classList.remove('border-gray-200');
            element.classList.add('border-indigo-500', 'bg-indigo-50', 'text-indigo-700');
        }

        // 4. SUBMIT LOGIC
        async function submitDailyChallenge() {
            if (selectedOptionIndex === null) {
                showToast("Please select an option!", "error");
                return;
            }

            const feedback = document.getElementById('challenge-feedback');
            const btn = document.getElementById('challenge-submit-btn');

            if (selectedOptionIndex === currentChallenge.answer) {
                // --- CORRECT ANSWER ---
                feedback.textContent = "ðŸŽ‰ Correct! Streak Updated!";
                feedback.className = "mt-4 text-center font-bold text-green-600 text-lg animate-bounce";
                feedback.classList.remove('hidden');
                btn.textContent = "Success!";
                btn.disabled = true;

                // Confetti Effect (CSS simple version)
                document.getElementById('daily-challenge-modal').style.background = "rgba(0,0,0,0.9)";

                await updateStreakInFirebase();

                setTimeout(() => {
                    document.getElementById('daily-challenge-modal').classList.add('hidden');
                    showToast("ðŸ”¥ Streak Increased!", "success");
                }, 2000);

            } else {
                // --- WRONG ANSWER ---
                feedback.textContent = "âŒ Incorrect. Try again!";
                feedback.className = "mt-4 text-center font-bold text-red-500";
                feedback.classList.remove('hidden');

                // Shake animation
                const modalBody = document.querySelector('#daily-challenge-modal > div');
                modalBody.classList.add('animate-pulse');
                setTimeout(() => modalBody.classList.remove('animate-pulse'), 500);
            }
        }

        // 5. FIREBASE UPDATE LOGIC
        async function updateStreakInFirebase() {
            const todayStr = new Date().toDateString();

            // Get yesterday's date string for consecutive check
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayStr = yesterday.toDateString();

            const ref = database.ref(`edupro_users/${currentUser.uid}/gamification`);
            const snapshot = await ref.once('value');
            let data = snapshot.val() || { streak: 0, last_solved_date: "" };

            if (data.last_solved_date === yesterdayStr) {
                // Consecutive day
                data.streak += 1;
            } else {
                // Streak broken or new user
                data.streak = 1;
            }

            data.last_solved_date = todayStr;

            // Save
            await ref.set(data);

            // Update UI immediately
            document.getElementById('nav-streak-count').textContent = data.streak;
        }
    </script>


    <script>
        // ==========================================
        // ðŸ¤– AI RESUME SCANNER LOGIC
        // ==========================================

        function showResumeScanner() {
            hideAllScreens();
            document.getElementById('resume-scanner-screen').style.display = 'block';
        }

        function updateHideScreens() {
            // Add 'resume-scanner-screen' to your existing hideAllScreens array manually
            // (I've included the updated function below for convenience)
        }


        // âš ï¸ IMPORTANT: Update your global hideAllScreens function again to include 'resume-scanner-screen'
        function hideAllScreens() {
            const screens = [
                'welcome-screen', 'login-form', 'register-form', 'dashboard-screen',
                'course-list', 'course-detail', 'profile-screen', 'certificate-screen',
                'certificates-screen', 'admin-dashboard-panel', 'admin-login-screen',
                'admin-user-details-modal', 'my-account-screen', 'notification-modal',
                'course-wrapper', 'jobs-screen', 'roadmap-screen',
                'resume-scanner-screen' // <--- ADDED HERE
            ];

            screens.forEach(id => {
                const element = document.getElementById(id);
                if (element) element.style.display = 'none';
            });

            document.body.style.backgroundColor = 'white';
        }

        // ==========================================
        // ðŸ¤– AI RESUME SCANNER (EXPANDED UNIVERSAL VERSION)
        // ==========================================

        // 1. The "Master List" (Expanded for IT, Non-IT, Business, Content, etc.)
        const techSkillsLibrary = [
            // --- PROGRAMMING & DEV ---
            "python", "java", "javascript", "typescript", "c++", "c#", "php", "ruby", "go", "swift", "kotlin", "rust", "sql", "html", "css", "bash", "shell", "r", "matlab", "scala", "perl", "dart",

            // --- FRAMEWORKS & LIBRARIES ---
            "react", "react.js", "angular", "vue", "vue.js", "next.js", "node.js", "node", "tailwind", "bootstrap", "sass", "redux", "jquery", "webpack", "vite", "figma", "flask", "django", "spring", "spring boot", "laravel", "express", "fastapi", ".net", "asp.net", "tensorflow", "pytorch", "pandas", "numpy", "keras", "opencv",

            // --- CLOUD & DEVOPS ---
            "aws", "azure", "gcp", "google cloud", "docker", "kubernetes", "k8s", "jenkins", "gitlab", "github actions", "terraform", "ansible", "circleci", "linux", "unix", "nginx", "apache", "ci/cd", "devops", "serverless", "lambda", "ec2", "s3",

            // --- DATABASES ---
            "mysql", "postgresql", "postgres", "mongodb", "firebase", "redis", "oracle", "sqlite", "dynamodb", "cassandra", "mariadb", "sql server", "nosql",

            // --- DATA & ANALYTICS ---
            "excel", "advanced excel", "power bi", "tableau", "looker", "google analytics", "sql", "statistics", "analysis", "forecasting", "modeling", "etl", "big data", "hadoop", "spark", "mining", "visualization", "metrics",

            // --- CONTENT & MARKETING (Added for your case) ---
            "seo", "sem", "content writing", "copywriting", "social media", "marketing", "branding", "editing", "blogging", "wordpress", "cms", "optimization", "growth", "campaign", "ads", "google ads", "email marketing", "storytelling", "multimedia", "journalism", "pr", "communications",

            // --- BUSINESS & MANAGEMENT (Added for your case) ---
            "project management", "product management", "agile", "scrum", "kanban", "waterfall", "sdlc", "jira", "confluence", "trello", "asana", "leadership", "strategy", "planning", "budgeting", "risk management", "compliance", "operations", "stakeholder", "negotiation", "sales", "crm", "salesforce", "business development", "accounting", "finance", "audit",

            // --- GENERAL IT & SUPPORT ---
            "troubleshooting", "maintenance", "networking", "tcp/ip", "dns", "security", "firewall", "vpn", "active directory", "hardware", "software", "installation", "configuration", "help desk", "it support", "saas", "erp", "sap",

            // --- TESTING & QA ---
            "selenium", "jest", "cypress", "junit", "testing", "qa", "quality assurance", "manual testing", "automation", "debugging", "bug tracking",

            // --- SOFT SKILLS & GENERIC QUALIFICATIONS (Common in JDs) ---
            "communication", "teamwork", "problem solving", "critical thinking", "time management", "adaptability", "creativity", "collaboration", "analytical", "research", "presentation", "mentoring", "bachelors", "masters", "degree", "b.tech", "m.tech", "mba", "phd", "certification"
        ];

        function showResumeScanner() {
            hideAllScreens();
            const screen = document.getElementById('resume-scanner-screen');
            if (screen) {
                screen.style.display = 'block';
                document.body.style.backgroundColor = '#F8FAFC';
            } else {
                alert("Error: Resume Scanner Screen not found in HTML.");
            }
        }

        // Helper to find exact words only (Robust Logic)
        function extractSkillsFromText(text) {
            // 1. Convert to lowercase
            let cleanText = text.toLowerCase();

            // 2. Replace special chars with spaces (but keep vital tech chars like +, #, .)
            // We allow letters, numbers, plus, hash, dot (for node.js), and forward slash (for ci/cd)
            cleanText = cleanText.replace(/[^a-z0-9+#.\/]/g, " ");

            // 3. Add padding spaces to ensure we match start/end of words
            cleanText = " " + cleanText + " ";

            const foundSkills = [];

            techSkillsLibrary.forEach(skill => {
                // We look for " skill " (surrounded by spaces) to ensure exact match
                // e.g. " go " will match, but " google " will not.
                const searchPattern = " " + skill + " ";

                if (cleanText.includes(searchPattern)) {
                    if (!foundSkills.includes(skill)) {
                        foundSkills.push(skill);
                    }
                }
            });

            return foundSkills;
        }

        function analyzeResume() {
            const jobInput = document.getElementById('scan-job-desc');
            const resumeInput = document.getElementById('scan-resume-text');

            if (!jobInput || !resumeInput) {
                console.error("Inputs not found");
                return;
            }

            const jobText = jobInput.value;
            const resumeText = resumeInput.value;

            if (jobText.length < 10 || resumeText.length < 10) {
                alert("Please enter more text in both fields to analyze.");
                return;
            }

            // --- STEP 1: Find Required Skills from JD ---
            const requiredSkills = extractSkillsFromText(jobText);

            if (requiredSkills.length === 0) {
                // Fallback: If dictionary check fails, try a simple extraction for non-standard JDs
                // This prevents the "No skills found" error for weird job descriptions
                alert("âš ï¸ No standard keywords found. Try to ensure the Job Description contains clear skills like 'Management', 'Java', 'Marketing', etc.");
                return;
            }

            // --- STEP 2: Find User Skills from Resume ---
            const userSkills = extractSkillsFromText(resumeText);

            // --- STEP 3: Compare ---
            const matched = [];
            const missing = [];

            requiredSkills.forEach(skill => {
                if (userSkills.includes(skill)) {
                    matched.push(skill);
                } else {
                    missing.push(skill);
                }
            });

            // --- STEP 4: Calculate Score ---
            let score = 0;
            if (requiredSkills.length > 0) {
                score = Math.round((matched.length / requiredSkills.length) * 100);
            }

            // --- STEP 5: Render UI ---
            document.getElementById('scan-placeholder').classList.add('hidden');
            document.getElementById('scan-results').classList.remove('hidden');

            // Score Text
            const scoreEl = document.getElementById('scan-score');
            scoreEl.textContent = score + "%";

            // Color Logic
            if (score < 50) scoreEl.className = "text-5xl font-extrabold text-red-600 mt-2";
            else if (score < 80) scoreEl.className = "text-5xl font-extrabold text-yellow-500 mt-2";
            else scoreEl.className = "text-5xl font-extrabold text-green-600 mt-2";

            // Icon & Suggestion
            const iconEl = document.getElementById('scan-score-icon');
            const suggestEl = document.getElementById('scan-suggestion');

            if (score > 80) {
                iconEl.textContent = "ðŸš€";
                suggestEl.textContent = "Excellent match! Your resume is well optimized.";
            } else if (score > 50) {
                iconEl.textContent = "ðŸ‘";
                suggestEl.textContent = "Good start. Add the missing keywords (in red) to improve your chances.";
            } else {
                iconEl.textContent = "âš ï¸";
                suggestEl.textContent = "Low match. You are missing several key requirements.";
            }

            // Render Lists
            const matchedContainer = document.getElementById('scan-matched');
            matchedContainer.innerHTML = matched.length
                ? matched.map(w => `<span class="bg-green-100 text-green-700 border border-green-200 px-3 py-1 rounded-full text-sm font-bold capitalize shadow-sm inline-flex items-center"><i class="fa-solid fa-check mr-1"></i> ${w}</span>`).join('')
                : '<span class="text-gray-400 text-sm italic">No skills matched yet.</span>';

            const missingContainer = document.getElementById('scan-missing');
            missingContainer.innerHTML = missing.length
                ? missing.map(w => `<span class="bg-red-50 text-red-600 border border-red-200 px-3 py-1 rounded-full text-sm font-medium capitalize shadow-sm inline-flex items-center"><i class="fa-solid fa-xmark mr-1"></i> ${w}</span>`).join('')
                : '<span class="text-green-600 text-sm font-bold">No missing keywords! You have everything.</span>';
        }
    </script>


    <script>
        // --- SCANNER INFO MODAL LOGIC ---
        function openScannerInfo() {
            document.getElementById('scanner-info-modal').classList.remove('hidden');
        }

        function closeScannerInfo() {
            document.getElementById('scanner-info-modal').classList.add('hidden');
        }
    </script>

    <script>
        // ==========================================
        // ðŸŽ“ ADMIN COURSE MANAGEMENT
        // ==========================================

        // 1. ADMIN VIEW TOGGLE (Update existing function to include 'courses')


        // ==========================================
        // 3. ADMIN VIEW TOGGLE (FIXED FOR INTERNSHIPS)
        // ==========================================
        function toggleAdminView(view) {
            // 1. First, forcefully hide all CLIENT-SIDE screens to prevent overlap
            const clientScreens = ['internship-task-screen', 'internship-selection-modal', 'welcome-screen', 'course-list'];
            clientScreens.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.style.display = 'none';
            });

            // 2. Hide all ADMIN-SIDE views
            const stats = document.getElementById('admin-stats-view');
            const jobs = document.getElementById('admin-jobs-view');
            const courses = document.getElementById('admin-courses-view');
            const internships = document.getElementById('admin-internships-view');

            if (stats) stats.classList.add('hidden');
            if (jobs) jobs.classList.add('hidden');
            if (courses) courses.classList.add('hidden');
            if (internships) internships.classList.add('hidden');

            // 3. Show the selected Admin View
            if (view === 'jobs') {
                jobs.classList.remove('hidden');
                fetchAdminJobs();
            } else if (view === 'courses') {
                courses.classList.remove('hidden');
                fetchAdminCourses();
            } else if (view === 'internships') {
                internships.classList.remove('hidden');
                fetchAdminInternships();
            } else {
                stats.classList.remove('hidden');
            }
        }


        // 2. CURRICULUM BUILDER LOGIC
        function addCurriculumField(day = "", title = "") {
            const container = document.getElementById('curriculum-container');
            const count = container.children.length + 1;

            const div = document.createElement('div');
            div.className = "flex gap-2 items-center curriculum-row";
            div.innerHTML = `
        <span class="bg-gray-200 text-gray-600 px-2 py-1 rounded text-xs font-bold w-16 text-center">Day ${count}</span>
        <input type="text" class="module-title w-full px-3 py-1 border rounded text-sm outline-none focus:border-indigo-500" placeholder="Module Title (e.g. Intro to React)" value="${title}">
        <button type="button" onclick="this.parentElement.remove()" class="text-red-400 hover:text-red-600 px-2">
            <i class="fa-solid fa-xmark"></i>
        </button>
    `;
            container.appendChild(div);
        }

        // 3. OPEN MODAL (CREATE)
        function openPostCourseModal() {

            document.getElementById('post-course-form').reset();
            document.getElementById('is-edit-course').value = "false";
            document.getElementById('course-id').disabled = false; // Allow ID edit on new
            document.getElementById('curriculum-container').innerHTML = ''; // Clear modules

            // Add default 10 days
            for (let i = 0; i < 10; i++) addCurriculumField();

            document.getElementById('course-modal-title').textContent = "Add New Course";
            document.getElementById('course-submit-btn').textContent = "Publish Course";
            document.getElementById('admin-post-course-modal').classList.remove('hidden');
        }

        // 4. OPEN MODAL (EDIT)
        async function openEditCourseModal(courseId) {
            try {
                const snapshot = await database.ref(`edupro_courses/${courseId}`).once('value');
                const course = snapshot.val();
                if (!course) return alert("Course not found");

                // Fill Form
                document.getElementById('is-edit-course').value = "true";
                document.getElementById('course-id').value = course.id;
                document.getElementById('course-id').disabled = true; // Lock ID
                document.getElementById('course-title').value = course.title;
                document.getElementById('course-image').value = course.thumbnail || "";
                document.getElementById('course-level').value = course.level;
                document.getElementById('course-price').value = course.price;
                document.getElementById('course-orig-price').value = course.originalPrice;
                document.getElementById('course-category').value = course.category;
                document.getElementById('course-desc').value = course.description;

                // Fill Curriculum
                const container = document.getElementById('curriculum-container');
                container.innerHTML = '';
                if (course.curriculum) {
                    course.curriculum.forEach(item => {
                        addCurriculumField(item.day, item.title);
                    });
                }

                // Update UI
                document.getElementById('course-modal-title').textContent = "Edit Course";
                document.getElementById('course-submit-btn').textContent = "Update Course";
                document.getElementById('admin-post-course-modal').classList.remove('hidden');

            } catch (e) {
                console.error(e);
                showToast("Error loading course", "error");
            }
        }

        function closeCourseModal() {
            document.getElementById('admin-post-course-modal').classList.add('hidden');
        }

        // 5. HANDLE SUBMIT
        async function handlePostOrUpdateCourse(e) {
            e.preventDefault();

            const isEdit = document.getElementById('is-edit-course').value === "true";
            const courseId = document.getElementById('course-id').value.trim().toLowerCase().replace(/\s+/g, '_'); // Slugify ID

            if (!courseId) return alert("Course ID is required");

            // Gather Curriculum
            const curriculum = [];
            document.querySelectorAll('.curriculum-row').forEach((row, index) => {
                const title = row.querySelector('.module-title').value;
                if (title) {
                    curriculum.push({ day: index + 1, title: title });
                }
            });

            const courseData = {
                id: courseId,
                title: document.getElementById('course-title').value,
                thumbnail: document.getElementById('course-image').value,
                level: document.getElementById('course-level').value,
                price: document.getElementById('course-price').value,
                originalPrice: document.getElementById('course-orig-price').value,
                category: document.getElementById('course-category').value,
                description: document.getElementById('course-desc').value,
                rating: 4.8, // Default starting rating
                reviewCount: "New",
                instructor: "EduPro Team", // Default
                curriculum: curriculum
            };

            try {
                // Save to Firebase (Use ID as key for easy lookup)
                await database.ref(`edupro_courses/${courseId}`).set(courseData);

                showToast(isEdit ? "Course Updated!" : "Course Published!", "success");
                closeCourseModal();
                fetchAdminCourses();
                // Also refresh public data so the new course shows up immediately
                fetchUserData(true);

            } catch (error) {
                console.error(error);
                showToast(error.message, "error");
            }
        }

        // 6. FETCH & RENDER ADMIN TABLE
        function fetchAdminCourses() {
            const tbody = document.getElementById('admin-courses-table-body');
            tbody.innerHTML = '<tr><td colspan="4" class="text-center py-4">Loading...</td></tr>';

            database.ref('edupro_courses').once('value').then(snapshot => {
                const data = snapshot.val();
                tbody.innerHTML = '';

                if (!data) return (tbody.innerHTML = '<tr><td colspan="4" class="text-center py-4">No courses found.</td></tr>');

                Object.values(data).forEach(c => {
                    const row = `
                <tr class="hover:bg-gray-50 border-b">
                    <td class="px-6 py-4 flex items-center gap-3">
                        <img src="${c.thumbnail}" class="w-10 h-10 rounded object-cover bg-gray-200">
                        <div>
                            <div class="font-bold text-gray-900">${c.title}</div>
                            <div class="text-xs text-gray-500 font-mono">${c.id}</div>
                        </div>
                    </td>
                    <td class="px-6 py-4 text-sm font-bold text-green-600">${c.price}</td>
                    <td class="px-6 py-4 text-sm"><span class="bg-gray-100 px-2 py-1 rounded text-xs uppercase">${c.category}</span></td>
                    <td class="px-6 py-4 flex gap-2">
                        <button onclick="openEditCourseModal('${c.id}')" class="text-orange-600 hover:bg-orange-50 p-2 rounded">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
                        </button>
                        <button onclick="deleteCourse('${c.id}')" class="text-red-600 hover:bg-red-50 p-2 rounded">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                        </button>
                    </td>
                </tr>
            `;
                    tbody.innerHTML += row;
                });
            });
        }

        // 7. DELETE COURSE
        async function deleteCourse(id) {
            if (confirm("Delete this course permanently? Users enrolled might lose access.")) {
                await database.ref(`edupro_courses/${id}`).remove();
                showToast("Course deleted", "info");
                fetchAdminCourses();
            }
        }
    </script>


    <script>

        // ==========================================
        // ðŸ—£ï¸ COMMUNITY FORUM (WITH UPVOTES & IMAGE UPLOAD)
        // ==========================================

        let forumQuestions = [];
        let currentForumTab = 'all';
        let activeQuestionId = null;

        // 1. SHOW FORUM (Works for Admin too)
        async function showForum() {
            // 1. Force Hide Dashboard
            const dashboard = document.getElementById('dashboard-screen');
            if (dashboard) dashboard.style.display = 'none';

            // 2. Hide Everything Else
            hideAllScreens();

            // 3. Show Forum
            const screen = document.getElementById('forum-screen');
            if (screen) {
                screen.style.display = 'block';
                document.body.style.backgroundColor = '#F8FAFC';

                // Reset Views
                document.getElementById('forum-feed-view').classList.remove('hidden');
                document.getElementById('forum-feed-view').classList.remove('hidden');
                document.getElementById('internship-task-screen').style.display = 'none';
                document.getElementById('admin-courses-view').style.display = 'none';

                fetchQuestions();
            } else {
                console.error("Forum Screen ID not found!");
            }
        }


        // ==========================================
        // ðŸ—£ï¸ FORUM NAVIGATION FIX
        // ==========================================
        function handleForumBack() {
            // 1. If inside a specific question, go back to feed
            const detailView = document.getElementById('forum-detail-view');
            if (detailView && !detailView.classList.contains('hidden')) {
                detailView.classList.add('hidden');
                document.getElementById('forum-feed-view').classList.remove('hidden');
                window.scrollTo(0, 0);
                return;
            }

            // 2. If at main feed, EXIT forum completely
            hideAllScreens(); // <--- CRITICAL: Hides the forum

            if (isAdminLoggedIn) {
                showAdminDashboard();
            } else if (currentUser) {
                showDashboard();
            } else {
                showWelcomeScreen();
            }
        }

        // 2. FETCH QUESTIONS
        function fetchQuestions() {
            const container = document.getElementById('questions-list-container');
            container.innerHTML = '<div class="text-center py-10"><div class="lds-ring"><div></div><div></div><div></div><div></div></div></div>';

            database.ref('edupro_forum_questions').once('value').then(snapshot => {
                const data = snapshot.val();
                forumQuestions = data ? Object.entries(data).map(([key, val]) => ({ id: key, ...val })).reverse() : [];
                renderForumList();
            });
        }

        // 3. RENDER LIST
        function switchForumTab(tab) {
            currentForumTab = tab;
            // (Button styling logic same as before, omitted for brevity but included in UI)
            // Update Button Styles
            const allBtn = document.getElementById('tab-all-btn');
            const myBtn = document.getElementById('tab-my-btn');

            if (tab === 'all') {
                allBtn.classList.replace('bg-white', 'bg-indigo-600');
                allBtn.classList.replace('text-gray-600', 'text-white');
                myBtn.classList.replace('bg-indigo-600', 'bg-white');
                myBtn.classList.replace('text-white', 'text-gray-600');
            } else {
                myBtn.classList.replace('bg-white', 'bg-indigo-600');
                myBtn.classList.replace('text-gray-600', 'text-white');
                allBtn.classList.replace('bg-indigo-600', 'bg-white');
                allBtn.classList.replace('text-white', 'text-gray-600');
            }
            renderForumList();
        }

        function renderForumList() {
            const container = document.getElementById('questions-list-container');
            const search = document.getElementById('forum-search').value.toLowerCase();

            container.innerHTML = '';

            const filtered = forumQuestions.filter(q => {
                const matchesSearch = q.title.toLowerCase().includes(search) || (q.tags && q.tags.includes(search));
                const matchesTab = currentForumTab === 'all' ? true : (q.uid === (currentUser ? currentUser.uid : ''));
                return matchesSearch && matchesTab;
            });

            if (filtered.length === 0) {
                container.innerHTML = `<div class="text-center py-12 text-gray-400 bg-white rounded-xl border border-dashed border-gray-300">No questions found.</div>`;
                return;
            }

            filtered.forEach(q => {
                const timeAgo = typeof timeSince === 'function' ? timeSince(q.timestamp) : 'Recent';
                const tagsHtml = (q.tags || '').split(',').map(t => `<span class="bg-blue-50 text-blue-600 text-xs px-2 py-1 rounded font-mono border border-blue-100">#${t.trim()}</span>`).join('');

                // ADMIN ONLY: Delete Button
                const adminControls = isAdminLoggedIn ?
                    `<button onclick="deleteQuestion('${q.id}', event)" class="text-red-500 hover:text-red-700 text-xs font-bold border border-red-200 bg-red-50 px-2 py-1 rounded ml-auto z-10 relative">
                <i class="fa-solid fa-trash"></i> Delete Thread
            </button>` : '';

                const html = `
            <div onclick="viewQuestionDetail('${q.id}')" class="bg-white p-6 rounded-xl border border-gray-200 hover:shadow-lg hover:border-indigo-300 transition-all cursor-pointer group relative">
                <div class="flex justify-between items-start mb-2">
                    <h3 class="text-lg font-bold text-gray-800 group-hover:text-indigo-600 transition-colors pr-8">${q.title}</h3>
                    <span class="text-xs text-gray-400 whitespace-nowrap flex-shrink-0 ml-2">${timeAgo}</span>
                </div>
                <p class="text-gray-500 text-sm mb-4 line-clamp-2">${q.previewText || 'Click to view details...'}</p>
                
                <div class="flex justify-between items-center border-t border-gray-50 pt-3 flex-wrap gap-2">
                    <div class="flex gap-2 flex-wrap">${tagsHtml}</div>
                    
                    <div class="flex items-center gap-4 w-full sm:w-auto justify-between sm:justify-end mt-2 sm:mt-0">
                        <div class="flex items-center gap-2 text-xs text-gray-500 font-medium">
                            <div class="w-6 h-6 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center font-bold">
                                ${q.authorName.charAt(0)}
                            </div>
                            ${q.authorName}
                        </div>
                        ${adminControls}
                    </div>
                </div>
            </div>
        `;
                container.innerHTML += html;
            });
        }
        // 4. VIEW DETAIL & ANSWERS (With Upvoting)
        async function viewQuestionDetail(qId) {
            activeQuestionId = qId;
            const question = forumQuestions.find(q => q.id === qId);
            if (!question) return;

            document.getElementById('forum-feed-view').classList.add('hidden');
            document.getElementById('forum-detail-view').classList.remove('hidden');
            window.scrollTo(0, 0);

            const qContainer = document.getElementById('detail-question-card');
            const tagsHtml = (question.tags || '').split(',').map(t => `<span class="bg-gray-100 text-gray-600 text-xs px-2 py-1 rounded">#${t.trim()}</span>`).join('');

            // Delete button for Admin
            const deleteBtn = isAdminLoggedIn ? `<button onclick="deleteQuestion('${qId}')" class="text-red-500 text-sm hover:underline"><i class="fa-solid fa-trash"></i> Delete</button>` : '';

            qContainer.innerHTML = `
        <div class="flex justify-between items-start mb-4">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-indigo-600 text-white rounded-full flex items-center justify-center font-bold text-lg shadow-md">
                    ${question.authorName.charAt(0)}
                </div>
                <div>
                    <div class="font-bold text-gray-900">${question.authorName}</div>
                    <div class="text-xs text-gray-500">Asked recently</div>
                </div>
            </div>
            ${deleteBtn}
        </div>
        <h1 class="text-2xl font-extrabold text-gray-900 mb-4">${question.title}</h1>
        <div class="prose max-w-none text-gray-700 mb-6 bg-gray-50 p-4 rounded-lg border border-gray-100 overflow-x-auto">
            ${question.body}
        </div>
        <div class="flex gap-2">${tagsHtml}</div>
    `;

            // Fetch Answers
            fetchAnswers(qId);
        }

        // 3. RENDER ANSWERS (With Admin Delete)
        function fetchAnswers(qId) {
            const ansContainer = document.getElementById('answers-list-container');
            ansContainer.innerHTML = '<div class="text-gray-400 text-sm">Loading answers...</div>';

            database.ref(`edupro_forum_answers/${qId}`).once('value').then(snap => {
                const data = snap.val();
                ansContainer.innerHTML = '';

                if (!data) {
                    ansContainer.innerHTML = '<div class="text-gray-400 italic text-center py-4">No answers yet. Be the first!</div>';
                    return;
                }

                const answers = Object.entries(data).map(([key, val]) => ({ id: key, ...val }));
                answers.sort((a, b) => (b.votes || 0) - (a.votes || 0));

                answers.forEach(ans => {
                    // ADMIN ONLY: Delete Button
                    const adminControls = isAdminLoggedIn ?
                        `<button onclick="deleteAnswer('${qId}', '${ans.id}')" class="text-red-500 hover:text-red-700 text-xs ml-auto border border-red-100 bg-red-50 px-2 py-1 rounded">
                    <i class="fa-solid fa-trash"></i> Delete
                </button>` : '';

                    const html = `
                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm flex gap-4">
                    <div class="flex flex-col items-center gap-1">
                        <button onclick="upvoteAnswer('${qId}', '${ans.id}', ${ans.votes || 0})" class="text-gray-400 hover:text-orange-500 transition-colors">
                            <i class="fa-solid fa-caret-up text-3xl"></i>
                        </button>
                        <span class="font-bold text-lg text-gray-800">${ans.votes || 0}</span>
                    </div>

                    <div class="flex-grow min-w-0"> <div class="flex justify-between items-start mb-3">
                            <div class="flex items-center gap-2">
                                <div class="w-6 h-6 ${ans.isAdmin ? 'bg-red-600' : 'bg-green-600'} text-white rounded-full flex items-center justify-center font-bold text-xs">
                                    ${ans.authorName.charAt(0)}
                                </div>
                                <span class="font-bold text-gray-800 text-sm">${ans.authorName} ${ans.isAdmin ? '<span class="text-red-500 text-[10px] ml-1">(Admin)</span>' : ''}</span>
                                <span class="text-xs text-gray-400 ml-2">${typeof timeSince === 'function' ? timeSince(ans.timestamp) : ''}</span>
                            </div>
                            ${adminControls}
                        </div>
                        <div class="prose prose-sm max-w-none text-gray-700 overflow-x-auto">
                            ${ans.body}
                        </div>
                    </div>
                </div>
            `;
                    ansContainer.innerHTML += html;
                });
            });
        }
        // 5. ACTIONS (Upvote, Image Upload)

        async function upvoteAnswer(qId, aId, currentVotes) {
            const newVotes = currentVotes + 1;
            // Simple local check to prevent spamming in one session (real app would use DB)
            const votedKey = `voted_${aId}`;
            if (sessionStorage.getItem(votedKey)) return showToast("Already voted!", "info");

            await database.ref(`edupro_forum_answers/${qId}/${aId}/votes`).set(newVotes);
            sessionStorage.setItem(votedKey, "true");
            fetchAnswers(qId); // Refresh to sort
        }

        // ðŸ“¸ LOCAL IMAGE UPLOAD LOGIC
        function triggerImageUpload(inputId) {
            document.getElementById(inputId).click();
        }

        function handleImageUpload(input, editorId) {
            const file = input.files[0];
            if (!file) return;

            // Check size (Max 500KB to save Firebase bandwidth)
            if (file.size > 500000) {
                alert("Image is too large! Please upload under 500KB.");
                return;
            }

            const reader = new FileReader();
            reader.onload = function (e) {
                // Create Image HTML
                const imgHtml = `<br><img src="${e.target.result}" class="max-w-full h-auto rounded-lg my-2 border shadow-sm" style="max-height: 300px;" /><br>`;
                document.getElementById(editorId).focus();
                document.execCommand('insertHTML', false, imgHtml);
            };
            reader.readAsDataURL(file);
        }

        // 6. EDITOR TOOLS
        function formatDoc(cmd) { document.execCommand(cmd, false, null); }
        function formatDocQuestion(cmd) {
            document.execCommand(cmd, false, null);
            document.getElementById('ask-editor').focus();
        }

        // FIXED CODE BLOCK (Scrolls on mobile)
        function addCodeBlock(editorId) {
            // Added 'overflow-x-auto', 'max-w-full', and 'whitespace-pre' to ensure scrolling
            const pre = `<pre class="bg-gray-900 text-green-400 p-4 rounded-lg my-2 font-mono text-sm overflow-x-auto max-w-full whitespace-pre border-l-4 border-green-500 shadow-inner"><code>// Write your code here...</code></pre><p><br></p>`;

            const editor = document.getElementById(editorId);
            editor.focus();
            document.execCommand('insertHTML', false, pre);
        }

        // 7. SUBMIT QUESTION/ANSWER
        function openAskModal() {
            document.getElementById('ask-title').value = '';
            document.getElementById('ask-tags').value = '';
            document.getElementById('ask-editor').innerHTML = '';
            document.getElementById('ask-question-modal').classList.remove('hidden');
        }
        function closeAskModal() { document.getElementById('ask-question-modal').classList.add('hidden'); }

        async function submitQuestion() {
            if (!currentUser && !isAdminLoggedIn) return showLogin();

            const title = document.getElementById('ask-title').value;
            const body = document.getElementById('ask-editor').innerHTML;
            const tags = document.getElementById('ask-tags').value;

            if (!title || body.length < 10) return showToast("Please add more details.", "error");

            const user = isAdminLoggedIn ? { uid: 'ADMIN', name: 'EduPro Admin' } : currentUser;

            const newQ = {
                uid: user.uid,
                authorName: user.name,
                title: title,
                body: body,
                previewText: body.replace(/<[^>]*>?/gm, '').substring(0, 100), // Strip HTML for preview
                tags: tags,
                timestamp: Date.now(),
                answerCount: 0
            };

            try {
                await database.ref('edupro_forum_questions').push(newQ);
                showToast("Question posted!", "success");
                closeAskModal();
                fetchQuestions();
            } catch (e) { showToast(e.message, "error"); }
        }

        async function submitAnswer() {
            if (!activeQuestionId) return;
            if (!currentUser && !isAdminLoggedIn) return showLogin();

            const editor = document.getElementById('answer-editor');
            const body = editor.innerHTML;

            if (body.length < 5) return showToast("Answer is too short.", "error");

            const user = isAdminLoggedIn ? { uid: 'ADMIN', name: 'EduPro Admin' } : currentUser;

            const ans = {
                uid: user.uid,
                authorName: user.name,
                body: body,
                timestamp: Date.now(),
                isAdmin: isAdminLoggedIn,
                votes: 0 // Init votes
            };

            try {
                await database.ref(`edupro_forum_answers/${activeQuestionId}`).push(ans);
                // Increment count
                const qRef = database.ref(`edupro_forum_questions/${activeQuestionId}/answerCount`);
                qRef.transaction(current => (current || 0) + 1);

                editor.innerHTML = '';
                showToast("Answer posted!", "success");
                fetchAnswers(activeQuestionId);
            } catch (e) { showToast(e.message, "error"); }
        }

        // 4. ADMIN ACTIONS (Delete Logic)
        async function deleteQuestion(id, event) {
            if (event) event.stopPropagation(); // Prevent opening the card when clicking delete

            if (confirm("âš ï¸ Admin Action: Delete this entire thread? This cannot be undone.")) {
                try {
                    await database.ref(`edupro_forum_questions/${id}`).remove();
                    await database.ref(`edupro_forum_answers/${id}`).remove(); // Delete associated answers
                    showToast("Thread deleted by Admin", "info");
                    fetchQuestions();
                } catch (e) {
                    alert(e.message);
                }
            }
        }
        async function deleteAnswer(qId, aId) {
            if (confirm("âš ï¸ Admin Action: Delete this answer?")) {
                try {
                    await database.ref(`edupro_forum_answers/${qId}/${aId}`).remove();

                    // Decrement answer count
                    const qRef = database.ref(`edupro_forum_questions/${qId}/answerCount`);
                    qRef.transaction(current => (current > 0) ? current - 1 : 0);

                    showToast("Answer deleted by Admin", "info");
                    fetchAnswers(qId);
                } catch (e) {
                    alert(e.message);
                }
            }
        }
    </script>


    <!-- intenrships -->
    <script>
        // ==========================================
        // ðŸ’¼ INTERNSHIP SYSTEM (UPDATED)
        // ==========================================

        // 1. DATA (With Prices & Desc)
        const internshipDomains = {
            'python_fs': {
                title: "Python Full Stack Internship",
                icon: "ðŸ",
                price: "â‚¹1999",
                desc: "Build scalable web applications using Python, Django, and React. Experience a real agile workflow.",
                features: ["Corporate Agile Workflow", "Django REST Architecture", "React & Redux Integration", "Cloud Deployment (AWS)", "Code Review Standards"],
                tasks: [
                    {
                        title: "Environment & Architecture",
                        content: `<div class="space-y-6"><div class="bg-blue-50 border-l-4 border-blue-500 p-4"><h4 class="font-bold text-blue-800">ðŸ¢ Corporate Scenario</h4><p class="text-sm text-blue-700">In a real company, you don't just "start coding." You set up a scalable environment. We use Virtual Environments to isolate dependencies.</p></div><div><h3 class="text-xl font-bold text-gray-800 mb-2">Task 1: Project Skeleton</h3><p class="text-gray-600 mb-4">Initialize a Django project with a proper folder structure.</p><pre class="bg-gray-900 text-green-400 p-4 rounded-lg overflow-x-auto text-sm">python -m venv venv\nsource venv/bin/activate\npip install django djangorestframework\ndjango-admin startproject core_system .</pre></div></div>`
                    },
                    { title: "Database Models", content: `<h3>Task 2: Database Design</h3><p>Create models for a CRM system (Customer, Ticket) and establish Foreign Keys.</p>` },
                    { title: "API Development", content: `<h3>Task 3: REST API</h3><p>Build RESTful APIs for CRUD operations using Django Rest Framework.</p>` },
                    { title: "Frontend Integration", content: `<h3>Task 4: Connect Frontend</h3><p>Fetch data using JavaScript/React and display it.</p>` },
                    { title: "Deployment", content: `<h3>Task 5: Go Live</h3><p>Deploy your application to Render or AWS EC2.</p>` }
                ]
            },
            'java_fs': {
                title: "Java Full Stack Internship",
                icon: "â˜•",
                price: "â‚¹1999",
                desc: "Enterprise-level development with Java, Spring Boot, and Microservices architecture.",
                features: ["Core Java & OOPs", "Spring Boot & Maven", "Hibernate/JPA", "Microservices", "E-Commerce Project"],
                tasks: [
                    { title: "Java Basics", content: "<h3>Task 1: Core Java</h3><p>Implement OOP concepts: Inheritance, Polymorphism.</p>" },
                    { title: "Spring Boot Setup", content: "<h3>Task 2: Spring Initializr</h3><p>Setup a Spring Boot project with Maven.</p>" },
                    { title: "Hibernate & JPA", content: "<h3>Task 3: Data Layer</h3><p>Connect to MySQL using Hibernate.</p>" },
                    { title: "Microservices", content: "<h3>Task 4: Architecture</h3><p>Split the app into User-Service and Order-Service.</p>" },
                    { title: "Final Project", content: "<h3>Task 5: E-Commerce App</h3><p>Build a mini shopping cart system.</p>" }
                ]
            },
            'ai_ml': {
                title: "AI & Machine Learning",
                icon: "ðŸ§ ",
                price: "â‚¹2499",
                desc: "Train models, clean data, and deploy AI solutions using Python and TensorFlow.",
                features: ["Data Cleaning & Pandas", "Data Visualization", "Regression Models", "Neural Networks", "Streamlit Deployment"],
                tasks: [
                    { title: "Data Cleaning", content: "<h3>Task 1: Pandas & NumPy</h3><p>Clean a CSV dataset, handle missing values.</p>" },
                    { title: "Visualization", content: "<h3>Task 2: Matplotlib</h3><p>Create heatmaps and scatter plots for data insights.</p>" },
                    { title: "Regression Models", content: "<h3>Task 3: Scikit-Learn</h3><p>Predict housing prices using Linear Regression.</p>" },
                    { title: "Deep Learning", content: "<h3>Task 4: Neural Networks</h3><p>Build a simple image classifier using TensorFlow/Keras.</p>" },
                    { title: "Model Deployment", content: "<h3>Task 5: Streamlit</h3><p>Deploy your model as a web app using Streamlit.</p>" }
                ]
            },
            'web_dev': {
                title: "Web Development",
                icon: "ðŸ’»",
                price: "â‚¹1499",
                desc: "Master the frontend with HTML, CSS, JavaScript and React. Build a portfolio.",
                features: ["Responsive Design", "DOM Manipulation", "React Components", "Redux State", "Full Site Build"],
                tasks: [
                    { title: "HTML/CSS Landing Page", content: "<h3>Task 1: Responsive Design</h3><p>Build a portfolio landing page.</p>" },
                    { title: "JavaScript Logic", content: "<h3>Task 2: DOM Manipulation</h3><p>Create a To-Do list with Add/Delete functionality.</p>" },
                    { title: "React Basics", content: "<h3>Task 3: Components</h3><p>Build a Weather App using a public API.</p>" },
                    { title: "State Management", content: "<h3>Task 4: Redux/Context</h3><p>Manage cart state for an e-commerce UI.</p>" },
                    { title: "Final Build", content: "<h3>Task 5: Full Site</h3><p>Combine everything into a multi-page React site.</p>" }
                ]
            }
        };
        let currentInternDomain = null;
        let currentTaskIndex = 0;

        async function showInternships() {
            if (!currentUser && !isAdminLoggedIn) return showLogin();
            if (!currentUser) await fetchUserData();
            document.getElementById('forum-screen').style.display = 'none';

            hideAllScreens();
            document.getElementById('internship-selection-modal').classList.remove('hidden');
            renderInternshipDomains();
        }

        function renderInternshipDomains() {
            const grid = document.getElementById('internship-domain-grid');
            grid.innerHTML = '';

            Object.entries(internshipDomains).forEach(([key, data]) => {
                const userStatus = currentUser.internships && currentUser.internships[key] ? currentUser.internships[key].status : null;
                let btnHtml = '';

                if (userStatus === true) {
                    btnHtml = `<button onclick="openInternshipTaskScreen('${key}')" class="w-full bg-green-600 text-white py-2 rounded-lg font-bold shadow-md hover:bg-green-700">Start Internship</button>`;
                } else if (userStatus === false) {
                    btnHtml = `<button class="w-full bg-orange-100 text-orange-600 border border-orange-200 py-2 rounded-lg font-bold cursor-not-allowed">Pending Approval</button>`;
                } else {
                    btnHtml = `<button onclick="showInternshipDetail('${key}')" class="w-full bg-indigo-600 text-white py-2 rounded-lg font-bold hover:bg-indigo-700 shadow-md">View Details</button>`;
                }

                const card = `
            <div class="bg-white border border-gray-200 p-6 rounded-2xl hover:shadow-xl transition-all text-center group">
                <div class="text-6xl mb-4 group-hover:scale-110 transition-transform duration-300">${data.icon}</div>
                <h3 class="text-xl font-bold text-gray-800 mb-2">${data.title}</h3>
                <p class="text-gray-500 text-sm mb-4 line-clamp-2">${data.desc}</p>
                ${btnHtml}
            </div>
        `;
                grid.innerHTML += card;
            });
        }

        function closeInternshipSelection() {
            document.getElementById('internship-selection-modal').classList.add('hidden');
            showDashboard();
        }
        // 3. SHOW DETAIL PAGE (New Feature)
        function showInternshipDetail(domainKey) {
            const data = internshipDomains[domainKey];
            if (!data) return;

            document.getElementById('internship-selection-modal').classList.add('hidden');
            hideAllScreens();
            document.getElementById('internship-detail-screen').style.display = 'block';
            window.scrollTo(0, 0);

            document.getElementById('int-detail-title').textContent = data.title;
            document.getElementById('int-detail-desc').textContent = data.desc;
            document.getElementById('int-detail-price').textContent = data.price;
            document.getElementById('int-detail-features').innerHTML = data.features.map(f => `<li class="flex items-center gap-3"><i class="fa-solid fa-check-circle text-green-500"></i> ${f}</li>`).join('');

            const btnContainer = document.getElementById('int-action-container');
            const userStatus = currentUser.internships && currentUser.internships[domainKey] ? currentUser.internships[domainKey].status : null;

            if (userStatus === false) {
                btnContainer.innerHTML = `<div class="bg-orange-50 border border-orange-200 p-4 rounded-lg text-center"><p class="text-orange-800 font-bold mb-1">Application Pending</p><p class="text-xs text-orange-600">Approval takes ~1 hour.</p></div>`;
            } else {
                btnContainer.innerHTML = `<button onclick="registerForInternship('${domainKey}')" class="w-full bg-slate-900 text-white py-4 rounded-xl font-bold shadow-xl hover:bg-indigo-600 transition-all transform hover:-translate-y-1">Apply Now</button>`;
            }
        }

        // 4. REGISTER LOGIC
        async function registerForInternship(domainKey) {
            if (!confirm("This will redirect you to the payment gateway. Continue?")) return;

            await database.ref(`edupro_users/${currentUser.uid}/internships/${domainKey}`).set({
                status: false,
                appliedDate: new Date().toISOString(),
                domainTitle: internshipDomains[domainKey].title
            });

            window.open(PAYMENT_LINK, '_blank');
            showInternshipDetail(domainKey);
            alert("Application submitted! Admin will approve within 1 hour.");
        }


        // 5. TASK SCREEN LOGIC (With Content)
        function openInternshipTaskScreen(domainKey) {
            document.getElementById('internship-selection-modal').classList.add('hidden');
            hideAllScreens();
            document.getElementById('internship-task-screen').style.display = 'block';

            currentInternDomain = internshipDomains[domainKey];
            currentTaskIndex = 0;
            document.getElementById('internship-active-title').textContent = currentInternDomain.title;
            renderTaskUI();
        }

        // ==========================================
        // ðŸ“ TASK UI (BUTTON STATE LOGIC)
        // ==========================================
        function renderTaskUI() {
            // 1. Sidebar Steps
            const stepList = document.getElementById('internship-steps-list');
            stepList.innerHTML = currentInternDomain.tasks.map((t, i) => `
        <div class="p-3 rounded-lg border text-sm ${i === currentTaskIndex ? 'bg-pink-50 border-pink-500 text-pink-700 font-bold shadow-sm' : 'bg-white border-gray-100 text-gray-500'}">
            ${i < currentTaskIndex ? '<i class="fa-solid fa-circle-check text-green-500 mr-2"></i>' : (i === currentTaskIndex ? '<i class="fa-solid fa-play text-pink-500 mr-2 animate-pulse"></i>' : '<i class="fa-solid fa-lock text-gray-300 mr-2"></i>')}
            Task ${i + 1}: ${t.title}
        </div>
    `).join('');

            // 2. Main Content
            const task = currentInternDomain.tasks[currentTaskIndex];
            document.getElementById('internship-content-card').innerHTML = task.content;

            // 3. Navigation Buttons
            const prevBtn = document.getElementById('btn-prev-task');
            const nextBtn = document.getElementById('btn-next-task');
            const finishBtn = document.getElementById('btn-finish-internship');

            prevBtn.disabled = (currentTaskIndex === 0);

            // Last Task Logic
            if (currentTaskIndex === currentInternDomain.tasks.length - 1) {
                nextBtn.classList.add('hidden');
                finishBtn.classList.remove('hidden');

                // CHECK IF CERTIFICATE ALREADY EXISTS
                const certID = 'INTERN_' + currentInternDomain.title.replace(/\s+/g, '_');
                const existingCert = certificates.find(c => c.userId === currentUserId && c.courseId === certID);

                if (existingCert) {
                    // Certificate Exists -> Change Button
                    finishBtn.textContent = "Check Your Certificates ðŸŽ“";
                    finishBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
                    finishBtn.classList.add('bg-indigo-600', 'hover:bg-indigo-700');
                    finishBtn.onclick = function () {
                        showCertificates(); // Go to "My Certificates"
                    };
                } else {
                    // No Certificate -> Default Generation Behavior
                    finishBtn.textContent = "Generate Certificate ðŸ†";
                    finishBtn.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
                    finishBtn.classList.add('bg-green-600', 'hover:bg-green-700');
                    finishBtn.onclick = function () {
                        openCertificateDateModal();
                    };
                }

            } else {
                nextBtn.classList.remove('hidden');
                finishBtn.classList.add('hidden');
            }
        }
        function navigateTask(direction) {
            currentTaskIndex += direction;
            renderTaskUI();
        }

        // 6. CERTIFICATE GENERATION (Custom/Default Dates)
        function openCertificateDateModal() {
            document.getElementById('internship-date-modal').classList.remove('hidden');
        }

        // ==========================================
        // 1. GENERATE INTERNSHIP CERTIFICATE (FIXED)
        // ==========================================
        async function generateInternshipCertificate(mode) {
            // 1. Identify Domain Key & Unique ID
            const domainKey = Object.keys(internshipDomains).find(key => internshipDomains[key].title === currentInternDomain.title);
            const certUniqueId = `INTERN_${currentUser.uid}_${domainKey}`;

            // 2. Strict Check (Prevents Duplicate Generation)
            await fetchUserData(true);
            const existingCert = certificates.find(c => c.courseId === certUniqueId);

            if (existingCert) {
                alert("Certificate already generated! Showing existing certificate.");
                document.getElementById('internship-date-modal').classList.add('hidden');
                showCertificateScreen(existingCert);
                return;
            }

            // 3. Handle Dates
            let dateText = "";
            const errorMsg = document.getElementById('date-error-msg');

            if (mode === 'custom') {
                const start = document.getElementById('cert-start-date').value;
                const end = document.getElementById('cert-end-date').value;
                if (!start || !end) {
                    errorMsg.textContent = "Please select both dates.";
                    errorMsg.classList.remove('hidden');
                    return;
                }
                dateText = `${start} to ${end}`;
            } else {
                const today = new Date();
                const past = new Date();
                past.setMonth(today.getMonth() - 1);
                dateText = `${past.toISOString().split('T')[0]} to ${today.toISOString().split('T')[0]}`;
            }

            document.getElementById('internship-date-modal').classList.add('hidden');

            // 4. Create Certificate Data
            const randomScore = Math.floor(Math.random() * (99 - 91 + 1)) + 91; // Random 91-99
            const certData = {
                name: currentUser.name,
                courseTitle: currentInternDomain.title, // Title without "(Internship)"
                dateDisplay: dateText,
                refNo: 'INT' + Math.floor(Math.random() * 1000000),
                completedModules: '5',
                totalModules: '5',
                courseId: certUniqueId, // Unique ID used for strict check
                type: 'internship',
                score: randomScore
            };

            // 5. Save & Show
            await database.ref(`certificates/${certData.refNo}`).set(certData);
            certificates.push(certData);
            showCertificateScreen(certData);
        }
        // 7. ADMIN INTERNSHIP LOGIC (Required for Admin Panel to work)
        function fetchAdminInternships() {
            const tbody = document.getElementById('admin-internship-table-body');
            const countEl = document.getElementById('metric-total-interns');
            tbody.innerHTML = '<tr><td colspan="4" class="text-center py-4">Loading...</td></tr>';

            const internshipRequests = [];
            let totalInterns = 0;

            users.forEach(user => {
                if (user.internships) {
                    Object.entries(user.internships).forEach(([key, val]) => {
                        if (val.status === true) totalInterns++;
                        internshipRequests.push({ uid: user.uid, userName: user.name, userEmail: user.email, domainKey: key, ...val });
                    });
                }
            });

            if (countEl) countEl.textContent = totalInterns;

            tbody.innerHTML = '';
            if (internshipRequests.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="text-center py-4 text-gray-500">No internship records found.</td></tr>';
                return;
            }

            internshipRequests.forEach(req => {
                const statusBadge = req.status ? `<span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs font-bold">Approved</span>` : `<span class="bg-orange-100 text-orange-800 px-2 py-1 rounded text-xs font-bold">Pending</span>`;
                const actionBtn = req.status ? `<button onclick="toggleInternshipStatus('${req.uid}', '${req.domainKey}', false)" class="bg-red-500 text-white px-3 py-1 rounded text-xs">Revoke</button>` : `<button onclick="toggleInternshipStatus('${req.uid}', '${req.domainKey}', true)" class="bg-blue-600 text-white px-3 py-1 rounded text-xs">Approve</button>`;
                const row = `<tr class="border-b hover:bg-gray-50"><td class="px-6 py-4"><div class="text-sm font-bold text-gray-900">${req.userName}</div><div class="text-xs text-gray-500">${req.userEmail}</div></td><td class="px-6 py-4 text-sm text-gray-600 font-medium">${req.domainTitle}</td><td class="px-6 py-4">${statusBadge}</td><td class="px-6 py-4">${actionBtn}</td></tr>`;
                tbody.innerHTML += row;
            });
        }
        async function toggleInternshipStatus(uid, domainKey, newStatus) {
            if (!isAdminLoggedIn) return;
            await database.ref(`edupro_users/${uid}/internships/${domainKey}/status`).set(newStatus);
            await fetchUserData(); // Reload data
            renderAdminDashboard(); // Reload table
            showToast(`Internship ${newStatus ? 'Approved' : 'Revoked'}`, "success");
        }

        async function toggleCourseStatus(uid, courseId, newStatus) {
            if (!isAdminLoggedIn) return;
            await database.ref(`edupro_users/${uid}/enrolled_courses/${courseId}/status`).set(newStatus);
            await fetchUserData(); // Reload data
            renderAdminDashboard(); // Reload table
            showToast(`Course ${newStatus ? 'Approved' : 'Revoked'}`, "success");
        }
    </script>


    <script>
        // ==========================================
        // âœ… VERIFICATION SYSTEM LOGIC
        // ==========================================

        function checkUrlVerification() {
            const params = new URLSearchParams(window.location.search);
            const verifyId = params.get('verify');

            if (verifyId) {
                // Hide standard screens to focus on verification
                hideAllScreens();
                showLoader();

                // Fetch Certificate Data Directly
                database.ref(`certificates/${verifyId}`).once('value').then(snapshot => {
                    hideLoader();
                    const certData = snapshot.val();

                    if (certData) {
                        showVerificationModal(certData);
                    } else {
                        alert("âŒ INVALID CERTIFICATE\n\nNo record found for ID: " + verifyId);
                        // Clear URL
                        window.history.replaceState({}, document.title, "/");
                        showWelcomeScreen();
                    }
                }).catch(err => {
                    hideLoader();
                    console.error(err);
                    alert("Error verifying certificate.");
                });
            }
        }

        function showVerificationModal(cert) {
            document.getElementById('verify-name').textContent = cert.name;
            document.getElementById('verify-ref').textContent = cert.refNo;
            document.getElementById('verify-domain').textContent = cert.courseTitle;
            document.getElementById('verify-date').textContent = cert.dateDisplay;

            document.getElementById('verification-modal').classList.remove('hidden');
        }

        function closeVerificationModal() {
            document.getElementById('verification-modal').classList.add('hidden');
            // Remove query param
            window.history.replaceState({}, document.title, window.location.pathname);
            showWelcomeScreen();
        }

        // CALL THIS ON LOAD (Add this line to your existing DOMContentLoaded listener)
        // Or just paste this small block at the very end of your script:
        document.addEventListener('DOMContentLoaded', checkUrlVerification);
    </script>
</body>

</html>
